--[[
    Nova UI Library v1.2
    Stable & Production-Ready Mod Menu Framework for Roblox
    Author: Nova Team
    License: MIT
--]]

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

-- Library Table
local Nova = {
    Version = "1.2",
    Debug = false
}

Nova.__index = Nova

-- Configuration
local DEFAULT_CONFIG = {
    AccentColor = Color3.fromRGB(0, 170, 255),
    BackgroundTransparency = 0.05,
    Theme = "Dark",
    Keybind = Enum.KeyCode.RightShift
}

local themes = {
    Dark = {
        Background = Color3.fromRGB(25, 25, 30),
        Surface = Color3.fromRGB(35, 35, 40),
        Text = Color3.fromRGB(240, 240, 240),
        SubText = Color3.fromRGB(180, 180, 180),
        Border = Color3.fromRGB(60, 60, 65)
    },
    Light = {
        Background = Color3.fromRGB(245, 245, 245),
        Surface = Color3.fromRGB(255, 255, 255),
        Text = Color3.fromRGB(30, 30, 30),
        SubText = Color3.fromRGB(100, 100, 100),
        Border = Color3.fromRGB(220, 220, 225)
    }
}

-- Utility Functions
local function create(class, props)
    local obj = Instance.new(class)
    for prop, value in pairs(props) do
        if prop ~= "Parent" and prop ~= "Children" then
            pcall(function()
                obj[prop] = value
            end)
        end
    end
    
    if props.Parent then
        obj.Parent = props.Parent
    end
    
    if props.Children then
        for _, child in ipairs(props.Children) do
            child.Parent = obj
        end
    end
    
    return obj
end

local function tween(obj, props, duration, style)
    if not obj or not props then return end
    
    local tweenInfo = TweenInfo.new(duration or 0.2, style or Enum.EasingStyle.Quad)
    local tweenObj = TweenService:Create(obj, tweenInfo, props)
    tweenObj:Play()
    return tweenObj
end

local function generateUniqueName(baseName)
    local id = HttpService:GenerateGUID(false):sub(1, 8)
    return string.format("%s_%s", baseName, id)
end

-- Main Constructor
function Nova.new(menuName)
    menuName = menuName or "NovaMenu"
    
    -- Cleanup existing menus
    pcall(function()
        for _, child in ipairs(CoreGui:GetChildren()) do
            if child:IsA("ScreenGui") and child.Name:match("^" .. menuName) then
                child:Destroy()
            end
        end
    end)
    
    local self = setmetatable({}, Nova)
    
    self.MenuName = generateUniqueName(menuName)
    self.Sections = {}
    self.CurrentSection = nil
    self.Widgets = {}
    self.Config = table.clone(DEFAULT_CONFIG)
    self.Tools = {}
    self.IsMobile = UserInputService.TouchEnabled
    self.Open = false
    self.Connections = {}
    
    -- Initialize
    local success, err = pcall(function()
        self:BuildUI()
        self:SetupInput()
        self:ApplyTheme()
    end)
    
    if not success then
        warn("[Nova UI] Initialization error:", err)
        return nil
    end
    
    return self
end

-- UI Construction
function Nova:BuildUI()
    -- Main ScreenGui
    self.ScreenGui = create("ScreenGui", {
        Name = self.MenuName,
        Parent = CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        DisplayOrder = 999
    })

    -- Mobile Toggle Button
    if self.IsMobile then
        self.MobileToggle = create("ImageButton", {
            Name = "MobileToggle",
            Parent = self.ScreenGui,
            AnchorPoint = Vector2.new(1, 0.5),
            Position = UDim2.new(1, -20, 0.5, 0),
            Size = UDim2.new(0, 50, 0, 50),
            BackgroundColor3 = self.Config.AccentColor,
            Image = "rbxassetid://10734947690",
            ImageColor3 = Color3.new(1, 1, 1),
            AutoButtonColor = false,
            Visible = false
        })
        
        local corner = create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        })
        corner.Parent = self.MobileToggle
        
        self.MobileToggle.MouseButton1Click:Connect(function()
            self:ToggleMenu()
        end)
    end

    -- Main Frame
    self.MainFrame = create("Frame", {
        Name = "MainFrame",
        Parent = self.ScreenGui,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 600, 0, 400),
        BackgroundColor3 = themes.Dark.Background,
        BackgroundTransparency = 1,
        Visible = false,
        ClipsDescendants = true
    })
    
    local mainCorner = create("UICorner", {
        CornerRadius = UDim.new(0, 8)
    })
    mainCorner.Parent = self.MainFrame
    
    local mainStroke = create("UIStroke", {
        Color = themes.Dark.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    mainStroke.Parent = self.MainFrame

    -- Top Bar
    self.TopBar = create("Frame", {
        Name = "TopBar",
        Parent = self.MainFrame,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = themes.Dark.Surface,
        BorderSizePixel = 0
    })
    
    local topCorner = create("UICorner", {
        CornerRadius = UDim.new(0, 8)
    })
    topCorner.Parent = self.TopBar

    -- Tab List
    self.TabList = create("ScrollingFrame", {
        Name = "TabList",
        Parent = self.TopBar,
        Size = UDim2.new(1, -40, 1, 0),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.X
    })
    
    local tabListLayout = create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 5)
    })
    tabListLayout.Parent = self.TabList

    -- Content Frame
    self.ContentFrame = create("ScrollingFrame", {
        Name = "ContentFrame",
        Parent = self.MainFrame,
        Position = UDim2.new(0, 0, 0, 45),
        Size = UDim2.new(1, 0, 1, -45),
        BackgroundTransparency = 1,
        ScrollBarThickness = 4,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y
    })
    
    local contentPadding = create("UIPadding", {
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    contentPadding.Parent = self.ContentFrame
    
    local contentLayout = create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10)
    })
    contentLayout.Parent = self.ContentFrame

    -- Close Button
    self.CloseButton = create("TextButton", {
        Name = "CloseButton",
        Parent = self.MainFrame,
        AnchorPoint = Vector2.new(1, 0),
        Position = UDim2.new(1, -10, 0, 10),
        Size = UDim2.new(0, 20, 0, 20),
        BackgroundTransparency = 1,
        Text = "Ã—",
        TextColor3 = themes.Dark.SubText,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false
    })
    
    self.CloseButton.MouseButton1Click:Connect(function()
        self:ToggleMenu()
    end)
end

-- Input Handling
function Nova:SetupInput()
    if not self.IsMobile then
        local connection = UserInputService.InputBegan:Connect(function(input, processed)
            if not processed and input.KeyCode == self.Config.Keybind then
                self:ToggleMenu()
            end
        end)
        table.insert(self.Connections, connection)
    end
end

-- Menu Control
function Nova:ToggleMenu()
    self.Open = not self.Open
    
    if self.Open then
        self.MainFrame.Visible = true
        self.MainFrame.Position = UDim2.new(0.5, 0, 0.5, -50)
        self.MainFrame.BackgroundTransparency = 1
        
        tween(self.MainFrame, {
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = self.Config.BackgroundTransparency
        }, 0.3, Enum.EasingStyle.Back)
        
        if self.MobileToggle then
            self.MobileToggle.Visible = false
        end
    else
        tween(self.MainFrame, {
            Position = UDim2.new(0.5, 0, 0.5, -50),
            BackgroundTransparency = 1
        }, 0.2, Enum.EasingStyle.Quad)
        
        task.wait(0.2)
        self.MainFrame.Visible = false
        
        if self.MobileToggle then
            self.MobileToggle.Visible = true
        end
    end
end

-- Section Management
function Nova:Section(name)
    local sectionId = #self.Sections + 1
    
    -- Create Tab Button
    local tabButton = create("TextButton", {
        Name = name .. "Tab",
        Parent = self.TabList,
        Size = UDim2.new(0, 80, 1, -10),
        BackgroundColor3 = themes.Dark.Surface,
        AutoButtonColor = false,
        Text = name,
        TextColor3 = themes.Dark.Text,
        Font = Enum.Font.GothamMedium,
        TextSize = 14
    })
    
    create("UICorner", {
        CornerRadius = UDim.new(0, 6)
    }).Parent = tabButton
    
    -- Create Section Frame
    local sectionFrame = create("Frame", {
        Name = name .. "Section",
        Parent = self.ContentFrame,
        Size = UDim2.new(1, -20, 0, 0),
        BackgroundTransparency = 1,
        Visible = sectionId == 1
    })
    
    local sectionLayout = create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 15)
    })
    sectionLayout.Parent = sectionFrame
    
    create("UIPadding", {
        PaddingBottom = UDim.new(0, 10)
    }).Parent = sectionFrame

    if sectionId == 1 then
        self.CurrentSection = sectionFrame
        tabButton.BackgroundColor3 = self.Config.AccentColor
    end

    -- Tab click handler
    tabButton.MouseButton1Click:Connect(function()
        if self.CurrentSection then
            self.CurrentSection.Visible = false
        end
        
        -- Reset all tabs
        for _, btn in ipairs(self.TabList:GetChildren()) do
            if btn:IsA("TextButton") then
                tween(btn, {BackgroundColor3 = themes.Dark.Surface})
            end
        end
        
        -- Activate selected tab
        sectionFrame.Visible = true
        self.CurrentSection = sectionFrame
        tween(tabButton, {BackgroundColor3 = self.Config.AccentColor})
    end)

    table.insert(self.Sections, sectionFrame)
    
    -- Section API
    local sectionAPI = {}
    
    -- Button
    function sectionAPI:Button(text, callback)
        if not self.CurrentSection then return end
        
        local button = create("TextButton", {
            Name = text,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = text,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextSize = 14
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(0, 6)
        }).Parent = button
        
        create("UIStroke", {
            Color = themes.Dark.Border,
            Thickness = 1
        }).Parent = button

        local originalColor = button.BackgroundColor3
        
        button.MouseEnter:Connect(function()
            tween(button, {BackgroundColor3 = originalColor:Lerp(self.Config.AccentColor, 0.3)})
        end)
        
        button.MouseLeave:Connect(function()
            tween(button, {BackgroundColor3 = originalColor})
        end)
        
        button.MouseButton1Click:Connect(function()
            if callback then
                pcall(callback)
            end
        end)
        
        return button
    end
    
    -- Toggle
    function sectionAPI:Toggle(text, default, callback)
        if not self.CurrentSection then return end
        
        local container = create("Frame", {
            Name = text,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 35),
            BackgroundTransparency = 1
        })
        
        local label = create("TextLabel", {
            Parent = container,
            AnchorPoint = Vector2.new(0, 0.5),
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = text,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local toggleButton = create("TextButton", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0.5),
            Position = UDim2.new(1, 0, 0.5, 0),
            Size = UDim2.new(0, 50, 0, 25),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = ""
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        }).Parent = toggleButton
        
        local toggleCircle = create("Frame", {
            Parent = toggleButton,
            AnchorPoint = Vector2.new(0, 0.5),
            Position = UDim2.new(0, 3, 0.5, 0),
            Size = UDim2.new(0, 19, 0, 19),
            BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        }).Parent = toggleCircle
        
        local state = default or false
        
        local function updateToggle()
            if state then
                tween(toggleButton, {BackgroundColor3 = self.Config.AccentColor})
                tween(toggleCircle, {
                    Position = UDim2.new(1, -22, 0.5, 0),
                    BackgroundColor3 = Color3.new(1, 1, 1)
                })
            else
                tween(toggleButton, {BackgroundColor3 = themes.Dark.Surface})
                tween(toggleCircle, {
                    Position = UDim2.new(0, 3, 0.5, 0),
                    BackgroundColor3 = Color3.fromRGB(200, 200, 200)
                })
            end
        end
        
        updateToggle()
        
        toggleButton.MouseButton1Click:Connect(function()
            state = not state
            updateToggle()
            if callback then
                pcall(callback, state)
            end
        end)
        
        local toggleObj = {}
        
        function toggleObj:Set(value)
            if type(value) == "boolean" then
                state = value
                updateToggle()
            end
            return self
        end
        
        function toggleObj:Get()
            return state
        end
        
        return toggleObj
    end
    
    -- Slider
    function sectionAPI:Slider(text, min, max, default, callback)
        if not self.CurrentSection then return end
        
        local container = create("Frame", {
            Name = text,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 60),
            BackgroundTransparency = 1
        })
        
        local label = create("TextLabel", {
            Parent = container,
            Size = UDim2.new(1, 0, 0, 20),
            BackgroundTransparency = 1,
            Text = string.format("%s: %d", text, default or min),
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local sliderTrack = create("Frame", {
            Parent = container,
            Position = UDim2.new(0, 0, 0, 25),
            Size = UDim2.new(1, 0, 0, 10),
            BackgroundColor3 = themes.Dark.Surface
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        }).Parent = sliderTrack
        
        local sliderFill = create("Frame", {
            Parent = sliderTrack,
            Size = UDim2.new(0, 0, 1, 0),
            BackgroundColor3 = self.Config.AccentColor
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        }).Parent = sliderFill
        
        local sliderButton = create("TextButton", {
            Parent = sliderTrack,
            AnchorPoint = Vector2.new(0.5, 0.5),
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0, 20, 0, 20),
            BackgroundColor3 = Color3.new(1, 1, 1),
            AutoButtonColor = false,
            Text = ""
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(1, 0)
        }).Parent = sliderButton
        
        local value = math.clamp(default or min, min, max)
        local dragging = false
        
        local function updateSlider(mouseX)
            local absPos = sliderTrack.AbsolutePosition
            local absSize = sliderTrack.AbsoluteSize
            
            if not absPos or not absSize then return end
            
            local relativeX = math.clamp(mouseX - absPos.X, 0, absSize.X)
            local percentage = relativeX / absSize.X
            value = math.floor(min + (max - min) * percentage)
            
            sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
            sliderButton.Position = UDim2.new(percentage, 0, 0.5, 0)
            label.Text = string.format("%s: %d", text, value)
            
            if callback then
                pcall(callback, value)
            end
        end
        
        sliderButton.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
            end
        end)
        
        sliderButton.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        local connection = UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSlider(input.Position.X)
            end
        end)
        
        table.insert(self.Connections, connection)
        
        -- Set initial value
        local initialPercentage = (value - min) / (max - min)
        sliderFill.Size = UDim2.new(initialPercentage, 0, 1, 0)
        sliderButton.Position = UDim2.new(initialPercentage, 0, 0.5, 0)
        
        local sliderObj = {}
        
        function sliderObj:Set(newValue)
            value = math.clamp(newValue, min, max)
            local percentage = (value - min) / (max - min)
            sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
            sliderButton.Position = UDim2.new(percentage, 0, 0.5, 0)
            label.Text = string.format("%s: %d", text, value)
            return self
        end
        
        function sliderObj:Get()
            return value
        end
        
        return sliderObj
    end
    
    -- Dropdown
    function sectionAPI:Dropdown(text, options, callback)
        if not self.CurrentSection then return end
        
        local container = create("Frame", {
            Name = text,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundTransparency = 1
        })
        
        local label = create("TextLabel", {
            Parent = container,
            Size = UDim2.new(0.3, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = text,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local dropdownButton = create("TextButton", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = "Select...",
            TextColor3 = themes.Dark.SubText,
            Font = Enum.Font.GothamMedium,
            TextSize = 14
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(0, 6)
        }).Parent = dropdownButton
        
        local dropdownFrame = create("ScrollingFrame", {
            Parent = self.ScreenGui,
            Position = UDim2.new(0, 0, 0, 0),
            Size = UDim2.new(0, 200, 0, 150),
            BackgroundColor3 = themes.Dark.Surface,
            ScrollBarThickness = 4,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Visible = false,
            ZIndex = 100,
            BorderSizePixel = 0
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(0, 6)
        }).Parent = dropdownFrame
        
        create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder
        }).Parent = dropdownFrame
        
        local selected = nil
        
        local function updateOptions()
            for _, child in ipairs(dropdownFrame:GetChildren()) do
                if child:IsA("TextButton") then
                    child:Destroy()
                end
            end
            
            for i, option in ipairs(options) do
                local optionText = tostring(option)
                local optionButton = create("TextButton", {
                    Parent = dropdownFrame,
                    Size = UDim2.new(1, -10, 0, 30),
                    Position = UDim2.new(0, 5, 0, (i-1)*35 + 5),
                    BackgroundColor3 = themes.Dark.Surface,
                    AutoButtonColor = false,
                    Text = optionText,
                    TextColor3 = themes.Dark.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13
                })
                
                create("UICorner", {
                    CornerRadius = UDim.new(0, 4)
                }).Parent = optionButton
                
                optionButton.MouseEnter:Connect(function()
                    tween(optionButton, {BackgroundColor3 = self.Config.AccentColor})
                end)
                
                optionButton.MouseLeave:Connect(function()
                    tween(optionButton, {BackgroundColor3 = themes.Dark.Surface})
                end)
                
                optionButton.MouseButton1Click:Connect(function()
                    selected = option
                    dropdownButton.Text = optionText
                    dropdownFrame.Visible = false
                    
                    if callback then
                        pcall(callback, option)
                    end
                end)
            end
        end
        
        dropdownButton.MouseButton1Click:Connect(function()
            if not dropdownFrame.Visible then
                local buttonPos = dropdownButton.AbsolutePosition
                local buttonSize = dropdownButton.AbsoluteSize
                
                dropdownFrame.Position = UDim2.new(
                    0, buttonPos.X,
                    0, buttonPos.Y + buttonSize.Y + 5
                )
                dropdownFrame.Size = UDim2.new(0, buttonSize.X, 0, 150)
            end
            
            dropdownFrame.Visible = not dropdownFrame.Visible
        end)
        
        updateOptions()
        
        local dropdownObj = {}
        
        function dropdownObj:SetOptions(newOptions)
            if type(newOptions) == "table" then
                options = newOptions
                updateOptions()
            end
            return self
        end
        
        function dropdownObj:Set(option)
            selected = option
            dropdownButton.Text = tostring(option)
            return self
        end
        
        function dropdownObj:Get()
            return selected
        end
        
        return dropdownObj
    end
    
    -- Textbox
    function sectionAPI:Textbox(text, placeholder, callback)
        if not self.CurrentSection then return end
        
        local container = create("Frame", {
            Name = text,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundTransparency = 1
        })
        
        local label = create("TextLabel", {
            Parent = container,
            Size = UDim2.new(0.3, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = text,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local textbox = create("TextBox", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundColor3 = themes.Dark.Surface,
            PlaceholderText = placeholder or "Enter text...",
            Text = "",
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.Gotham,
            TextSize = 14,
            ClearTextOnFocus = false
        })
        
        create("UICorner", {
            CornerRadius = UDim.new(0, 6)
        }).Parent = textbox
        
        create("UIStroke", {
            Color = themes.Dark.Border,
            Thickness = 1
        }).Parent = textbox
        
        if callback then
            textbox.FocusLost:Connect(function(enterPressed)
                pcall(callback, textbox.Text, enterPressed)
            end)
        end
        
        return textbox
    end
    
    return sectionAPI
end

-- Settings Section
function Nova:SetupSettings()
    local settings = self:Section("Settings")
    
    if not settings then return end
    
    -- Theme
    local themeDropdown = settings:Dropdown("Theme", {"Dark", "Light"}, function(theme)
        self.Config.Theme = theme
        self:ApplyTheme()
    end)
    
    if themeDropdown then
        themeDropdown:Set(self.Config.Theme)
    end
    
    -- Accent Color
    local rSlider = settings:Slider("Accent R", 0, 255, math.floor(self.Config.AccentColor.R * 255), function(r)
        self.Config.AccentColor = Color3.fromRGB(
            r,
            math.floor(self.Config.AccentColor.G * 255),
            math.floor(self.Config.AccentColor.B * 255)
        )
        self:ApplyTheme()
    end)
    
    -- Transparency
    settings:Slider("Transparency", 0, 100, math.floor((1 - self.Config.BackgroundTransparency) * 100), function(value)
        self.Config.BackgroundTransparency = 1 - (value / 100)
        self.MainFrame.BackgroundTransparency = self.Config.BackgroundTransparency
    end)
    
    -- Keybind
    settings:Button("Keybind: " .. self.Config.Keybind.Name, function()
        print("Current keybind:", self.Config.Keybind.Name)
        print("To change: edit DEFAULT_CONFIG.Keybind in the script")
    end)
    
    -- Reset
    settings:Button("Reset Settings", function()
        self.Config = table.clone(DEFAULT_CONFIG)
        self:ApplyTheme()
        print("Settings reset")
    end)
    
    -- Info
    settings:Button("Nova UI v" .. self.Version, function()
        print("Nova UI Library v" .. self.Version)
        print("Created by Nova Team")
    end)
end

-- Console System
function Nova:CreateConsole(title, getLogsFunction)
    local console = self:Section(title)
    
    if not console then return end
    
    -- Search bar
    console:Textbox("Search", "Filter logs...", function(text)
        -- Search functionality placeholder
    end)
    
    -- Log display
    local logs = getLogsFunction and getLogsFunction() or {
        "HTTP 404",
        "Stack Begin",
        "Script 'LocalScript', Line 2051",
        "Stack End",
        "",
        "RAXALeamRtdbaIQxLwqketj453: attempt to index nil with 'GetChildren'",
        "Stack Begin",
        "Script 'LocalScript', Line 453 - function Toggle",
        "Script 'LocalScript', Line 13",
        "Stack End"
    }
    
    for i, log in ipairs(logs) do
        if log ~= "" then
            console:Button(log:sub(1, 50) .. (log:len() > 50 and "..." or ""), function()
                print("Full log:", log)
            end)
        end
    end
    
    -- Clear button
    console:Button("Clear Console", function()
        print("Console cleared")
    end)
end

-- Theme Application
function Nova:ApplyTheme()
    local theme = themes[self.Config.Theme] or themes.Dark
    
    if self.MainFrame then
        self.MainFrame.BackgroundColor3 = theme.Background
    end
    
    if self.TopBar then
        self.TopBar.BackgroundColor3 = theme.Surface
    end
    
    if self.CloseButton then
        self.CloseButton.TextColor3 = theme.SubText
    end
    
    -- Update all tab buttons
    if self.TabList then
        for _, btn in ipairs(self.TabList:GetChildren()) do
            if btn:IsA("TextButton") then
                if btn == self.CurrentSection and btn.Name:match("Tab$") then
                    btn.BackgroundColor3 = self.Config.AccentColor
                else
                    btn.BackgroundColor3 = theme.Surface
                end
                btn.TextColor3 = theme.Text
            end
        end
    end
end

-- Cleanup
function Nova:Destroy()
    for _, conn in ipairs(self.Connections) do
        if typeof(conn) == "RBXScriptConnection" then
            conn:Disconnect()
        end
    end
    
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
    
    for k in pairs(self) do
        self[k] = nil
    end
end

return Nova
