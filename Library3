--[[
    Nova UI Library v1.1
    Robust & Production-Ready Mod Menu Framework for Roblox
    Author: Nova Team
    License: MIT
--]]

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

-- Library Table
local Nova = {
    Version = "1.1",
    Debug = true
}

Nova.__index = Nova

-- Configuration
local DEFAULT_CONFIG = {
    AccentColor = Color3.fromRGB(0, 170, 255),
    BackgroundTransparency = 0.05,
    Theme = "Dark",
    Keybind = Enum.KeyCode.RightShift
}

local themes = {
    Dark = {
        Background = Color3.fromRGB(25, 25, 30),
        Surface = Color3.fromRGB(35, 35, 40),
        Text = Color3.fromRGB(240, 240, 240),
        SubText = Color3.fromRGB(180, 180, 180),
        Border = Color3.fromRGB(60, 60, 65)
    },
    Light = {
        Background = Color3.fromRGB(245, 245, 245),
        Surface = Color3.fromRGB(255, 255, 255),
        Text = Color3.fromRGB(30, 30, 30),
        SubText = Color3.fromRGB(100, 100, 100),
        Border = Color3.fromRGB(220, 220, 225)
    }
}

-- Utility Functions
local function safeCreate(class, props)
    local success, obj = pcall(function()
        local instance = Instance.new(class)
        for prop, value in pairs(props) do
            if prop ~= "Parent" then
                if pcall(function()
                    instance[prop] = value
                end) == false and Nova.Debug then
                    warn("[Nova UI] Failed to set property:", prop, "for", class)
                end
            end
        end
        return instance
    end)
    
    if success and obj then
        if props.Parent then
            obj.Parent = props.Parent
        end
        return obj
    else
        if Nova.Debug then
            warn("[Nova UI] Failed to create:", class)
        end
        return nil
    end
end

local function tween(obj, props, duration, style)
    local success, result = pcall(function()
        local tweenInfo = TweenInfo.new(duration or 0.2, style or Enum.EasingStyle.Quad)
        local tween = TweenService:Create(obj, tweenInfo, props)
        tween:Play()
        return tween
    end)
    
    if not success and Nova.Debug then
        warn("[Nova UI] Tween failed:", result)
    end
    
    return result
end

local function generateUniqueName(baseName)
    local id = HttpService:GenerateGUID(false):sub(1, 8)
    return string.format("%s_%s", baseName, id)
end

-- Main Constructor
function Nova.new(menuName)
    menuName = menuName or "NovaMenu"
    
    -- Cleanup existing menus
    pcall(function()
        for _, child in ipairs(CoreGui:GetChildren()) do
            if child:IsA("ScreenGui") and child.Name:match("^" .. menuName) then
                child:Destroy()
            end
        end
    end)
    
    local self = setmetatable({}, Nova)
    
    self.MenuName = generateUniqueName(menuName)
    self.Sections = {}
    self.CurrentSection = nil
    self.Widgets = {}
    self.Config = table.clone(DEFAULT_CONFIG)
    self.Tools = {}
    self.IsMobile = UserInputService.TouchEnabled
    self.Open = false
    
    -- Build UI
    local success, err = pcall(function()
        self:BuildUI()
        self:SetupInput()
        self:LoadConfig()
    end)
    
    if not success then
        warn("[Nova UI] Failed to initialize:", err)
        return nil
    end
    
    return self
end

-- UI Construction
function Nova:BuildUI()
    -- Main ScreenGui
    self.ScreenGui = safeCreate("ScreenGui", {
        Name = self.MenuName,
        Parent = CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        DisplayOrder = 999
    })
    
    if not self.ScreenGui then
        error("Failed to create ScreenGui")
    end

    -- Mobile Toggle Button (only on mobile)
    if self.IsMobile then
        self.MobileToggle = safeCreate("ImageButton", {
            Name = "MobileToggle",
            Parent = self.ScreenGui,
            AnchorPoint = Vector2.new(1, 0.5),
            Position = UDim2.new(1, -20, 0.5, 0),
            Size = UDim2.new(0, 50, 0, 50),
            BackgroundColor3 = self.Config.AccentColor,
            Image = "rbxassetid://10734947690",
            ImageColor3 = Color3.new(1, 1, 1),
            AutoButtonColor = false
        })
        
        if self.MobileToggle then
            safeCreate("UICorner", {
                CornerRadius = UDim.new(1, 0),
                Parent = self.MobileToggle
            })
            
            self.MobileToggle.MouseButton1Click:Connect(function()
                self:ToggleMenu()
            end)
        end
    end

    -- Main Frame (initially hidden)
    self.MainFrame = safeCreate("Frame", {
        Name = "MainFrame",
        Parent = self.ScreenGui,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 600, 0, 400),
        BackgroundColor3 = themes.Dark.Background,
        BackgroundTransparency = 1,
        Visible = false,
        ClipsDescendants = true
    })
    
    if not self.MainFrame then
        error("Failed to create MainFrame")
    end
    
    safeCreate("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.MainFrame
    })
    
    safeCreate("UIStroke", {
        Parent = self.MainFrame,
        Color = themes.Dark.Border,
        Thickness = 1,
        Transparency = 0.5
    })

    -- Top Bar with Tabs
    self.TopBar = safeCreate("Frame", {
        Name = "TopBar",
        Parent = self.MainFrame,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = themes.Dark.Surface,
        BorderSizePixel = 0
    })
    
    safeCreate("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = self.TopBar
    })

    self.TabList = safeCreate("ScrollingFrame", {
        Name = "TabList",
        Parent = self.TopBar,
        Size = UDim2.new(1, -40, 1, 0),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.X
    })
    
    safeCreate("UIListLayout", {
        Parent = self.TabList,
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 5)
    })

    -- Content Area
    self.ContentFrame = safeCreate("ScrollingFrame", {
        Name = "ContentFrame",
        Parent = self.MainFrame,
        Position = UDim2.new(0, 0, 0, 45),
        Size = UDim2.new(1, 0, 1, -45),
        BackgroundTransparency = 1,
        ScrollBarThickness = 4,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y
    })
    
    safeCreate("UIPadding", {
        Parent = self.ContentFrame,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    safeCreate("UIListLayout", {
        Parent = self.ContentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10)
    })

    -- Close Button
    self.CloseButton = safeCreate("TextButton", {
        Name = "CloseButton",
        Parent = self.MainFrame,
        AnchorPoint = Vector2.new(1, 0),
        Position = UDim2.new(1, -10, 0, 10),
        Size = UDim2.new(0, 20, 0, 20),
        BackgroundTransparency = 1,
        Text = "X",
        TextColor3 = themes.Dark.SubText,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false
    })
    
    if self.CloseButton then
        self.CloseButton.MouseButton1Click:Connect(function()
            self:ToggleMenu()
        end)
    end
end

-- Input Handling
function Nova:SetupInput()
    if not self.IsMobile then
        local connection
        connection = UserInputService.InputBegan:Connect(function(input, processed)
            if not processed and input.KeyCode == self.Config.Keybind then
                self:ToggleMenu()
            end
        end)
        table.insert(self.Widgets, connection)
    end
end

-- Menu Control
function Nova:ToggleMenu()
    self.Open = not self.Open
    
    if self.Open then
        self.MainFrame.Visible = true
        self.MainFrame.Position = UDim2.new(0.5, 0, 0.5, -50)
        self.MainFrame.BackgroundTransparency = 1
        
        tween(self.MainFrame, {
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = self.Config.BackgroundTransparency
        }, 0.3, Enum.EasingStyle.Back)
        
        if self.MobileToggle then
            tween(self.MobileToggle, {BackgroundTransparency = 1}, 0.2)
        end
    else
        tween(self.MainFrame, {
            Position = UDim2.new(0.5, 0, 0.5, -50),
            BackgroundTransparency = 1
        }, 0.2, Enum.EasingStyle.Quad)
        
        task.wait(0.2)
        self.MainFrame.Visible = false
        
        if self.MobileToggle then
            tween(self.MobileToggle, {BackgroundTransparency = 0}, 0.2)
        end
    end
end

-- Section Management
function Nova:Section(name)
    local sectionId = #self.Sections + 1
    
    -- Create Tab Button
    local tabButton = safeCreate("TextButton", {
        Name = name .. "Tab",
        Parent = self.TabList,
        Size = UDim2.new(0, 80, 1, -10),
        BackgroundColor3 = themes.Dark.Surface,
        AutoButtonColor = false,
        Text = name,
        TextColor3 = themes.Dark.Text,
        Font = Enum.Font.GothamMedium,
        TextSize = 14
    })
    
    safeCreate("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = tabButton
    })
    
    -- Create Section Content
    local sectionFrame = safeCreate("Frame", {
        Name = name .. "Section",
        Parent = self.ContentFrame,
        Size = UDim2.new(1, -20, 0, 0),
        BackgroundTransparency = 1,
        Visible = sectionId == 1,
        LayoutOrder = sectionId
    })
    
    safeCreate("UIListLayout", {
        Parent = sectionFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 15)
    })
    
    safeCreate("UIPadding", {
        Parent = sectionFrame,
        PaddingBottom = UDim.new(0, 10)
    })

    if sectionId == 1 then
        self.CurrentSection = sectionFrame
        tabButton.BackgroundColor3 = self.Config.AccentColor
    end

    tabButton.MouseButton1Click:Connect(function()
        if self.CurrentSection then
            self.CurrentSection.Visible = false
        end
        
        for _, btn in ipairs(self.TabList:GetChildren()) do
            if btn:IsA("TextButton") then
                tween(btn, {BackgroundColor3 = themes.Dark.Surface})
            end
        end
        
        sectionFrame.Visible = true
        self.CurrentSection = sectionFrame
        tween(tabButton, {BackgroundColor3 = self.Config.AccentColor})
    end)

    table.insert(self.Sections, sectionFrame)
    
    local sectionAPI = {}
    
    -- Button Widget
    function sectionAPI:Button(name, callback)
        local button = safeCreate("TextButton", {
            Name = name,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = name,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextSize = 14,
            LayoutOrder = #self.CurrentSection:GetChildren()
        })
        
        if not button then return nil end
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = button
        })
        
        safeCreate("UIStroke", {
            Parent = button,
            Color = themes.Dark.Border,
            Thickness = 1
        })

        local originalColor = button.BackgroundColor3
        
        button.MouseEnter:Connect(function()
            tween(button, {BackgroundColor3 = originalColor:Lerp(self.Config.AccentColor, 0.3)})
        end)
        
        button.MouseLeave:Connect(function()
            tween(button, {BackgroundColor3 = originalColor})
        end)
        
        button.MouseButton1Click:Connect(function()
            if callback then
                pcall(callback)
            end
        end)
        
        return button
    end
    
    -- Toggle Widget
    function sectionAPI:Toggle(name, default, callback)
        local container = safeCreate("Frame", {
            Name = name,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 30),
            BackgroundTransparency = 1,
            LayoutOrder = #self.CurrentSection:GetChildren()
        })
        
        if not container then return nil end
        
        local label = safeCreate("TextLabel", {
            Parent = container,
            AnchorPoint = Vector2.new(0, 0.5),
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local toggleButton = safeCreate("TextButton", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0.5),
            Position = UDim2.new(1, 0, 0.5, 0),
            Size = UDim2.new(0, 50, 0, 25),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = ""
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = toggleButton
        })
        
        local toggleCircle = safeCreate("Frame", {
            Parent = toggleButton,
            AnchorPoint = Vector2.new(0, 0.5),
            Position = UDim2.new(0, 3, 0.5, 0),
            Size = UDim2.new(0, 19, 0, 19),
            BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = toggleCircle
        })
        
        local state = default or false
        
        local function updateToggle()
            if state then
                tween(toggleButton, {BackgroundColor3 = self.Config.AccentColor})
                tween(toggleCircle, {
                    Position = UDim2.new(1, -22, 0.5, 0),
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                })
            else
                tween(toggleButton, {BackgroundColor3 = themes.Dark.Surface})
                tween(toggleCircle, {
                    Position = UDim2.new(0, 3, 0.5, 0),
                    BackgroundColor3 = Color3.fromRGB(200, 200, 200)
                })
            end
        end
        
        updateToggle()
        
        toggleButton.MouseButton1Click:Connect(function()
            state = not state
            updateToggle()
            if callback then
                pcall(callback, state)
            end
        end)
        
        local toggleObj = {}
        
        function toggleObj:Set(value)
            if type(value) == "boolean" then
                state = value
                updateToggle()
            end
        end
        
        function toggleObj:Get()
            return state
        end
        
        return toggleObj
    end
    
    -- Slider Widget
    function sectionAPI:Slider(name, min, max, default, callback)
        local container = safeCreate("Frame", {
            Name = name,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 60),
            BackgroundTransparency = 1,
            LayoutOrder = #self.CurrentSection:GetChildren()
        })
        
        if not container then return nil end
        
        local label = safeCreate("TextLabel", {
            Parent = container,
            Size = UDim2.new(1, 0, 0, 20),
            BackgroundTransparency = 1,
            Text = string.format("%s: %d", name, default or min),
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local sliderTrack = safeCreate("Frame", {
            Parent = container,
            Position = UDim2.new(0, 0, 0, 25),
            Size = UDim2.new(1, 0, 0, 10),
            BackgroundColor3 = themes.Dark.Surface
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = sliderTrack
        })
        
        local sliderFill = safeCreate("Frame", {
            Parent = sliderTrack,
            Size = UDim2.new(0, 0, 1, 0),
            BackgroundColor3 = self.Config.AccentColor
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = sliderFill
        })
        
        local sliderButton = safeCreate("TextButton", {
            Parent = sliderTrack,
            AnchorPoint = Vector2.new(0.5, 0.5),
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0, 20, 0, 20),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            AutoButtonColor = false,
            Text = ""
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = sliderButton
        })
        
        local value = math.clamp(default or min, min, max)
        local isDragging = false
        
        local function updateSlider(mouseX)
            local absolutePosition = sliderTrack.AbsolutePosition
            local absoluteSize = sliderTrack.AbsoluteSize
            
            if absolutePosition and absoluteSize then
                local relativeX = math.clamp(mouseX - absolutePosition.X, 0, absoluteSize.X)
                local percentage = relativeX / absoluteSize.X
                value = math.floor(min + (max - min) * percentage)
                
                sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                sliderButton.Position = UDim2.new(percentage, 0, 0.5, 0)
                label.Text = string.format("%s: %d", name, value)
                
                if callback then
                    pcall(callback, value)
                end
            end
        end
        
        sliderButton.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = true
            end
        end)
        
        sliderButton.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = false
            end
        end)
        
        local connection
        connection = UserInputService.InputChanged:Connect(function(input)
            if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSlider(input.Position.X)
            end
        end)
        
        table.insert(self.Widgets, connection)
        
        -- Set initial value
        local initialPercentage = (value - min) / (max - min)
        sliderFill.Size = UDim2.new(initialPercentage, 0, 1, 0)
        sliderButton.Position = UDim2.new(initialPercentage, 0, 0.5, 0)
        
        local sliderObj = {}
        
        function sliderObj:Set(newValue)
            value = math.clamp(newValue, min, max)
            local percentage = (value - min) / (max - min)
            sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
            sliderButton.Position = UDim2.new(percentage, 0, 0.5, 0)
            label.Text = string.format("%s: %d", name, value)
        end
        
        function sliderObj:Get()
            return value
        end
        
        return sliderObj
    end
    
    -- Dropdown Widget
    function sectionAPI:Dropdown(name, options, callback)
        local container = safeCreate("Frame", {
            Name = name,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundTransparency = 1,
            LayoutOrder = #self.CurrentSection:GetChildren()
        })
        
        if not container then return nil end
        
        local label = safeCreate("TextLabel", {
            Parent = container,
            Size = UDim2.new(0.3, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local dropdownButton = safeCreate("TextButton", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundColor3 = themes.Dark.Surface,
            AutoButtonColor = false,
            Text = "Select...",
            TextColor3 = themes.Dark.SubText,
            Font = Enum.Font.GothamMedium,
            TextSize = 14
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = dropdownButton
        })
        
        local dropdownFrame = safeCreate("ScrollingFrame", {
            Parent = dropdownButton,
            Position = UDim2.new(0, 0, 1, 5),
            Size = UDim2.new(1, 0, 0, 150),
            BackgroundColor3 = themes.Dark.Surface,
            ScrollBarThickness = 4,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Visible = false,
            ZIndex = 10,
            BorderSizePixel = 0
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = dropdownFrame
        })
        
        safeCreate("UIListLayout", {
            Parent = dropdownFrame,
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        local selectedOption = nil
        
        local function updateOptions()
            for _, child in ipairs(dropdownFrame:GetChildren()) do
                if child:IsA("TextButton") then
                    child:Destroy()
                end
            end
            
            for _, option in ipairs(options) do
                local optionButton = safeCreate("TextButton", {
                    Parent = dropdownFrame,
                    Size = UDim2.new(1, -10, 0, 30),
                    BackgroundColor3 = themes.Dark.Surface,
                    AutoButtonColor = false,
                    Text = tostring(option),
                    TextColor3 = themes.Dark.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    LayoutOrder = _
                })
                
                safeCreate("UICorner", {
                    CornerRadius = UDim.new(0, 4),
                    Parent = optionButton
                })
                
                optionButton.MouseEnter:Connect(function()
                    tween(optionButton, {BackgroundColor3 = self.Config.AccentColor})
                end)
                
                optionButton.MouseLeave:Connect(function()
                    tween(optionButton, {BackgroundColor3 = themes.Dark.Surface})
                end)
                
                optionButton.MouseButton1Click:Connect(function()
                    selectedOption = option
                    dropdownButton.Text = tostring(option)
                    dropdownFrame.Visible = false
                    
                    if callback then
                        pcall(callback, option)
                    end
                end)
            end
        end
        
        dropdownButton.MouseButton1Click:Connect(function()
            dropdownFrame.Visible = not dropdownFrame.Visible
        end)
        
        updateOptions()
        
        local dropdownObj = {}
        
        function dropdownObj:SetOptions(newOptions)
            if type(newOptions) == "table" then
                options = newOptions
                updateOptions()
            end
        end
        
        function dropdownObj:Set(option)
            selectedOption = option
            dropdownButton.Text = tostring(option)
        end
        
        function dropdownObj:Get()
            return selectedOption
        end
        
        return dropdownObj
    end
    
    -- Simple Textbox
    function sectionAPI:Textbox(name, placeholder, callback)
        local container = safeCreate("Frame", {
            Name = name,
            Parent = self.CurrentSection,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundTransparency = 1,
            LayoutOrder = #self.CurrentSection:GetChildren()
        })
        
        if not container then return nil end
        
        local label = safeCreate("TextLabel", {
            Parent = container,
            Size = UDim2.new(0.3, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.GothamMedium,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextSize = 14
        })
        
        local textbox = safeCreate("TextBox", {
            Parent = container,
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Size = UDim2.new(0.7, 0, 1, 0),
            BackgroundColor3 = themes.Dark.Surface,
            PlaceholderText = placeholder or "Enter text...",
            Text = "",
            TextColor3 = themes.Dark.Text,
            Font = Enum.Font.Gotham,
            TextSize = 14,
            ClearTextOnFocus = false
        })
        
        safeCreate("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = textbox
        })
        
        safeCreate("UIStroke", {
            Parent = textbox,
            Color = themes.Dark.Border,
            Thickness = 1
        })
        
        if callback then
            textbox.FocusLost:Connect(function()
                pcall(callback, textbox.Text)
            end)
        end
        
        return textbox
    end
    
    return sectionAPI
end

-- Settings Section
function Nova:SetupSettings()
    local settings = self:Section("Settings")
    
    -- Theme Dropdown
    local themeDropdown = settings:Dropdown("Theme", {"Dark", "Light"}, function(theme)
        self.Config.Theme = theme
        self:ApplyTheme()
        self:SaveConfig()
    end)
    
    if themeDropdown then
        themeDropdown:Set(self.Config.Theme)
    end
    
    -- Accent Color Slider
    settings:Slider("Accent R", 0, 255, math.floor(self.Config.AccentColor.R * 255), function(r)
        self.Config.AccentColor = Color3.fromRGB(r, 
            math.floor(self.Config.AccentColor.G * 255), 
            math.floor(self.Config.AccentColor.B * 255))
        self:ApplyTheme()
        self:SaveConfig()
    end)
    
    -- Keybind Button
    settings:Button("Keybind: " .. tostring(self.Config.Keybind.Name), function()
        print("Press any key to set new keybind...")
        -- Keybind setting logic would go here
    end)
    
    -- Reset Button
    settings:Button("Reset to Defaults", function()
        self.Config = table.clone(DEFAULT_CONFIG)
        self:ApplyTheme()
        self:SaveConfig()
        print("Settings reset to defaults")
    end)
    
    -- Info Button
    settings:Button("Nova UI v" .. self.Version, function()
        print("Nova UI Library v" .. self.Version .. " by Nova Team")
    end)
end

-- Configuration Management
function Nova:LoadConfig()
    -- In a real implementation, you would load from DataStore or file
    -- For now, just apply default theme
    self:ApplyTheme()
end

function Nova:SaveConfig()
    -- Save configuration implementation
    if Nova.Debug then
        print("[Nova UI] Config saved")
    end
end

function Nova:ApplyTheme()
    local theme = themes[self.Config.Theme] or themes.Dark
    
    -- Apply theme colors to main elements
    if self.MainFrame then
        self.MainFrame.BackgroundColor3 = theme.Background
    end
    
    if self.TopBar then
        self.TopBar.BackgroundColor3 = theme.Surface
    end
    
    -- More theme application logic...
end

-- Console System (based on your image)
function Nova:CreateConsole(title, getLogsFunction)
    local console = self:Section(title)
    
    -- Search bar
    console:Textbox("Search", "Search logs...", function(text)
        -- Filter logs based on search text
    end)
    
    -- Log display area (simplified)
    local logs = getLogsFunction and getLogsFunction() or {}
    for _, log in ipairs(logs) do
        console:Button(log, function()
            -- Show log details
        end)
    end
    
    -- Clear button
    console:Button("Clear", function()
        -- Clear logs
    end)
end

-- Cleanup
function Nova:Destroy()
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
    
    for _, connection in ipairs(self.Widgets) do
        if typeof(connection) == "RBXScriptConnection" then
            connection:Disconnect()
        end
    end
    
    for k in pairs(self) do
        self[k] = nil
    end
end

return Nova
