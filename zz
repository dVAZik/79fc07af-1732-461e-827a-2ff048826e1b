-- Auto Optimizer Pro v7.0 - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–æ–π
-- –ê–≤—Ç–æ—Ä: AI Assistant
-- –í–µ—Ä—Å–∏—è: 7.0 (–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∏–≥—Ä–æ–π + 5-6‚≠ê —Ñ–∏–ª—å—Ç—Ä)

-- –ü–æ–ª—É—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
local Portfolio = require(game:GetService("ReplicatedStorage").Modules.Game.PortfolioController)
local Building = require(game:GetService("ReplicatedStorage").Modules.Data.Building)
local PlayerDataClient = require(game:GetService("ReplicatedStorage").Modules.PlayerDataClient)
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- –ü—É—Ç–∏ –∫ RemoteEvents –∏ Functions
local NetworkPath = game:GetService("ReplicatedStorage").Modules.NetworkClient

-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¢–û–õ–¨–ö–û 5-6 –∑–≤–µ–∑–¥—ã)
local MIN_STARS_FOR_REPLACEMENT = 5  -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã –¥–ª—è –∑–∞–º–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
local MIN_STARS_FOR_NEW = 5         -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
local MAX_STARS = 6                 -- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥
local CHECK_INTERVAL = 5           -- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (5 —Å–µ–∫—É–Ω–¥)
local AUTO_DENY_BAD_APPLICANTS = true
local AUTO_ACCEPT_GOOD_APPLICANTS = true
local AGGRESSIVE_REPLACEMENT = true
local PRIORITIZE_HIGHER_STARS = true
local ONLY_5_6_STARS = true         -- –¢–æ–ª—å–∫–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã —Å 5-6 –∑–≤–µ–∑–¥–∞–º–∏

-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local isRunning = false
local isGUIVisible = true
local cycleCount = 0
local processedRenters = {}
local processedApplicants = {}
local lastUpdateTime = 0
local guiElements = {}
local dataUpdateConnection = nil

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
local statsData = {
    -- –ü–æ—Ä—Ç—Ñ–µ–ª—å
    totalProperties = 0,
    totalValue = 0,
    totalIncome = 0,
    totalExpenses = 0,
    netProfit = 0,
    
    -- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
    totalRenters = 0,
    occupiedSpots = 0,
    totalSpots = 0,
    occupancyRate = 0,
    averageStars = 0,
    fiveStarRenters = 0,
    sixStarRenters = 0,
    
    -- –î–µ–Ω—å–≥–∏
    cashBalance = 0,
    bankBalance = 0,
    bankToCollect = 0,
    totalBankDeposits = 0,
    sessionProfit = 0,
    
    -- –ó–¥–∞–Ω–∏—è
    buildingTypes = {},
    totalBuildings = 0,
    underConstruction = 0,
    
    -- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    totalReplacements = 0,
    totalAccepted = 0,
    totalEvicted = 0,
    totalStarsImproved = 0,
    lastOptimizationTime = 0,
    cycleTime = 0
}

-- –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª
local function formatNumber(num)
    if not num then return "0" end
    num = tonumber(num) or 0
    
    if num >= 1000000000000 then
        return string.format("%.2fT", num / 1000000000000)
    elseif num >= 1000000000 then
        return string.format("%.2fB", num / 1000000000)
    elseif num >= 1000000 then
        return string.format("%.2fM", num / 1000000)
    elseif num >= 1000 then
        return string.format("%.2fK", num / 1000)
    else
        return string.format("%.0f", num)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
local function log(message, type)
    local timestamp = os.date("%H:%M:%S")
    local formattedMessage = string.format("[%s] %s", timestamp, message)
    
    print(string.format("[AutoOptimizer] %s", message))
    
    if _G.GUILogger then
        _G.GUILogger(formattedMessage, type)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏–≥—Ä—ã
local function updateGameData()
    pcall(function()
        -- –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
        statsData.cashBalance = PlayerDataClient.Get("Cash") or 0
        statsData.bankBalance = PlayerDataClient.Get("BankBalance") or 0
        statsData.bankToCollect = PlayerDataClient.Get("BankToCollect") or 0
        
        -- –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª—å
        local portfolio = Portfolio.GetPortfolio() or {}
        local totalProperties = 0
        local totalValue = 0
        local totalIncome = 0
        local totalExpenses = 0
        local totalRenters = 0
        local occupiedSpots = 0
        local totalSpots = 0
        local totalStars = 0
        local fiveStarCount = 0
        local sixStarCount = 0
        local buildingTypes = {}
        
        for propertyUID, property in pairs(portfolio) do
            if property and property.BuildingType and property.BuildingType ~= "Empty" then
                totalProperties = totalProperties + 1
                totalValue = totalValue + (property.Value or 0)
                totalIncome = totalIncome + (property.Income or 0)
                totalExpenses = totalExpenses + (property.Expenses or 0)
                
                -- –ü–æ–¥—Å—á–µ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
                if property.Renters then
                    for renterId, renter in pairs(property.Renters) do
                        totalRenters = totalRenters + 1
                        local stars = renter.Stars or 1
                        totalStars = totalStars + stars
                        
                        if stars == 5 then
                            fiveStarCount = fiveStarCount + 1
                        elseif stars == 6 then
                            sixStarCount = sixStarCount + 1
                        end
                    end
                end
                
                -- –ü–æ–¥—Å—á–µ—Ç –º–µ—Å—Ç
                local buildingData = Building[property.BuildingType]
                if buildingData then
                    local spots = buildingData.Spots or 0
                    if property.Built then
                        for _, upgrade in ipairs(property.Built) do
                            if upgrade ~= "Main" and buildingData.Upgrades and buildingData.Upgrades[upgrade] then
                                spots = spots + (buildingData.Upgrades[upgrade].AddedRenters or 0)
                            end
                        end
                    end
                    totalSpots = totalSpots + spots
                    
                    -- –°—á–∏—Ç–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞
                    if property.Renters then
                        occupiedSpots = occupiedSpots + (table.getn(property.Renters) or 0)
                    end
                end
                
                -- –¢–∏–ø—ã –∑–¥–∞–Ω–∏–π
                local buildingType = property.BuildingType
                buildingTypes[buildingType] = (buildingTypes[buildingType] or 0) + 1
            end
        end
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        statsData.totalProperties = totalProperties
        statsData.totalValue = totalValue
        statsData.totalIncome = totalIncome
        statsData.totalExpenses = totalExpenses
        statsData.netProfit = totalIncome - totalExpenses
        statsData.totalRenters = totalRenters
        statsData.occupiedSpots = occupiedSpots
        statsData.totalSpots = totalSpots
        statsData.occupancyRate = totalSpots > 0 and (occupiedSpots / totalSpots * 100) or 0
        statsData.averageStars = totalRenters > 0 and (totalStars / totalRenters) or 0
        statsData.fiveStarRenters = fiveStarCount
        statsData.sixStarRenters = sixStarCount
        statsData.buildingTypes = buildingTypes
        statsData.totalBuildings = totalProperties
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º GUI
        updateGUI()
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è GUI
local function updateGUI()
    if not guiElements.initialized then return end
    
    pcall(function()
        -- –î–µ–Ω—å–≥–∏
        if guiElements.cashLabel then
            guiElements.cashLabel.Text = string.format("$%s", formatNumber(statsData.cashBalance))
        end
        if guiElements.bankLabel then
            guiElements.bankLabel.Text = string.format("$%s", formatNumber(statsData.bankBalance))
        end
        if guiElements.bankToCollectLabel then
            guiElements.bankToCollectLabel.Text = string.format("$%s", formatNumber(statsData.bankToCollect))
        end
        if guiElements.totalIncomeLabel then
            guiElements.totalIncomeLabel.Text = string.format("$%s/—á–∞—Å", formatNumber(statsData.totalIncome))
        end
        if guiElements.netProfitLabel then
            guiElements.netProfitLabel.Text = string.format("$%s/—á–∞—Å", formatNumber(statsData.netProfit))
        end
        
        -- –ü–æ—Ä—Ç—Ñ–µ–ª—å
        if guiElements.propertiesLabel then
            guiElements.propertiesLabel.Text = tostring(statsData.totalProperties)
        end
        if guiElements.totalValueLabel then
            guiElements.totalValueLabel.Text = string.format("$%s", formatNumber(statsData.totalValue))
        end
        if guiElements.occupancyLabel then
            guiElements.occupancyLabel.Text = string.format("%.1f%%", statsData.occupancyRate)
        end
        
        -- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
        if guiElements.totalRentersLabel then
            guiElements.totalRentersLabel.Text = tostring(statsData.totalRenters)
        end
        if guiElements.averageStarsLabel then
            guiElements.averageStarsLabel.Text = string.format("%.1f", statsData.averageStars)
        end
        if guiElements.fiveStarLabel then
            guiElements.fiveStarLabel.Text = tostring(statsData.fiveStarRenters)
        end
        if guiElements.sixStarLabel then
            guiElements.sixStarLabel.Text = tostring(statsData.sixStarRenters)
        end
        if guiElements.occupiedSpotsLabel then
            guiElements.occupiedSpotsLabel.Text = string.format("%d/%d", statsData.occupiedSpots, statsData.totalSpots)
        end
        
        -- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
        if guiElements.replacementsLabel then
            guiElements.replacementsLabel.Text = tostring(statsData.totalReplacements)
        end
        if guiElements.acceptedLabel then
            guiElements.acceptedLabel.Text = tostring(statsData.totalAccepted)
        end
        if guiElements.evictedLabel then
            guiElements.evictedLabel.Text = tostring(statsData.totalEvicted)
        end
        if guiElements.cycleCountLabel then
            guiElements.cycleCountLabel.Text = tostring(cycleCount)
        end
        
        -- –í—Ä–µ–º—è
        if guiElements.lastUpdateLabel then
            local timeDiff = os.time() - lastUpdateTime
            local minutes = math.floor(timeDiff / 60)
            local seconds = timeDiff % 60
            guiElements.lastUpdateLabel.Text = string.format("%d:%02d", minutes, seconds)
        end
    end)
end

-- –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Å—Ç –≤ –∑–¥–∞–Ω–∏–∏
local function calculateTotalSpots(property)
    if not property or property.BuildingType == "Empty" then return 0 end
    
    local buildingData = Building[property.BuildingType]
    if not buildingData then return 0 end
    
    local totalSpots = buildingData.Spots or 0
    
    if property.Built then
        for _, upgrade in ipairs(property.Built) do
            if upgrade ~= "Main" and buildingData.Upgrades and buildingData.Upgrades[upgrade] then
                totalSpots = totalSpots + (buildingData.Upgrades[upgrade].AddedRenters or 0)
            end
        end
    end
    
    return totalSpots
end

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–≤–µ–∑–¥ (—Ç–æ–ª—å–∫–æ 5-6)
local function isValidStars(stars)
    if not stars then return false end
    return stars >= 5 and stars <= 6
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ (—Ç–æ–ª—å–∫–æ 5-6 –∑–≤–µ–∑–¥—ã)
local function getAllApplicantsSorted(propertyUID)
    if not propertyUID then return {} end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or not property.Applicants then return {} end
    
    local applicants = {}
    
    for applicantId, applicant in pairs(property.Applicants) do
        if applicantId and applicant then
            local cacheKey = propertyUID .. "_" .. applicantId
            if not processedApplicants[cacheKey] then
                local stars = applicant.Stars or 1
                if isValidStars(stars) then
                    table.insert(applicants, {
                        id = applicantId,
                        stars = stars,
                        data = applicant
                    })
                end
            end
        end
    end
    
    -- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–≤–µ–∑–¥–∞–º (6‚≠ê —Å–Ω–∞—á–∞–ª–∞)
    if #applicants > 0 then
        table.sort(applicants, function(a, b)
            if a.stars ~= b.stars then
                return a.stars > b.stars
            end
            return a.id < b.id
        end)
    end
    
    return applicants
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
local function getAllRentersSorted(propertyUID)
    if not propertyUID then return {} end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or not property.Renters then return {} end
    
    local renters = {}
    
    for renterId, renter in pairs(property.Renters) do
        if renterId and renter then
            local cacheKey = propertyUID .. "_" .. renterId
            if not processedRenters[cacheKey] then
                local stars = renter.Stars or 1
                if isValidStars(stars) then
                    table.insert(renters, {
                        id = renterId,
                        stars = stars,
                        data = renter
                    })
                end
            end
        end
    end
    
    -- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–≤–µ–∑–¥–∞–º (—Å–Ω–∞—á–∞–ª–∞ —Ö—É–¥—à–∏–µ)
    if #renters > 0 then
        table.sort(renters, function(a, b)
            return a.stars < b.stars
        end)
    end
    
    return renters
end

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
local function acceptApplicant(propertyUID, applicantId)
    if not propertyUID or not applicantId then return false, "Invalid params" end
    
    local args = {[1] = propertyUID, [2] = applicantId}
    local success, result = pcall(function()
        return NetworkPath.FunctionMap.Tenancy.SelectTenant:InvokeServer(unpack(args))
    end)
    
    if success then
        processedApplicants[propertyUID .. "_" .. applicantId] = true
        statsData.totalAccepted = statsData.totalAccepted + 1
        return true, "Accepted"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –≤—ã—Å–µ–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
local function evictRenter(propertyUID, renterId)
    if not propertyUID or not renterId then return false, "Invalid params" end
    
    local args = {[1] = propertyUID, [2] = renterId}
    local success, result = pcall(function()
        return NetworkPath.FunctionMap.Tenancy.Evict:InvokeServer(unpack(args))
    end)
    
    if success then
        processedRenters[propertyUID .. "_" .. renterId] = true
        statsData.totalEvicted = statsData.totalEvicted + 1
        return true, "Evicted"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
local function denyApplicant(propertyUID, applicantId)
    if not propertyUID or not applicantId then return false, "Invalid params" end
    
    local args = {[1] = propertyUID, [2] = applicantId}
    local success, result = pcall(function()
        return NetworkPath.EventMap.DenyApplicant:FireServer(unpack(args))
    end)
    
    if success then
        processedApplicants[propertyUID .. "_" .. applicantId] = true
        return true, "Denied"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–¥–∞–Ω–∏—è
local function optimizeProperty(propertyUID)
    if not propertyUID then return "error" end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or property.BuildingType == "Empty" then return "skip_empty" end
    
    local totalSpots = calculateTotalSpots(property)
    local currentRenters = getAllRentersSorted(propertyUID)
    local currentApplicants = getAllApplicantsSorted(propertyUID)
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞
    if #currentRenters < totalSpots and #currentApplicants > 0 then
        local spotsToFill = totalSpots - #currentRenters
        local filled = 0
        
        for i = 1, math.min(spotsToFill, #currentApplicants) do
            local applicant = currentApplicants[i]
            if applicant and applicant.stars >= MIN_STARS_FOR_NEW then
                local success, msg = acceptApplicant(propertyUID, applicant.id)
                if success then
                    filled = filled + 1
                    log(string.format("%s: –ü—Ä–∏–Ω—è—Ç %d‚≠ê", propertyUID, applicant.stars), "hire")
                    task.wait(0.3)
                end
            end
        end
        
        if filled > 0 then
            return string.format("filled|%d", filled)
        end
    end
    
    -- –ó–∞–º–µ–Ω—è–µ–º –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –ª—É—á—à–∏—Ö
    if #currentRenters > 0 and #currentApplicants > 0 then
        local replaced = 0
        
        for _, renter in ipairs(currentRenters) do
            for _, applicant in ipairs(currentApplicants) do
                if applicant.stars > renter.stars then
                    -- –í—ã—Å–µ–ª—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ
                    local success1, msg1 = evictRenter(propertyUID, renter.id)
                    if success1 then
                        task.wait(0.5)
                        
                        -- –ü—Ä–∏–Ω–∏–º–∞–µ–º –Ω–æ–≤–æ–≥–æ
                        local success2, msg2 = acceptApplicant(propertyUID, applicant.id)
                        if success2 then
                            replaced = replaced + 1
                            statsData.totalReplacements = statsData.totalReplacements + 1
                            statsData.totalStarsImproved = statsData.totalStarsImproved + (applicant.stars - renter.stars)
                            
                            log(string.format("%s: –ó–∞–º–µ–Ω–∞ %d‚≠ê ‚Üí %d‚≠ê", 
                                propertyUID, renter.stars, applicant.stars), "spot")
                            
                            task.wait(0.3)
                            break
                        end
                    end
                end
            end
        end
        
        if replaced > 0 then
            return string.format("replaced|%d", replaced)
        end
    end
    
    -- –û—Ç–∫–ª–æ–Ω—è–µ–º –ø–ª–æ—Ö–∏—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    if AUTO_DENY_BAD_APPLICANTS then
        local denied = 0
        for applicantId, applicant in pairs(property.Applicants or {}) do
            local stars = applicant.Stars or 1
            if stars < 5 then
                local success, msg = denyApplicant(propertyUID, applicantId)
                if success then
                    denied = denied + 1
                end
            end
        end
        
        if denied > 0 then
            return string.format("denied|%d", denied)
        end
    end
    
    return "no_changes"
end

-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function optimizeAllProperties()
    local cycleStartTime = tick()
    cycleCount = cycleCount + 1
    
    log(string.format("–¶–ò–ö–õ #%d - –¢–û–õ–¨–ö–û 5-6‚≠ê", cycleCount), "info")
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    updateGameData()
    
    local optimizedCount = 0
    local totalFilled = 0
    local totalReplaced = 0
    
    -- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –∑–¥–∞–Ω–∏—è
    local portfolio = Portfolio.GetPortfolio() or {}
    for propertyUID, property in pairs(portfolio) do
        if property and property.BuildingType and property.BuildingType ~= "Empty" then
            local result = optimizeProperty(propertyUID)
            
            if result:find("filled|") then
                local filled = tonumber(result:match("filled|(%d+)")) or 0
                optimizedCount = optimizedCount + 1
                totalFilled = totalFilled + filled
            elseif result:find("replaced|") then
                local replaced = tonumber(result:match("replaced|(%d+)")) or 0
                optimizedCount = optimizedCount + 1
                totalReplaced = totalReplaced + replaced
            end
            
            task.wait(0.1)
        end
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    statsData.cycleTime = tick() - cycleStartTime
    statsData.lastOptimizationTime = os.time()
    lastUpdateTime = os.time()
    
    -- –õ–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    if totalFilled > 0 then
        log(string.format("–ó–∞–ø–æ–ª–Ω–µ–Ω–æ: %d –º–µ—Å—Ç", totalFilled), "success")
    end
    if totalReplaced > 0 then
        log(string.format("–ó–∞–º–µ–Ω–µ–Ω–æ: %d –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤", totalReplaced), "spot")
    end
    if optimizedCount == 0 then
        log("–í—Å–µ –∑–¥–∞–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã", "info")
    end
    
    updateGUI()
    
    return optimizedCount
end

-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ GUI
local function createModernGUI()
    local PlayerGui = Player:WaitForChild("PlayerGui")
    
    -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π GUI
    local oldGUI = PlayerGui:FindFirstChild("AutoOptimizerPro")
    if oldGUI then oldGUI:Destroy() end
    
    -- –°–æ–∑–¥–∞–µ–º ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "AutoOptimizerPro"
    ScreenGui.Parent = PlayerGui
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    local MainContainer = Instance.new("Frame")
    MainContainer.Size = UDim2.new(0.4, 0, 0.8, 0)
    MainContainer.Position = UDim2.new(0.6, 0, 0.1, 0)
    MainContainer.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
    MainContainer.BackgroundTransparency = 0.05
    MainContainer.BorderSizePixel = 0
    MainContainer.ClipsDescendants = true
    MainContainer.Parent = ScreenGui
    
    -- –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤
    local ContainerCorner = Instance.new("UICorner")
    ContainerCorner.CornerRadius = UDim.new(0, 12)
    ContainerCorner.Parent = MainContainer
    
    -- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å
    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    TopBar.BorderSizePixel = 0
    TopBar.Parent = MainContainer
    
    local TopBarCorner = Instance.new("UICorner")
    TopBarCorner.CornerRadius = UDim.new(0, 12)
    TopBarCorner.Parent = TopBar
    
    -- –ó–∞–≥–æ–ª–æ–≤–æ–∫
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.6, 0, 1, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "‚ö° OPTIMIZER PRO v7.0"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = TopBar
    
    local TitlePadding = Instance.new("UIPadding")
    TitlePadding.PaddingLeft = UDim.new(0, 15)
    TitlePadding.Parent = Title
    
    -- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è GUI
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 40, 0, 40)
    CloseButton.Position = UDim2.new(1, -45, 0.5, -20)
    CloseButton.BackgroundTransparency = 1
    CloseButton.Text = "‚úï"
    CloseButton.TextColor3 = Color3.fromRGB(255, 100, 100)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 20
    CloseButton.Parent = TopBar
    
    local MinimizeButton = Instance.new("TextButton")
    MinimizeButton.Size = UDim2.new(0, 40, 0, 40)
    MinimizeButton.Position = UDim2.new(1, -90, 0.5, -20)
    MinimizeButton.BackgroundTransparency = 1
    MinimizeButton.Text = "üóï"
    MinimizeButton.TextColor3 = Color3.fromRGB(200, 200, 255)
    MinimizeButton.Font = Enum.Font.GothamBold
    MinimizeButton.TextSize = 16
    MinimizeButton.Parent = TopBar
    
    -- –°—Ç–∞—Ç—É—Å
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(0.3, 0, 1, 0)
    StatusLabel.Position = UDim2.new(0.65, 0, 0, 0)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "‚èπ –°–¢–û–ü"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    StatusLabel.Font = Enum.Font.GothamBold
    StatusLabel.TextSize = 14
    StatusLabel.TextXAlignment = Enum.TextXAlignment.Right
    StatusLabel.Parent = TopBar
    
    guiElements.statusLabel = StatusLabel
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (ScrollingFrame)
    local MainScroll = Instance.new("ScrollingFrame")
    MainScroll.Size = UDim2.new(1, 0, 1, -60)
    MainScroll.Position = UDim2.new(0, 0, 0, 50)
    MainScroll.BackgroundTransparency = 1
    MainScroll.BorderSizePixel = 0
    MainScroll.ScrollBarThickness = 4
    MainScroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
    MainScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    MainScroll.Parent = MainContainer
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.Padding = UDim.new(0, 10)
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContentLayout.Parent = MainScroll
    
    -- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∫—Ü–∏–∏
    local function createSection(title, height)
        local section = Instance.new("Frame")
        section.Size = UDim2.new(1, -20, 0, height)
        section.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
        section.BorderSizePixel = 0
        section.LayoutOrder = 1
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = section
        
        local sectionTitle = Instance.new("TextLabel")
        sectionTitle.Size = UDim2.new(1, 0, 0, 30)
        sectionTitle.BackgroundTransparency = 1
        sectionTitle.Text = "  " .. title
        sectionTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        sectionTitle.Font = Enum.Font.GothamBold
        sectionTitle.TextSize = 16
        sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
        sectionTitle.Parent = section
        
        return section
    end
    
    -- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    local function createDataCard(parent, label, value, isMoney, layoutOrder)
        local card = Instance.new("Frame")
        card.Size = UDim2.new(0.48, -5, 0, 40)
        card.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        card.BorderSizePixel = 0
        card.LayoutOrder = layoutOrder
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = card
        
        local labelText = Instance.new("TextLabel")
        labelText.Size = UDim2.new(0.6, -5, 1, 0)
        labelText.Position = UDim2.new(0, 10, 0, 0)
        labelText.BackgroundTransparency = 1
        labelText.Text = label
        labelText.TextColor3 = Color3.fromRGB(200, 210, 230)
        labelText.Font = Enum.Font.Gotham
        labelText.TextSize = 12
        labelText.TextXAlignment = Enum.TextXAlignment.Left
        labelText.Parent = card
        
        local valueText = Instance.new("TextLabel")
        valueText.Size = UDim2.new(0.4, 0, 1, 0)
        valueText.Position = UDim2.new(0.6, 0, 0, 0)
        valueText.BackgroundTransparency = 1
        valueText.Text = isMoney and "$0" or "0"
        valueText.TextColor3 = isMoney and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 255, 200)
        valueText.Font = Enum.Font.GothamBold
        valueText.TextSize = 14
        valueText.TextXAlignment = Enum.TextXAlignment.Right
        valueText.Parent = card
        
        local padding = Instance.new("UIPadding")
        padding.PaddingRight = UDim.new(0, 10)
        padding.Parent = valueText
        
        card.Parent = parent
        
        return valueText
    end
    
    -- –°–µ–∫—Ü–∏—è: –î–ï–ù–¨–ì–ò
    local moneySection = createSection("üí∞ –î–ï–ù–¨–ì–ò", 140)
    moneySection.Parent = MainScroll
    
    local moneyGrid = Instance.new("Frame")
    moneyGrid.Size = UDim2.new(1, -20, 1, -40)
    moneyGrid.Position = UDim2.new(0, 10, 0, 35)
    moneyGrid.BackgroundTransparency = 1
    moneyGrid.Parent = moneySection
    
    local moneyLayout = Instance.new("UIGridLayout")
    moneyLayout.CellSize = UDim2.new(0.5, -5, 0, 40)
    moneyLayout.CellPadding = UDim2.new(0, 10, 0, 10)
    moneyLayout.StartCorner = Enum.StartCorner.TopLeft
    moneyLayout.Parent = moneyGrid
    
    guiElements.cashLabel = createDataCard(moneyGrid, "–ù–∞–ª–∏—á–Ω—ã–µ:", "0", true, 1)
    guiElements.bankLabel = createDataCard(moneyGrid, "–ë–∞–Ω–∫:", "0", true, 2)
    guiElements.bankToCollectLabel = createDataCard(moneyGrid, "–ë–∞–Ω–∫ %:", "0", true, 3)
    guiElements.totalIncomeLabel = createDataCard(moneyGrid, "–î–æ—Ö–æ–¥/—á–∞—Å:", "0", true, 4)
    guiElements.netProfitLabel = createDataCard(moneyGrid, "–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:", "0", true, 5)
    
    -- –°–µ–∫—Ü–∏—è: –ü–û–†–¢–§–ï–õ–¨
    local portfolioSection = createSection("üè¢ –ü–û–†–¢–§–ï–õ–¨", 140)
    portfolioSection.Parent = MainScroll
    
    local portfolioGrid = Instance.new("Frame")
    portfolioGrid.Size = UDim2.new(1, -20, 1, -40)
    portfolioGrid.Position = UDim2.new(0, 10, 0, 35)
    portfolioGrid.BackgroundTransparency = 1
    portfolioGrid.Parent = portfolioSection
    
    local portfolioLayout = Instance.new("UIGridLayout")
    portfolioLayout.CellSize = UDim2.new(0.5, -5, 0, 40)
    portfolioLayout.CellPadding = UDim2.new(0, 10, 0, 10)
    portfolioLayout.StartCorner = Enum.StartCorner.TopLeft
    portfolioLayout.Parent = portfolioGrid
    
    guiElements.propertiesLabel = createDataCard(portfolioGrid, "–û–±—ä–µ–∫—Ç—ã:", "0", false, 1)
    guiElements.totalValueLabel = createDataCard(portfolioGrid, "–°—Ç–æ–∏–º–æ—Å—Ç—å:", "0", true, 2)
    guiElements.occupiedSpotsLabel = createDataCard(portfolioGrid, "–ó–∞–Ω—è—Ç–æ:", "0/0", false, 3)
    guiElements.occupancyLabel = createDataCard(portfolioGrid, "–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å:", "0%", false, 4)
    
    -- –°–µ–∫—Ü–∏—è: –ê–†–ï–ù–î–ê–¢–û–†–´
    local rentersSection = createSection("üë• –ê–†–ï–ù–î–ê–¢–û–†–´ (5-6‚≠ê)", 180)
    rentersSection.Parent = MainScroll
    
    local rentersGrid = Instance.new("Frame")
    rentersGrid.Size = UDim2.new(1, -20, 1, -40)
    rentersGrid.Position = UDim2.new(0, 10, 0, 35)
    rentersGrid.BackgroundTransparency = 1
    rentersGrid.Parent = rentersSection
    
    local rentersLayout = Instance.new("UIGridLayout")
    rentersLayout.CellSize = UDim2.new(0.5, -5, 0, 40)
    rentersLayout.CellPadding = UDim2.new(0, 10, 0, 10)
    rentersLayout.StartCorner = Enum.StartCorner.TopLeft
    rentersLayout.Parent = rentersGrid
    
    guiElements.totalRentersLabel = createDataCard(rentersGrid, "–í—Å–µ–≥–æ:", "0", false, 1)
    guiElements.averageStarsLabel = createDataCard(rentersGrid, "–°—Ä. –∑–≤–µ–∑–¥—ã:", "0.0", false, 2)
    guiElements.fiveStarLabel = createDataCard(rentersGrid, "5‚≠ê:", "0", false, 3)
    guiElements.sixStarLabel = createDataCard(rentersGrid, "6‚≠ê:", "0", false, 4)
    
    -- –°–µ–∫—Ü–∏—è: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø
    local optimSection = createSection("‚öôÔ∏è –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø", 140)
    optimSection.Parent = MainScroll
    
    local optimGrid = Instance.new("Frame")
    optimGrid.Size = UDim2.new(1, -20, 1, -40)
    optimGrid.Position = UDim2.new(0, 10, 0, 35)
    optimGrid.BackgroundTransparency = 1
    optimGrid.Parent = optimSection
    
    local optimLayout = Instance.new("UIGridLayout")
    optimLayout.CellSize = UDim2.new(0.5, -5, 0, 40)
    optimLayout.CellPadding = UDim2.new(0, 10, 0, 10)
    optimLayout.StartCorner = Enum.StartCorner.TopLeft
    optimLayout.Parent = optimGrid
    
    guiElements.replacementsLabel = createDataCard(optimGrid, "–ó–∞–º–µ–Ω—ã:", "0", false, 1)
    guiElements.acceptedLabel = createDataCard(optimGrid, "–ü—Ä–∏–Ω—è—Ç–æ:", "0", false, 2)
    guiElements.evictedLabel = createDataCard(optimGrid, "–í—ã—Å–µ–ª–µ–Ω–æ:", "0", false, 3)
    guiElements.cycleCountLabel = createDataCard(optimGrid, "–¶–∏–∫–ª—ã:", "0", false, 4)
    guiElements.lastUpdateLabel = createDataCard(optimGrid, "–û–±–Ω–æ–≤–ª–µ–Ω–æ:", "0:00", false, 5)
    
    -- –°–µ–∫—Ü–∏—è: –£–ü–†–ê–í–õ–ï–ù–ò–ï
    local controlSection = createSection("üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï", 220)
    controlSection.Parent = MainScroll
    
    local controlGrid = Instance.new("Frame")
    controlGrid.Size = UDim2.new(1, -20, 1, -40)
    controlGrid.Position = UDim2.new(0, 10, 0, 35)
    controlGrid.BackgroundTransparency = 1
    controlGrid.Parent = controlSection
    
    local controlLayout = Instance.new("UIGridLayout")
    controlLayout.CellSize = UDim2.new(1, 0, 0, 50)
    controlLayout.CellPadding = UDim2.new(0, 0, 0, 10)
    controlLayout.StartCorner = Enum.StartCorner.TopLeft
    controlLayout.Parent = controlGrid
    
    -- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local function createControlButton(text, color, callback)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 50)
        button.BackgroundColor3 = color
        button.Text = text
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.Font = Enum.Font.GothamBold
        button.TextSize = 16
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = button
        
        button.MouseButton1Click:Connect(function()
            if callback then
                task.spawn(callback)
            end
        end)
        
        return button
    end
    
    -- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local startButton = createControlButton("üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Æ", Color3.fromRGB(0, 180, 0), function()
        if not isRunning then
            task.spawn(startAutoOptimizer)
        end
    end)
    startButton.Parent = controlGrid
    
    local stopButton = createControlButton("‚èπ –û–°–¢–ê–ù–û–í–ò–¢–¨", Color3.fromRGB(220, 0, 0), stopOptimizer)
    stopButton.Parent = controlGrid
    
    local quickButton = createControlButton("‚ö° –ë–´–°–¢–†–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø", Color3.fromRGB(255, 150, 0), quickOptimize)
    quickButton.Parent = controlGrid
    
    local updateButton = createControlButton("üîÑ –û–ë–ù–û–í–ò–¢–¨ –î–ê–ù–ù–´–ï", Color3.fromRGB(0, 150, 255), updateGameData)
    updateButton.Parent = controlGrid
    
    -- –°–µ–∫—Ü–∏—è: –õ–û–ì–ò
    local logSection = createSection("üìù –õ–û–ì–ò", 200)
    logSection.Parent = MainScroll
    
    local logScroll = Instance.new("ScrollingFrame")
    logScroll.Size = UDim2.new(1, -20, 1, -40)
    logScroll.Position = UDim2.new(0, 10, 0, 35)
    logScroll.BackgroundTransparency = 1
    logScroll.BorderSizePixel = 0
    logScroll.ScrollBarThickness = 3
    logScroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
    logScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    logScroll.Parent = logSection
    
    local logLayout = Instance.new("UIListLayout")
    logLayout.Padding = UDim.new(0, 5)
    logLayout.SortOrder = Enum.SortOrder.LayoutOrder
    logLayout.Parent = logScroll
    
    -- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–æ–≤
    _G.GUILogger = function(message, type)
        local color = Color3.fromRGB(200, 210, 230)
        
        if type == "success" then
            color = Color3.fromRGB(100, 255, 100)
        elseif type == "error" then
            color = Color3.fromRGB(255, 100, 100)
        elseif type == "warning" then
            color = Color3.fromRGB(255, 200, 100)
        elseif type == "money" then
            color = Color3.fromRGB(100, 255, 255)
        elseif type == "spot" then
            color = Color3.fromRGB(100, 200, 255)
        elseif type == "hire" then
            color = Color3.fromRGB(255, 150, 100)
        elseif type == "info" then
            color = Color3.fromRGB(180, 200, 255)
        end
        
        local logFrame = Instance.new("Frame")
        logFrame.Size = UDim2.new(1, 0, 0, 25)
        logFrame.BackgroundTransparency = 1
        logFrame.LayoutOrder = 1
        
        for _, child in ipairs(logScroll:GetChildren()) do
            if child:IsA("Frame") then
                child.LayoutOrder = child.LayoutOrder + 1
            end
        end
        
        local messageLabel = Instance.new("TextLabel")
        messageLabel.Size = UDim2.new(1, 0, 1, 0)
        messageLabel.BackgroundTransparency = 1
        messageLabel.Text = message
        messageLabel.TextColor3 = color
        messageLabel.Font = Enum.Font.Gotham
        messageLabel.TextSize = 12
        messageLabel.TextXAlignment = Enum.TextXAlignment.Left
        messageLabel.TextWrapped = true
        messageLabel.Parent = logFrame
        
        logFrame.Parent = logScroll
        
        -- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ª–æ–≥–∏
        task.wait()
        local children = logScroll:GetChildren()
        for i = #children, 15, -1 do
            local child = children[i]
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        task.wait(0.05)
        logScroll.CanvasPosition = Vector2.new(0, logScroll.AbsoluteCanvasSize.Y)
    end
    
    -- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ GUI
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        isGUIVisible = false
    end)
    
    MinimizeButton.MouseButton1Click:Connect(function()
        if MainContainer.Size == UDim2.new(0.4, 0, 0.8, 0) then
            -- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º
            MainContainer.Size = UDim2.new(0, 60, 0, 60)
            MainContainer.Position = UDim2.new(1, -70, 1, -70)
            TopBar.Visible = false
            MainScroll.Visible = false
            MinimizeButton.Text = "üóñ"
        else
            -- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
            MainContainer.Size = UDim2.new(0.4, 0, 0.8, 0)
            MainContainer.Position = UDim2.new(0.6, 0, 0.1, 0)
            TopBar.Visible = true
            MainScroll.Visible = true
            MinimizeButton.Text = "üóï"
        end
    end)
    
    -- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
    _G.UpdateAutoStatus = function(running)
        if running then
            guiElements.statusLabel.Text = "‚ñ∂ –†–ê–ë–û–¢–ê–ï–¢"
            guiElements.statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            startButton.Text = "‚è∏ –ü–ê–£–ó–ê"
        else
            guiElements.statusLabel.Text = "‚èπ –°–¢–û–ü"
            guiElements.statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            startButton.Text = "üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Æ"
        end
        isRunning = running
    end
    
    -- Drag and Drop –¥–ª—è GUI
    local dragging = false
    local dragStart
    local startPos
    
    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainContainer.Position
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainContainer.Position = startPos + UDim2.new(0, delta.X, 0, delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    guiElements.initialized = true
    lastUpdateTime = os.time()
    
    -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    MainContainer.Size = UDim2.new(0, 0, 0, 0)
    MainContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    local openTween = TweenService:Create(MainContainer, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
        Size = UDim2.new(0.4, 0, 0.8, 0),
        Position = UDim2.new(0.6, 0, 0.1, 0)
    })
    openTween:Play()
    
    openTween.Completed:Connect(function()
        log("Auto Optimizer PRO v7.0 –∑–∞–≥—Ä—É–∂–µ–Ω", "success")
        log("–§–∏–ª—å—Ç—Ä: –¢–û–õ–¨–ö–û 5-6‚≠ê –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã", "info")
        updateGameData()
    end)
    
    return ScreenGui
end

-- –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function quickOptimize()
    log("‚ö° –ó–ê–ü–£–°–ö –ë–´–°–¢–†–û–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò", "info")
    updateGameData()
    local optimized = optimizeAllProperties()
    log(string.format("–ë—ã—Å—Ç—Ä–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (%d –æ–±—ä–µ–∫—Ç–æ–≤)", optimized), "success")
end

-- –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function startAutoOptimizer()
    if isRunning then
        log("–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω", "warning")
        return
    end
    
    isRunning = true
    log("üöÄ –ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¢–û–† –ó–ê–ü–£–©–ï–ù", "success")
    log("–ù–∞—Å—Ç—Ä–æ–π–∫–∏: –¢–û–õ–¨–ö–û 5-6‚≠ê –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã", "info")
    
    if _G.UpdateAutoStatus then
        _G.UpdateAutoStatus(true)
    end
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    while isRunning do
        local startTime = tick()
        
        local optimized = optimizeAllProperties()
        
        local elapsedTime = tick() - startTime
        local waitTime = math.max(1, CHECK_INTERVAL - elapsedTime)
        
        if isRunning then
            for i = 1, math.floor(waitTime) do
                if not isRunning then break end
                task.wait(1)
            end
        end
    end
    
    log("–ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¢–û–† –û–°–¢–ê–ù–û–í–õ–ï–ù", "warning")
    
    if _G.UpdateAutoStatus then
        _G.UpdateAutoStatus(false)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
local function stopOptimizer()
    isRunning = false
    log("–ó–ê–ü–†–û–° –û–°–¢–ê–ù–û–í–ö–ò –û–ü–¢–ò–ú–ò–ó–ê–¢–û–†–ê", "warning")
end

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
local function initialize()
    -- –°–æ–∑–¥–∞–µ–º GUI
    createModernGUI()
    
    -- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
    dataUpdateConnection = RunService.Heartbeat:Connect(function()
        if os.time() - lastUpdateTime >= 5 then -- –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            updateGameData()
            lastUpdateTime = os.time()
        end
    end)
    
    -- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    task.wait(3)
    if not isRunning then
        task.spawn(startAutoOptimizer)
    end
    
    log("–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞", "success")
end

-- –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
task.spawn(initialize)

-- –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
return {
    quickOptimize = quickOptimize,
    startAutoOptimizer = startAutoOptimizer,
    stopOptimizer = stopOptimizer,
    updateGameData = updateGameData,
    isRunning = function() return isRunning end
}
