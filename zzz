-- Auto Optimizer Pro v8.0 - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–æ–π
-- –ê–≤—Ç–æ—Ä: AI Assistant
-- –í–µ—Ä—Å–∏—è: 8.0 (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è + –±–∞–Ω–∫ + –∫–≤–µ—Å—Ç—ã)

-- –ü–æ–ª—É—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Portfolio = require(ReplicatedStorage.Modules.Game.PortfolioController)
local Building = require(ReplicatedStorage.Modules.Data.Building)
local PlayerDataClient = require(ReplicatedStorage.Modules.PlayerDataClient)
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- –ü—É—Ç–∏ –∫ RemoteEvents –∏ Functions
local NetworkPath = require(ReplicatedStorage.Modules.NetworkClient)
local Invoker = require(ReplicatedStorage.Modules.UI.Invoker)
local Number = require(ReplicatedStorage.Modules.Number)
local SoundController = require(ReplicatedStorage.Modules.SoundController)

-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
local Config = {
    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤–µ–∑–¥
    MIN_STARS_FOR_REPLACEMENT = 5,      -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã –¥–ª—è –∑–∞–º–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
    MIN_STARS_FOR_NEW = 5,              -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    MAX_STARS = 6,                      -- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥
    
    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–Ω–∫–∞
    AUTO_DEPOSIT_ENABLED = true,        -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–æ–∑–∏—Ç—å –¥–µ–Ω—å–≥–∏
    DEPOSIT_THRESHOLD = 1000000,        -- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞
    KEEP_CASH_AMOUNT = 100000,          -- –û—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞–ª–∏—á–Ω—ã–º–∏
    
    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–≤–µ—Å—Ç–æ–≤
    AUTO_CLAIM_QUESTS = true,           -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–∏—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –∫–≤–µ—Å—Ç—ã
    AUTO_CLAIM_BANK_INTEREST = true,    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–∏—Ä–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏–∑ –±–∞–Ω–∫–∞
    
    -- –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    CHECK_INTERVAL = 5,                 -- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (5 —Å–µ–∫—É–Ω–¥)
    AUTO_DENY_BAD_APPLICANTS = true,    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª–æ–Ω—è—Ç—å –ø–ª–æ—Ö–∏—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    AUTO_ACCEPT_GOOD_APPLICANTS = true, -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ö–æ—Ä–æ—à–∏—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    AGGRESSIVE_REPLACEMENT = true,      -- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    PRIORITIZE_HIGHER_STARS = true,     -- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–≤–µ–∑–¥
    ONLY_5_6_STARS = true,              -- –¢–æ–ª—å–∫–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã —Å 5-6 –∑–≤–µ–∑–¥–∞–º–∏
    
    -- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    SHOW_NOTIFICATIONS = true,          -- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∏–≥—Ä–µ
    PLAY_SOUNDS = true                  -- –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å –∑–≤—É–∫–∏
}

-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local isRunning = false
local isGUIVisible = true
local cycleCount = 0
local processedRenters = {}
local processedApplicants = {}
local lastUpdateTime = 0
local guiElements = {}
local dataUpdateConnection = nil
local bankUpdateConnection = nil
local questUpdateConnection = nil

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
local statsData = {
    -- –ü–æ—Ä—Ç—Ñ–µ–ª—å
    totalProperties = 0,
    totalValue = 0,
    totalIncome = 0,
    totalExpenses = 0,
    netProfit = 0,
    
    -- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
    totalRenters = 0,
    occupiedSpots = 0,
    totalSpots = 0,
    occupancyRate = 0,
    averageStars = 0,
    fiveStarRenters = 0,
    sixStarRenters = 0,
    lowStarRenters = 0,  -- 1-4 –∑–≤–µ–∑–¥—ã
    
    -- –î–µ–Ω—å–≥–∏
    cashBalance = 0,
    bankBalance = 0,
    bankToCollect = 0,
    totalBankDeposits = 0,
    sessionProfit = 0,
    interestRate = 0,
    maxTimeLevel = 0,
    
    -- –ó–¥–∞–Ω–∏—è
    buildingTypes = {},
    totalBuildings = 0,
    underConstruction = 0,
    
    -- –ö–≤–µ—Å—Ç—ã
    activeQuests = 0,
    completedQuests = 0,
    questRewards = 0,
    
    -- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    totalReplacements = 0,
    totalAccepted = 0,
    totalEvicted = 0,
    totalStarsImproved = 0,
    lastOptimizationTime = 0,
    cycleTime = 0,
    
    -- –ë–∞–Ω–∫
    bankDepositsMade = 0,
    interestCollected = 0,
    totalDeposited = 0
}

-- –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª
local function formatNumber(num)
    if not num then return "0" end
    num = tonumber(num) or 0
    
    return Number.shortennumber(num, 1, false)
end

-- –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
local function log(message, type)
    local timestamp = os.date("%H:%M:%S")
    local formattedMessage = string.format("[%s] %s", timestamp, message)
    
    print(string.format("[AutoOptimizer] %s", message))
    
    if _G.GUILogger then
        _G.GUILogger(formattedMessage, type)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∏–≥—Ä–µ
local function showNotification(title, message, color)
    if not Config.SHOW_NOTIFICATIONS then return end
    
    pcall(function()
        -- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–≥—Ä—ã
        if Invoker then
            Invoker.Clicked("Notification", color or "Blue", title or "Auto Optimizer", message)
        end
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
local function updateQuestData()
    pcall(function()
        -- –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–æ–≤ –∏–∑ PlayerDataClient
        local completedFTUE = PlayerDataClient.Get("CompletedFTUE") or {}
        local questsCompleted = #completedFTUE or 0
        
        -- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
        -- –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–æ–≤
        statsData.completedQuests = questsCompleted
        
        -- –ü—Ä–∏–º–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–≤–µ—Å—Ç–æ–≤
        local questRewards = 0
        for _, questId in ipairs(completedFTUE) do
            questRewards = questRewards + 1000 -- –ü—Ä–∏–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞
        end
        statsData.questRewards = questRewards
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–∞–Ω–∫–∞
local function updateBankData()
    pcall(function()
        statsData.cashBalance = PlayerDataClient.Get("Cash") or 0
        statsData.bankBalance = PlayerDataClient.Get("BankBalance") or 0
        statsData.bankToCollect = PlayerDataClient.Get("BankToCollect") or 0
        statsData.interestRate = PlayerDataClient.Get("InterestLevel") or 0
        statsData.maxTimeLevel = PlayerDataClient.Get("MaxTimeLevel") or 0
        
        -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É
        if statsData.interestRate then
            statsData.interestRate = statsData.interestRate * 0.005 + 0.005
        end
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ –¥–µ–Ω–µ–≥ –≤ –±–∞–Ω–∫
local function autoDepositToBank()
    if not Config.AUTO_DEPOSIT_ENABLED then return false end
    
    local cash = statsData.cashBalance or 0
    local bankBalance = statsData.bankBalance or 0
    local maxBalance = 1000000000000 -- 1 —Ç—Ä–∏–ª–ª–∏–æ–Ω (–∏–∑ –∫–æ–¥–∞ –±–∞–Ω–∫–∞)
    
    if cash > Config.DEPOSIT_THRESHOLD then
        local amountToDeposit = cash - Config.KEEP_CASH_AMOUNT
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç –ª–∏ –ª–∏–º–∏—Ç –±–∞–Ω–∫–∞
        if bankBalance + amountToDeposit > maxBalance then
            amountToDeposit = maxBalance - bankBalance
        end
        
        if amountToDeposit > 0 then
            pcall(function()
                -- –ò—Å–ø–æ–ª—å–∑—É–µ–º Invoker –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞
                Invoker.Clicked("Deposit", amountToDeposit)
                
                statsData.bankDepositsMade = statsData.bankDepositsMade + 1
                statsData.totalDeposited = statsData.totalDeposited + amountToDeposit
                
                log(string.format("–î–µ–ø–æ–∑–∏—Ç: $%s –≤ –±–∞–Ω–∫", formatNumber(amountToDeposit)), "money")
                showNotification("üí∞ –ë–∞–Ω–∫", string.format("–î–µ–ø–æ–∑–∏—Ç: $%s", formatNumber(amountToDeposit)), "Blue")
                
                if Config.PLAY_SOUNDS then
                    SoundController.PlaySound("SmallSuccessA")
                end
                
                return true
            end)
        end
    end
    
    return false
end

-- –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏–∑ –±–∞–Ω–∫–∞
local function claimBankInterest()
    if not Config.AUTO_CLAIM_BANK_INTEREST then return false end
    
    local toCollect = statsData.bankToCollect or 0
    
    if toCollect > 0 then
        pcall(function()
            Invoker.Clicked("ClaimInterest")
            
            statsData.interestCollected = statsData.interestCollected + toCollect
            
            log(string.format("–ü—Ä–æ—Ü–µ–Ω—Ç—ã: $%s —Å–æ–±—Ä–∞–Ω–æ", formatNumber(toCollect)), "money")
            showNotification("üí∞ –ë–∞–Ω–∫", string.format("–ü—Ä–æ—Ü–µ–Ω—Ç—ã: $%s", formatNumber(toCollect)), "Blue")
            
            if Config.PLAY_SOUNDS then
                SoundController.PlaySound("Reward")
            end
            
            return true
        end)
    end
    
    return false
end

-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
local function updateGameData()
    pcall(function()
        -- –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–∞
        updateBankData()
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–æ–≤
        updateQuestData()
        
        -- –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª—å
        local portfolio = Portfolio.GetPortfolio() or {}
        local totalProperties = 0
        local totalValue = 0
        local totalIncome = 0
        local totalExpenses = 0
        local totalRenters = 0
        local occupiedSpots = 0
        local totalSpots = 0
        local totalStars = 0
        local fiveStarCount = 0
        local sixStarCount = 0
        local lowStarCount = 0
        local buildingTypes = {}
        
        for propertyUID, property in pairs(portfolio) do
            if property and property.BuildingType and property.BuildingType ~= "Empty" then
                totalProperties = totalProperties + 1
                totalValue = totalValue + (property.Value or 0)
                totalIncome = totalIncome + (property.Income or 0)
                totalExpenses = totalExpenses + (property.Expenses or 0)
                
                -- –ü–æ–¥—Å—á–µ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
                if property.Renters then
                    for renterId, renter in pairs(property.Renters) do
                        totalRenters = totalRenters + 1
                        local stars = renter.Stars or 1
                        totalStars = totalStars + stars
                        
                        if stars == 5 then
                            fiveStarCount = fiveStarCount + 1
                        elseif stars == 6 then
                            sixStarCount = sixStarCount + 1
                        elseif stars < 5 then
                            lowStarCount = lowStarCount + 1
                        end
                    end
                end
                
                -- –ü–æ–¥—Å—á–µ—Ç –º–µ—Å—Ç
                local buildingData = Building[property.BuildingType]
                if buildingData then
                    local spots = buildingData.Spots or 0
                    if property.Built then
                        for _, upgrade in ipairs(property.Built) do
                            if upgrade ~= "Main" and buildingData.Upgrades and buildingData.Upgrades[upgrade] then
                                spots = spots + (buildingData.Upgrades[upgrade].AddedRenters or 0)
                            end
                        end
                    end
                    totalSpots = totalSpots + spots
                    
                    -- –°—á–∏—Ç–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞
                    if property.Renters then
                        occupiedSpots = occupiedSpots + (next(property.Renters) and 1 or 0)
                    end
                end
                
                -- –¢–∏–ø—ã –∑–¥–∞–Ω–∏–π
                local buildingType = property.BuildingType
                buildingTypes[buildingType] = (buildingTypes[buildingType] or 0) + 1
            end
        end
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        statsData.totalProperties = totalProperties
        statsData.totalValue = totalValue
        statsData.totalIncome = totalIncome
        statsData.totalExpenses = totalExpenses
        statsData.netProfit = totalIncome - totalExpenses
        statsData.totalRenters = totalRenters
        statsData.occupiedSpots = occupiedSpots
        statsData.totalSpots = totalSpots
        statsData.occupancyRate = totalSpots > 0 and (occupiedSpots / totalSpots * 100) or 0
        statsData.averageStars = totalRenters > 0 and (totalStars / totalRenters) or 0
        statsData.fiveStarRenters = fiveStarCount
        statsData.sixStarRenters = sixStarCount
        statsData.lowStarRenters = lowStarCount
        statsData.buildingTypes = buildingTypes
        statsData.totalBuildings = totalProperties
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º GUI
        updateGUI()
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è GUI
local function updateGUI()
    if not guiElements.initialized then return end
    
    pcall(function()
        -- –î–µ–Ω—å–≥–∏
        if guiElements.cashLabel then
            guiElements.cashLabel.Text = string.format("$%s", formatNumber(statsData.cashBalance))
        end
        if guiElements.bankLabel then
            guiElements.bankLabel.Text = string.format("$%s", formatNumber(statsData.bankBalance))
        end
        if guiElements.bankToCollectLabel then
            guiElements.bankToCollectLabel.Text = string.format("$%s", formatNumber(statsData.bankToCollect))
        end
        if guiElements.totalIncomeLabel then
            guiElements.totalIncomeLabel.Text = string.format("$%s/—á–∞—Å", formatNumber(statsData.totalIncome))
        end
        if guiElements.netProfitLabel then
            guiElements.netProfitLabel.Text = string.format("$%s/—á–∞—Å", formatNumber(statsData.netProfit))
        end
        
        -- –ü–æ—Ä—Ç—Ñ–µ–ª—å
        if guiElements.propertiesLabel then
            guiElements.propertiesLabel.Text = tostring(statsData.totalProperties)
        end
        if guiElements.totalValueLabel then
            guiElements.totalValueLabel.Text = string.format("$%s", formatNumber(statsData.totalValue))
        end
        if guiElements.occupancyLabel then
            guiElements.occupancyLabel.Text = string.format("%.1f%%", statsData.occupancyRate)
        end
        
        -- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
        if guiElements.totalRentersLabel then
            guiElements.totalRentersLabel.Text = tostring(statsData.totalRenters)
        end
        if guiElements.averageStarsLabel then
            guiElements.averageStarsLabel.Text = string.format("%.1f", statsData.averageStars)
        end
        if guiElements.fiveStarLabel then
            guiElements.fiveStarLabel.Text = tostring(statsData.fiveStarRenters)
        end
        if guiElements.sixStarLabel then
            guiElements.sixStarLabel.Text = tostring(statsData.sixStarRenters)
        end
        if guiElements.lowStarLabel then
            guiElements.lowStarLabel.Text = tostring(statsData.lowStarRenters)
        end
        if guiElements.occupiedSpotsLabel then
            guiElements.occupiedSpotsLabel.Text = string.format("%d/%d", statsData.occupiedSpots, statsData.totalSpots)
        end
        
        -- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
        if guiElements.replacementsLabel then
            guiElements.replacementsLabel.Text = tostring(statsData.totalReplacements)
        end
        if guiElements.acceptedLabel then
            guiElements.acceptedLabel.Text = tostring(statsData.totalAccepted)
        end
        if guiElements.evictedLabel then
            guiElements.evictedLabel.Text = tostring(statsData.totalEvicted)
        end
        if guiElements.cycleCountLabel then
            guiElements.cycleCountLabel.Text = tostring(cycleCount)
        end
        
        -- –ë–∞–Ω–∫
        if guiElements.bankDepositsLabel then
            guiElements.bankDepositsLabel.Text = tostring(statsData.bankDepositsMade)
        end
        if guiElements.interestCollectedLabel then
            guiElements.interestCollectedLabel.Text = string.format("$%s", formatNumber(statsData.interestCollected))
        end
        
        -- –í—Ä–µ–º—è
        if guiElements.lastUpdateLabel then
            local timeDiff = os.time() - lastUpdateTime
            local minutes = math.floor(timeDiff / 60)
            local seconds = timeDiff % 60
            guiElements.lastUpdateLabel.Text = string.format("%d:%02d", minutes, seconds)
        end
    end)
end

-- –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Å—Ç –≤ –∑–¥–∞–Ω–∏–∏
local function calculateTotalSpots(property)
    if not property or property.BuildingType == "Empty" then return 0 end
    
    local buildingData = Building[property.BuildingType]
    if not buildingData then return 0 end
    
    local totalSpots = buildingData.Spots or 0
    
    if property.Built then
        for _, upgrade in ipairs(property.Built) do
            if upgrade ~= "Main" and buildingData.Upgrades and buildingData.Upgrades[upgrade] then
                totalSpots = totalSpots + (buildingData.Upgrades[upgrade].AddedRenters or 0)
            end
        end
    end
    
    return totalSpots
end

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–≤–µ–∑–¥
local function isValidStars(stars, minStars)
    if not stars then return false end
    local min = minStars or Config.MIN_STARS_FOR_NEW
    return stars >= min and stars <= Config.MAX_STARS
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
local function getAllApplicantsSorted(propertyUID)
    if not propertyUID then return {} end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or not property.Applicants then return {} end
    
    local applicants = {}
    
    for applicantId, applicant in pairs(property.Applicants) do
        if applicantId and applicant then
            local cacheKey = propertyUID .. "_" .. applicantId
            if not processedApplicants[cacheKey] then
                local stars = applicant.Stars or 1
                if isValidStars(stars, Config.MIN_STARS_FOR_NEW) then
                    table.insert(applicants, {
                        id = applicantId,
                        stars = stars,
                        data = applicant
                    })
                end
            end
        end
    end
    
    -- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–≤–µ–∑–¥–∞–º (6‚≠ê —Å–Ω–∞—á–∞–ª–∞)
    if #applicants > 0 then
        table.sort(applicants, function(a, b)
            if a.stars ~= b.stars then
                return a.stars > b.stars
            end
            return a.id < b.id
        end)
    end
    
    return applicants
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
local function getAllRentersSorted(propertyUID)
    if not propertyUID then return {} end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or not property.Renters then return {} end
    
    local renters = {}
    
    for renterId, renter in pairs(property.Renters) do
        if renterId and renter then
            local cacheKey = propertyUID .. "_" .. renterId
            if not processedRenters[cacheKey] then
                local stars = renter.Stars or 1
                table.insert(renters, {
                    id = renterId,
                    stars = stars,
                    data = renter
                })
            end
        end
    end
    
    -- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–≤–µ–∑–¥–∞–º (—Å–Ω–∞—á–∞–ª–∞ —Ö—É–¥—à–∏–µ)
    if #renters > 0 then
        table.sort(renters, function(a, b)
            return a.stars < b.stars
        end)
    end
    
    return renters
end

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
local function acceptApplicant(propertyUID, applicantId)
    if not propertyUID or not applicantId then return false, "Invalid params" end
    
    local success, result = pcall(function()
        Portfolio.Accept(propertyUID, applicantId)
        return true
    end)
    
    if success then
        processedApplicants[propertyUID .. "_" .. applicantId] = true
        statsData.totalAccepted = statsData.totalAccepted + 1
        return true, "Accepted"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –≤—ã—Å–µ–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
local function evictRenter(propertyUID, renterId)
    if not propertyUID or not renterId then return false, "Invalid params" end
    
    local success, result = pcall(function()
        Portfolio.Evict(propertyUID, renterId)
        return true
    end)
    
    if success then
        processedRenters[propertyUID .. "_" .. renterId] = true
        statsData.totalEvicted = statsData.totalEvicted + 1
        return true, "Evicted"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
local function denyApplicant(propertyUID, applicantId)
    if not propertyUID or not applicantId then return false, "Invalid params" end
    
    local success, result = pcall(function()
        Portfolio.Deny(propertyUID, applicantId)
        return true
    end)
    
    if success then
        processedApplicants[propertyUID .. "_" .. applicantId] = true
        return true, "Denied"
    else
        return false, "Error: " .. tostring(result)
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–¥–∞–Ω–∏—è
local function optimizeProperty(propertyUID)
    if not propertyUID then return "error" end
    
    local property = Portfolio.GetAll(propertyUID)
    if not property or property.BuildingType == "Empty" then return "skip_empty" end
    
    local totalSpots = calculateTotalSpots(property)
    local currentRenters = getAllRentersSorted(propertyUID)
    local currentApplicants = getAllApplicantsSorted(propertyUID)
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞
    if #currentRenters < totalSpots and #currentApplicants > 0 then
        local spotsToFill = totalSpots - #currentRenters
        local filled = 0
        
        for i = 1, math.min(spotsToFill, #currentApplicants) do
            local applicant = currentApplicants[i]
            if applicant and applicant.stars >= Config.MIN_STARS_FOR_NEW then
                local success, msg = acceptApplicant(propertyUID, applicant.id)
                if success then
                    filled = filled + 1
                    log(string.format("%s: –ü—Ä–∏–Ω—è—Ç %d‚≠ê", propertyUID, applicant.stars), "hire")
                    task.wait(0.3)
                end
            end
        end
        
        if filled > 0 then
            return string.format("filled|%d", filled)
        end
    end
    
    -- –ó–∞–º–µ–Ω—è–µ–º –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –ª—É—á—à–∏—Ö (–≤–∞—à–∞ –ª–æ–≥–∏–∫–∞)
    if #currentRenters > 0 and #currentApplicants > 0 then
        local replaced = 0
        
        -- –ù–∞—Ö–æ–¥–∏–º —Ö—É–¥—à–µ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        local worstRenter = currentRenters[1]
        if worstRenter then
            -- –ò—â–µ–º –ª—É—á—à–µ–≥–æ –∞–ø–ø–ª–∏–∫–∞–Ω—Ç–∞
            for _, applicant in ipairs(currentApplicants) do
                if applicant.stars > worstRenter.stars then
                    -- –í—ã—Å–µ–ª—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ
                    local success1, msg1 = evictRenter(propertyUID, worstRenter.id)
                    if success1 then
                        task.wait(0.5)
                        
                        -- –ü—Ä–∏–Ω–∏–º–∞–µ–º –Ω–æ–≤–æ–≥–æ
                        local success2, msg2 = acceptApplicant(propertyUID, applicant.id)
                        if success2 then
                            replaced = replaced + 1
                            statsData.totalReplacements = statsData.totalReplacements + 1
                            statsData.totalStarsImproved = statsData.totalStarsImproved + (applicant.stars - worstRenter.stars)
                            
                            log(string.format("%s: –ó–∞–º–µ–Ω–∞ %d‚≠ê ‚Üí %d‚≠ê", 
                                propertyUID, worstRenter.stars, applicant.stars), "spot")
                            
                            task.wait(0.3)
                            break
                        end
                    end
                end
            end
        end
        
        if replaced > 0 then
            return string.format("replaced|%d", replaced)
        end
    end
    
    -- –û—Ç–∫–ª–æ–Ω—è–µ–º –ø–ª–æ—Ö–∏—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
    if Config.AUTO_DENY_BAD_APPLICANTS then
        local denied = 0
        for applicantId, applicant in pairs(property.Applicants or {}) do
            local stars = applicant.Stars or 1
            if stars < Config.MIN_STARS_FOR_NEW then
                local success, msg = denyApplicant(propertyUID, applicantId)
                if success then
                    denied = denied + 1
                end
            end
        end
        
        if denied > 0 then
            return string.format("denied|%d", denied)
        end
    end
    
    return "no_changes"
end

-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function optimizeAllProperties()
    local cycleStartTime = tick()
    cycleCount = cycleCount + 1
    
    log(string.format("–¶–ò–ö–õ #%d - –ú–ò–ù –ó–í–ï–ó–î–´: %d", cycleCount, Config.MIN_STARS_FOR_NEW), "info")
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    updateGameData()
    
    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–Ω–∫–æ–º
    if Config.AUTO_CLAIM_BANK_INTEREST then
        claimBankInterest()
    end
    
    if Config.AUTO_DEPOSIT_ENABLED then
        autoDepositToBank()
    end
    
    local optimizedCount = 0
    local totalFilled = 0
    local totalReplaced = 0
    
    -- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –∑–¥–∞–Ω–∏—è
    local portfolio = Portfolio.GetPortfolio() or {}
    for propertyUID, property in pairs(portfolio) do
        if property and property.BuildingType and property.BuildingType ~= "Empty" then
            local result = optimizeProperty(propertyUID)
            
            if result:find("filled|") then
                local filled = tonumber(result:match("filled|(%d+)")) or 0
                optimizedCount = optimizedCount + 1
                totalFilled = totalFilled + filled
            elseif result:find("replaced|") then
                local replaced = tonumber(result:match("replaced|(%d+)")) or 0
                optimizedCount = optimizedCount + 1
                totalReplaced = totalReplaced + replaced
            end
            
            task.wait(0.1)
        end
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    statsData.cycleTime = tick() - cycleStartTime
    statsData.lastOptimizationTime = os.time()
    lastUpdateTime = os.time()
    
    -- –õ–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    if totalFilled > 0 then
        log(string.format("–ó–∞–ø–æ–ª–Ω–µ–Ω–æ: %d –º–µ—Å—Ç", totalFilled), "success")
    end
    if totalReplaced > 0 then
        log(string.format("–ó–∞–º–µ–Ω–µ–Ω–æ: %d –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤", totalReplaced), "spot")
    end
    if optimizedCount == 0 then
        log("–í—Å–µ –∑–¥–∞–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã", "info")
    end
    
    updateGUI()
    
    return optimizedCount
end

-- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è GUI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
local function createConfigGUI(parent)
    local configFrame = Instance.new("Frame")
    configFrame.Size = UDim2.new(1, 0, 0, 300)
    configFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    configFrame.BorderSizePixel = 0
    configFrame.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = configFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.BackgroundTransparency = 1
    title.Text = "‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = configFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.Parent = title
    
    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, 0, 1, -40)
    scroll.Position = UDim2.new(0, 0, 0, 35)
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ScrollBarThickness = 3
    scroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.Parent = configFrame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 5)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = scroll
    
    -- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    local function createConfigOption(labelText, defaultValue, minValue, maxValue, step, callback)
        local optionFrame = Instance.new("Frame")
        optionFrame.Size = UDim2.new(1, -20, 0, 40)
        optionFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        optionFrame.BorderSizePixel = 0
        optionFrame.LayoutOrder = 1
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = optionFrame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.6, -10, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = labelText
        label.TextColor3 = Color3.fromRGB(200, 210, 230)
        label.Font = Enum.Font.Gotham
        label.TextSize = 12
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = optionFrame
        
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Size = UDim2.new(0.2, 0, 1, 0)
        valueLabel.Position = UDim2.new(0.6, 0, 0, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = tostring(defaultValue)
        valueLabel.TextColor3 = Color3.fromRGB(255, 255, 200)
        valueLabel.Font = Enum.Font.GothamBold
        valueLabel.TextSize = 14
        valueLabel.Parent = optionFrame
        
        local decreaseButton = Instance.new("TextButton")
        decreaseButton.Size = UDim2.new(0.1, -2, 1, -4)
        decreaseButton.Position = UDim2.new(0.8, 2, 0, 2)
        decreaseButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        decreaseButton.Text = "‚óÄ"
        decreaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        decreaseButton.Font = Enum.Font.GothamBold
        decreaseButton.TextSize = 12
        decreaseButton.Parent = optionFrame
        
        local increaseButton = Instance.new("TextButton")
        increaseButton.Size = UDim2.new(0.1, -2, 1, -4)
        increaseButton.Position = UDim2.new(0.9, 2, 0, 2)
        increaseButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        increaseButton.Text = "‚ñ∂"
        increaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        increaseButton.Font = Enum.Font.GothamBold
        increaseButton.TextSize = 12
        increaseButton.Parent = optionFrame
        
        local currentValue = defaultValue
        
        local function updateValue(newValue)
            if newValue < minValue then newValue = minValue end
            if newValue > maxValue then newValue = maxValue end
            
            currentValue = newValue
            valueLabel.Text = tostring(newValue)
            
            if callback then
                callback(newValue)
            end
        end
        
        decreaseButton.MouseButton1Click:Connect(function()
            updateValue(currentValue - step)
        end)
        
        increaseButton.MouseButton1Click:Connect(function()
            updateValue(currentValue + step)
        end)
        
        optionFrame.Parent = scroll
        return {frame = optionFrame, getValue = function() return currentValue end}
    end
    
    -- –°–æ–∑–¥–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    local settings = {}
    
    settings.minStarsNew = createConfigOption("–ú–∏–Ω –∑–≤–µ–∑–¥—ã (–Ω–æ–≤—ã–µ):", Config.MIN_STARS_FOR_NEW, 1, 6, 1, function(value)
        Config.MIN_STARS_FOR_NEW = value
    end)
    
    settings.minStarsReplace = createConfigOption("–ú–∏–Ω –∑–≤–µ–∑–¥—ã (–∑–∞–º–µ–Ω–∞):", Config.MIN_STARS_FOR_REPLACEMENT, 1, 6, 1, function(value)
        Config.MIN_STARS_FOR_REPLACEMENT = value
    end)
    
    settings.depositThreshold = createConfigOption("–ü–æ—Ä–æ–≥ –¥–µ–ø–æ–∑–∏—Ç–∞:", Config.DEPOSIT_THRESHOLD, 1000, 100000000, 10000, function(value)
        Config.DEPOSIT_THRESHOLD = value
    end)
    
    settings.checkInterval = createConfigOption("–ò–Ω—Ç–µ—Ä–≤–∞–ª (—Å–µ–∫):", Config.CHECK_INTERVAL, 1, 60, 1, function(value)
        Config.CHECK_INTERVAL = value
    end)
    
    -- –ß–µ–∫–±–æ–∫—Å—ã
    local function createCheckbox(labelText, defaultValue, callback)
        local checkboxFrame = Instance.new("Frame")
        checkboxFrame.Size = UDim2.new(1, -20, 0, 30)
        checkboxFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        checkboxFrame.BorderSizePixel = 0
        checkboxFrame.LayoutOrder = 1
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = checkboxFrame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.8, -10, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = labelText
        label.TextColor3 = Color3.fromRGB(200, 210, 230)
        label.Font = Enum.Font.Gotham
        label.TextSize = 12
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = checkboxFrame
        
        local checkButton = Instance.new("TextButton")
        checkButton.Size = UDim2.new(0.2, -10, 0.6, 0)
        checkButton.Position = UDim2.new(0.8, 5, 0.2, 0)
        checkButton.BackgroundColor3 = defaultValue and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(180, 0, 0)
        checkButton.Text = defaultValue and "‚úì" or "‚úó"
        checkButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        checkButton.Font = Enum.Font.GothamBold
        checkButton.TextSize = 14
        checkButton.Parent = checkboxFrame
        
        checkButton.MouseButton1Click:Connect(function()
            defaultValue = not defaultValue
            checkButton.BackgroundColor3 = defaultValue and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(180, 0, 0)
            checkButton.Text = defaultValue and "‚úì" or "‚úó"
            
            if callback then
                callback(defaultValue)
            end
        end)
        
        checkboxFrame.Parent = scroll
    end
    
    -- –ß–µ–∫–±–æ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
    createCheckbox("–ê–≤—Ç–æ-–¥–µ–ø–æ–∑–∏—Ç", Config.AUTO_DEPOSIT_ENABLED, function(value)
        Config.AUTO_DEPOSIT_ENABLED = value
    end)
    
    createCheckbox("–ê–≤—Ç–æ-–ø—Ä–æ—Ü–µ–Ω—Ç—ã", Config.AUTO_CLAIM_BANK_INTEREST, function(value)
        Config.AUTO_CLAIM_BANK_INTEREST = value
    end)
    
    createCheckbox("–û—Ç–∫–ª–æ–Ω—è—Ç—å –ø–ª–æ—Ö–∏—Ö", Config.AUTO_DENY_BAD_APPLICANTS, function(value)
        Config.AUTO_DENY_BAD_APPLICANTS = value
    end)
    
    createCheckbox("–¢–æ–ª—å–∫–æ 5-6‚≠ê", Config.ONLY_5_6_STARS, function(value)
        Config.ONLY_5_6_STARS = value
    end)
    
    return configFrame
end

-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ GUI (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
local function createModernGUI()
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    
    -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π GUI
    local oldGUI = PlayerGui:FindFirstChild("AutoOptimizerPro")
    if oldGUI then oldGUI:Destroy() end
    
    -- –°–æ–∑–¥–∞–µ–º ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "AutoOptimizerPro"
    ScreenGui.Parent = PlayerGui
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    local MainContainer = Instance.new("Frame")
    MainContainer.Size = UDim2.new(0.35, 0, 0.8, 0)
    MainContainer.Position = UDim2.new(0.65, 0, 0.1, 0)
    MainContainer.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
    MainContainer.BackgroundTransparency = 0.05
    MainContainer.BorderSizePixel = 0
    MainContainer.ClipsDescendants = true
    MainContainer.Parent = ScreenGui
    
    local ContainerCorner = Instance.new("UICorner")
    ContainerCorner.CornerRadius = UDim.new(0, 12)
    ContainerCorner.Parent = MainContainer
    
    -- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å
    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 40)
    TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    TopBar.BorderSizePixel = 0
    TopBar.Parent = MainContainer
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.6, 0, 1, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "‚ö° OPTIMIZER v8.0"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = TopBar
    
    local TitlePadding = Instance.new("UIPadding")
    TitlePadding.PaddingLeft = UDim.new(0, 15)
    TitlePadding.Parent = Title
    
    -- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 30, 0, 30)
    CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
    CloseButton.BackgroundTransparency = 1
    CloseButton.Text = "‚úï"
    CloseButton.TextColor3 = Color3.fromRGB(255, 100, 100)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 16
    CloseButton.Parent = TopBar
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
    local TabButtons = Instance.new("Frame")
    TabButtons.Size = UDim2.new(1, 0, 0, 40)
    TabButtons.Position = UDim2.new(0, 0, 0, 40)
    TabButtons.BackgroundTransparency = 1
    TabButtons.Parent = MainContainer
    
    local tabs = {"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "üí∞ –ë–∞–Ω–∫", "üìù –õ–æ–≥–∏"}
    local currentTab = "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
    
    for i, tabName in ipairs(tabs) do
        local tabButton = Instance.new("TextButton")
        tabButton.Size = UDim2.new(1/#tabs, 0, 1, 0)
        tabButton.Position = UDim2.new((i-1)/#tabs, 0, 0, 0)
        tabButton.BackgroundColor3 = tabName == currentTab and Color3.fromRGB(50, 50, 80) or Color3.fromRGB(40, 40, 60)
        tabButton.Text = tabName
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabButton.Font = Enum.Font.Gotham
        tabButton.TextSize = 12
        tabButton.Parent = TabButtons
        
        tabButton.MouseButton1Click:Connect(function()
            currentTab = tabName
            for _, btn in ipairs(TabButtons:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.BackgroundColor3 = btn.Text == currentTab and Color3.fromRGB(50, 50, 80) or Color3.fromRGB(40, 40, 60)
                end
            end
            -- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        end)
    end
    
    -- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    local StatsContent = Instance.new("ScrollingFrame")
    StatsContent.Size = UDim2.new(1, 0, 1, -80)
    StatsContent.Position = UDim2.new(0, 0, 0, 80)
    StatsContent.BackgroundTransparency = 1
    StatsContent.BorderSizePixel = 0
    StatsContent.ScrollBarThickness = 4
    StatsContent.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
    StatsContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    StatsContent.Parent = MainContainer
    
    local StatsLayout = Instance.new("UIListLayout")
    StatsLayout.Padding = UDim.new(0, 10)
    StatsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    StatsLayout.Parent = StatsContent
    
    -- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
    local function createStatCard(label, value, isMoney)
        local card = Instance.new("Frame")
        card.Size = UDim2.new(1, -20, 0, 35)
        card.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        card.BorderSizePixel = 0
        card.LayoutOrder = 1
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = card
        
        local labelText = Instance.new("TextLabel")
        labelText.Size = UDim2.new(0.6, -5, 1, 0)
        labelText.Position = UDim2.new(0, 10, 0, 0)
        labelText.BackgroundTransparency = 1
        labelText.Text = label
        labelText.TextColor3 = Color3.fromRGB(200, 210, 230)
        labelText.Font = Enum.Font.Gotham
        labelText.TextSize = 12
        labelText.TextXAlignment = Enum.TextXAlignment.Left
        labelText.Parent = card
        
        local valueText = Instance.new("TextLabel")
        valueText.Size = UDim2.new(0.4, 0, 1, 0)
        valueText.Position = UDim2.new(0.6, 0, 0, 0)
        valueText.BackgroundTransparency = 1
        valueText.Text = value or "0"
        valueText.TextColor3 = isMoney and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 255, 200)
        valueText.Font = Enum.Font.GothamBold
        valueText.TextSize = 13
        valueText.TextXAlignment = Enum.TextXAlignment.Right
        valueText.Parent = card
        
        card.Parent = StatsContent
        
        return valueText
    end
    
    -- –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    guiElements.cashLabel = createStatCard("–ù–∞–ª–∏—á–Ω—ã–µ:", "$0", true)
    guiElements.bankLabel = createStatCard("–ë–∞–Ω–∫:", "$0", true)
    guiElements.bankToCollectLabel = createStatCard("–ë–∞–Ω–∫ %:", "$0", true)
    guiElements.totalIncomeLabel = createStatCard("–î–æ—Ö–æ–¥/—á–∞—Å:", "$0", true)
    guiElements.propertiesLabel = createStatCard("–û–±—ä–µ–∫—Ç—ã:", "0", false)
    guiElements.totalValueLabel = createStatCard("–°—Ç–æ–∏–º–æ—Å—Ç—å:", "$0", true)
    guiElements.totalRentersLabel = createStatCard("–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã:", "0", false)
    guiElements.averageStarsLabel = createStatCard("–°—Ä. –∑–≤–µ–∑–¥—ã:", "0.0", false)
    guiElements.fiveStarLabel = createStatCard("5‚≠ê:", "0", false)
    guiElements.sixStarLabel = createStatCard("6‚≠ê:", "0", false)
    guiElements.lowStarLabel = createStatCard("–ù–∏–∑–∫–∏–µ:", "0", false)
    guiElements.replacementsLabel = createStatCard("–ó–∞–º–µ–Ω—ã:", "0", false)
    guiElements.bankDepositsLabel = createStatCard("–î–µ–ø–æ–∑–∏—Ç—ã:", "0", false)
    guiElements.interestCollectedLabel = createStatCard("–ü—Ä–æ—Ü–µ–Ω—Ç—ã:", "$0", true)
    guiElements.cycleCountLabel = createStatCard("–¶–∏–∫–ª—ã:", "0", false)
    guiElements.lastUpdateLabel = createStatCard("–û–±–Ω–æ–≤–ª–µ–Ω–æ:", "0:00", false)
    
    -- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local ControlButtons = Instance.new("Frame")
    ControlButtons.Size = UDim2.new(1, -20, 0, 120)
    ControlButtons.Position = UDim2.new(0, 10, 1, -130)
    ControlButtons.BackgroundTransparency = 1
    ControlButtons.Parent = MainContainer
    
    local function createControlButton(text, color, callback)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 35)
        button.BackgroundColor3 = color
        button.Text = text
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.Font = Enum.Font.GothamBold
        button.TextSize = 14
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = button
        
        button.MouseButton1Click:Connect(function()
            if callback then
                task.spawn(callback)
            end
        end)
        
        button.Parent = ControlButtons
        
        local layout = Instance.new("UIListLayout")
        layout.Padding = UDim.new(0, 5)
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Parent = ControlButtons
        
        return button
    end
    
    local startButton = createControlButton("üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨", Color3.fromRGB(0, 180, 0), function()
        if not isRunning then
            startAutoOptimizer()
        else
            stopOptimizer()
        end
    end)
    
    createControlButton("‚ö° –ë–´–°–¢–†–ê–Ø", Color3.fromRGB(255, 150, 0), quickOptimize)
    createControlButton("üí∞ –î–ï–ü–û–ó–ò–¢", Color3.fromRGB(0, 150, 255), function()
        autoDepositToBank()
    end)
    createControlButton("üîÑ –û–ë–ù–û–í–ò–¢–¨", Color3.fromRGB(100, 100, 200), updateGameData)
    
    -- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        isGUIVisible = false
    end)
    
    -- Drag and Drop
    local dragging = false
    local dragStart
    local startPos
    
    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainContainer.Position
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainContainer.Position = startPos + UDim2.new(0, delta.X, 0, delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    guiElements.initialized = true
    lastUpdateTime = os.time()
    
    -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    MainContainer.Size = UDim2.new(0, 0, 0, 0)
    MainContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    local openTween = TweenService:Create(MainContainer, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
        Size = UDim2.new(0.35, 0, 0.8, 0),
        Position = UDim2.new(0.65, 0, 0.1, 0)
    })
    openTween:Play()
    
    openTween.Completed:Connect(function()
        log("Auto Optimizer v8.0 –∑–∞–≥—Ä—É–∂–µ–Ω", "success")
        updateGameData()
    end)
    
    return ScreenGui
end

-- –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function quickOptimize()
    log("‚ö° –ó–ê–ü–£–°–ö –ë–´–°–¢–†–û–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò", "info")
    updateGameData()
    local optimized = optimizeAllProperties()
    log(string.format("–ë—ã—Å—Ç—Ä–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (%d –æ–±—ä–µ–∫—Ç–æ–≤)", optimized), "success")
end

-- –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
local function startAutoOptimizer()
    if isRunning then
        stopOptimizer()
        return
    end
    
    isRunning = true
    log("üöÄ –ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¢–û–† –ó–ê–ü–£–©–ï–ù", "success")
    showNotification("Auto Optimizer", "–ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω", "Green")
    
    -- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    while isRunning and task.wait(Config.CHECK_INTERVAL) do
        local startTime = tick()
        
        local optimized = optimizeAllProperties()
        
        local elapsedTime = tick() - startTime
        log(string.format("–¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ %.2f—Å", elapsedTime), "info")
    end
    
    if isRunning then
        isRunning = false
        log("–ê–í–¢–û–û–ü–¢–ò–ú–ò–ó–ê–¢–û–† –û–°–¢–ê–ù–û–í–õ–ï–ù", "warning")
        showNotification("Auto Optimizer", "–ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", "Red")
    end
end

-- –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
local function stopOptimizer()
    isRunning = false
    log("–ó–ê–ü–†–û–° –û–°–¢–ê–ù–û–í–ö–ò –û–ü–¢–ò–ú–ò–ó–ê–¢–û–†–ê", "warning")
end

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
local function initialize()
    -- –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã
    repeat task.wait(1) until PlayerDataClient.Loaded()
    
    -- –°–æ–∑–¥–∞–µ–º GUI
    createModernGUI()
    
    -- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
    dataUpdateConnection = RunService.Heartbeat:Connect(function()
        if os.time() - lastUpdateTime >= 5 then
            updateGameData()
            lastUpdateTime = os.time()
        end
    end)
    
    log("–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞", "success")
    showNotification("Auto Optimizer", "–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞", "Blue")
    
    -- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    task.wait(3)
    if not isRunning then
        task.spawn(startAutoOptimizer)
    end
end

-- –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
task.spawn(initialize)

-- –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
return {
    quickOptimize = quickOptimize,
    startAutoOptimizer = startAutoOptimizer,
    stopOptimizer = stopOptimizer,
    updateGameData = updateGameData,
    getConfig = function() return Config end,
    setConfig = function(key, value)
        if Config[key] ~= nil then
            Config[key] = value
            return true
        end
        return false
    end,
    isRunning = function() return isRunning end,
    getStats = function() return statsData end
}
