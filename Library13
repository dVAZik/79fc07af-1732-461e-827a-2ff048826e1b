-- ElegantModMenu.lua (ModuleScript)
local ElegantModMenu = {}
ElegantModMenu.__index = ElegantModMenu

-- Конфигурация
local CONFIG = {
    WINDOW_WIDTH = 380,
    WINDOW_HEIGHT = 500,
    ELEMENT_HEIGHT = 42,
    PADDING = 14,
    CORNER_RADIUS = 12,
    ANIMATION_DURATION = 0.3,
    GLOW_INTENSITY = 0.8
}

-- Цветовая схема (тема "Фатима")
local COLORS = {
    THEME = {
        PRIMARY = Color3.fromRGB(180, 70, 160),    -- Основной фиолетово-розовый
        SECONDARY = Color3.fromRGB(210, 100, 190), -- Вторичный
        TERTIARY = Color3.fromRGB(150, 50, 130),   -- Третичный
        LIGHT = Color3.fromRGB(230, 180, 220)      -- Светлый
    },
    BACKGROUND = {
        PRIMARY = Color3.fromRGB(25, 20, 30),
        SECONDARY = Color3.fromRGB(35, 30, 40),
        TERTIARY = Color3.fromRGB(45, 40, 55),
        MODAL = Color3.fromRGB(0, 0, 0, 0.7)
    },
    ACCENT = {
        PRIMARY = Color3.fromRGB(0, 180, 255),
        SUCCESS = Color3.fromRGB(0, 220, 120),
        WARNING = Color3.fromRGB(255, 180, 0),
        ERROR = Color3.fromRGB(240, 80, 80)
    },
    TEXT = {
        PRIMARY = Color3.fromRGB(250, 240, 250),
        SECONDARY = Color3.fromRGB(200, 190, 210),
        DISABLED = Color3.fromRGB(130, 120, 140)
    },
    STATES = {
        HOVER = Color3.fromRGB(255, 255, 255, 0.1),
        PRESSED = Color3.fromRGB(255, 255, 255, 0.2),
        SELECTED = Color3.fromRGB(180, 70, 160, 0.3)
    }
}

-- Вспомогательные функции
local function tween(object, properties, duration)
    local tweenService = game:GetService("TweenService")
    local tweenInfo = TweenInfo.new(duration or CONFIG.ANIMATION_DURATION, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = tweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

local function createRoundedFrame()
    local frame = Instance.new("Frame")
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 0
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, CONFIG.CORNER_RADIUS)
    corner.Parent = frame
    
    return frame
end

local function createTextLabel(text, size, parent)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.TextColor3 = COLORS.TEXT.PRIMARY
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamSemibold
    label.TextSize = size
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextTransparency = 0
    
    if parent then
        label.Parent = parent
    end
    
    return label
end

local function createIcon(type, value, parent, size)
    if type == "emoji" then
        local label = Instance.new("TextLabel")
        label.Text = value
        label.TextColor3 = Color3.new(1, 1, 1)
        label.BackgroundTransparency = 1
        label.Font = Enum.Font.GothamSemibold
        label.TextSize = size or 20
        label.TextXAlignment = Enum.TextXAlignment.Center
        label.Parent = parent
        return label
    else -- image
        local image = Instance.new("ImageLabel")
        image.Image = value
        image.BackgroundTransparency = 1
        image.Size = UDim2.new(0, size or 24, 0, size or 24)
        image.ScaleType = Enum.ScaleType.Fit
        image.Parent = parent
        return image
    end
end

local function createButton()
    local button = Instance.new("TextButton")
    button.BackgroundTransparency = 1
    button.AutoButtonColor = false
    button.Text = ""
    button.ZIndex = 10
    
    local overlay = Instance.new("Frame")
    overlay.Name = "Overlay"
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundTransparency = 1
    overlay.BackgroundColor3 = Color3.new(1, 1, 1)
    overlay.BorderSizePixel = 0
    overlay.ZIndex = 11
    overlay.Parent = button
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, CONFIG.CORNER_RADIUS)
    corner.Parent = overlay
    
    return button
end

-- Конструктор
function ElegantModMenu.new(options)
    options = options or {}
    
    local self = setmetatable({}, ElegantModMenu)
    
    self.name = options.Name or "Fatima ♥️"
    self.icon = options.Icon or "♥️"
    self.accentColor = options.AccentColor or COLORS.THEME.PRIMARY
    
    self.sections = {}
    self.elements = {}
    self.currentSection = nil
    
    -- Настройки меню
    self.settings = {
        menuOpacity = 0.95,
        animationSpeed = 0.3,
        showWatermark = true,
        themeColor = self.accentColor
    }
    
    -- Настройки игры
    self.gameSettings = {
        nightMode = false,
        cameraFOV = 70,
        cameraSmoothing = true,
        customColors = false,
        originalColors = {}
    }
    
    self:cleanupOldMenus()
    self:createMainWindow()
    self:applyGameSettings() -- Применяем настройки игры
    
    return self
end

function ElegantModMenu:cleanupOldMenus()
    local coreGui = game:GetService("CoreGui")
    
    for _, child in pairs(coreGui:GetChildren()) do
        if child.Name == "ElegantModMenu" then
            child:Destroy()
        end
    end
end

function ElegantModMenu:createMainWindow()
    -- Основной GUI
    self.screenGui = Instance.new("ScreenGui")
    self.screenGui.Name = "ElegantModMenu"
    self.screenGui.ResetOnSpawn = false
    self.screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.screenGui.IgnoreGuiInset = true
    self.screenGui.Parent = game:GetService("CoreGui")
    
    -- Модальный фон
    self.modalBackground = Instance.new("Frame")
    self.modalBackground.Name = "ModalBackground"
    self.modalBackground.Size = UDim2.new(1, 0, 1, 0)
    self.modalBackground.BackgroundColor3 = COLORS.BACKGROUND.MODAL
    self.modalBackground.BackgroundTransparency = 1
    self.modalBackground.Visible = false
    self.modalBackground.ZIndex = 98
    self.modalBackground.Parent = self.screenGui
    
    local modalButton = Instance.new("TextButton")
    modalButton.Name = "ModalButton"
    modalButton.Size = UDim2.new(1, 0, 1, 0)
    modalButton.BackgroundTransparency = 1
    modalButton.Text = ""
    modalButton.ZIndex = 99
    modalButton.Parent = self.modalBackground
    
    modalButton.MouseButton1Click:Connect(function()
        self:hide()
    end)
    
    -- Основное окно
    self.window = Instance.new("Frame")
    self.window.Name = "Window"
    self.window.Size = UDim2.new(0, CONFIG.WINDOW_WIDTH, 0, 0)
    self.window.Position = UDim2.new(0.5, -CONFIG.WINDOW_WIDTH/2, 0.5, 0)
    self.window.BackgroundColor3 = COLORS.BACKGROUND.PRIMARY
    self.window.BackgroundTransparency = 1 - self.settings.menuOpacity
    self.window.ClipsDescendants = true
    self.window.Visible = false
    self.window.ZIndex = 100
    self.window.Parent = self.screenGui
    
    local windowCorner = Instance.new("UICorner")
    windowCorner.CornerRadius = UDim.new(0, 16)
    windowCorner.Parent = self.window
    
    local windowStroke = Instance.new("UIStroke")
    windowStroke.Color = COLORS.THEME.LIGHT
    windowStroke.Thickness = 1.5
    windowStroke.Transparency = 0.2
    windowStroke.Parent = self.window
    
    -- Водяной знак "Фатима ♥️" под углом 45°
    local watermark = Instance.new("TextLabel")
    watermark.Name = "Watermark"
    watermark.Size = UDim2.new(1, 100, 1, 100)
    watermark.Position = UDim2.new(-0.2, 0, -0.2, 0)
    watermark.BackgroundTransparency = 1
    watermark.Text = "Фатима ♥️"
    watermark.TextColor3 = COLORS.THEME.PRIMARY
    watermark.TextTransparency = 0.92
    watermark.Font = Enum.Font.GothamBold
    watermark.TextSize = 32
    watermark.TextXAlignment = Enum.TextXAlignment.Center
    watermark.TextYAlignment = Enum.TextYAlignment.Center
    watermark.Rotation = 45
    watermark.ZIndex = -1
    watermark.Parent = self.window
    
    -- Эффект свечения
    local glow = Instance.new("ImageLabel")
    glow.Name = "Glow"
    glow.Size = UDim2.new(1, 50, 1, 50)
    glow.Position = UDim2.new(0, -25, 0, -25)
    glow.BackgroundTransparency = 1
    glow.Image = "rbxassetid://8992231221"
    glow.ImageColor3 = self.accentColor
    glow.ImageTransparency = 0.85
    glow.ScaleType = Enum.ScaleType.Slice
    glow.SliceCenter = Rect.new(100, 100, 100, 100)
    glow.SliceScale = 0.02
    glow.ZIndex = -2
    glow.Parent = self.window
    
    -- Заголовок
    self.header = Instance.new("Frame")
    self.header.Name = "Header"
    self.header.Size = UDim2.new(1, 0, 0, 60)
    self.header.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    self.header.BackgroundTransparency = 1 - self.settings.menuOpacity
    self.header.ZIndex = 101
    self.header.Parent = self.window
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 16, 0, 0)
    headerCorner.Parent = self.header
    
    local headerGradient = Instance.new("UIGradient")
    headerGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, self.accentColor),
        ColorSequenceKeypoint.new(0.15, self.accentColor),
        ColorSequenceKeypoint.new(1, COLORS.BACKGROUND.SECONDARY)
    })
    headerGradient.Rotation = 90
    headerGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0.85),
        NumberSequenceKeypoint.new(1, 0.9)
    })
    headerGradient.Parent = self.header
    
    -- Иконка и название
    local titleContainer = Instance.new("Frame")
    titleContainer.Name = "TitleContainer"
    titleContainer.Size = UDim2.new(1, -100, 1, 0)
    titleContainer.Position = UDim2.new(0, 15, 0, 0)
    titleContainer.BackgroundTransparency = 1
    titleContainer.Parent = self.header
    
    self.titleIcon = createTextLabel(self.icon, 24, titleContainer)
    self.titleIcon.Size = UDim2.new(0, 40, 1, 0)
    self.titleIcon.TextXAlignment = Enum.TextXAlignment.Left
    self.titleIcon.Font = Enum.Font.GothamBold
    
    self.titleLabel = createTextLabel(self.name, 20, titleContainer)
    self.titleLabel.Size = UDim2.new(1, -45, 1, 0)
    self.titleLabel.Position = UDim2.new(0, 40, 0, 0)
    self.titleLabel.Font = Enum.Font.GothamBold
    self.titleLabel.TextColor3 = COLORS.TEXT.PRIMARY
    
    -- Кнопка настроек
    self.settingsButton = Instance.new("TextButton")
    self.settingsButton.Name = "SettingsButton"
    self.settingsButton.Size = UDim2.new(0, 36, 0, 36)
    self.settingsButton.Position = UDim2.new(1, -88, 0.5, -18)
    self.settingsButton.BackgroundColor3 = COLORS.THEME.SECONDARY
    self.settingsButton.BackgroundTransparency = 0.7
    self.settingsButton.Text = "⚙️"
    self.settingsButton.TextColor3 = COLORS.TEXT.PRIMARY
    self.settingsButton.TextSize = 18
    self.settingsButton.Font = Enum.Font.GothamBold
    self.settingsButton.AutoButtonColor = false
    self.settingsButton.ZIndex = 102
    self.settingsButton.Parent = self.header
    
    local settingsCorner = Instance.new("UICorner")
    settingsCorner.CornerRadius = UDim.new(0, 8)
    settingsCorner.Parent = self.settingsButton
    
    local settingsStroke = Instance.new("UIStroke")
    settingsStroke.Color = COLORS.THEME.SECONDARY
    settingsStroke.Thickness = 1
    settingsStroke.Transparency = 0.4
    settingsStroke.Parent = self.settingsButton
    
    self.settingsButton.MouseEnter:Connect(function()
        tween(self.settingsButton, {BackgroundTransparency = 0.5})
    end)
    
    self.settingsButton.MouseLeave:Connect(function()
        tween(self.settingsButton, {BackgroundTransparency = 0.7})
    end)
    
    self.settingsButton.MouseButton1Click:Connect(function()
        self:showSettingsMenu()
    end)
    
    -- Кнопка закрытия
    self.closeButton = Instance.new("TextButton")
    self.closeButton.Name = "CloseButton"
    self.closeButton.Size = UDim2.new(0, 36, 0, 36)
    self.closeButton.Position = UDim2.new(1, -42, 0.5, -18)
    self.closeButton.BackgroundColor3 = COLORS.ACCENT.ERROR
    self.closeButton.BackgroundTransparency = 0.7
    self.closeButton.Text = "✕"
    self.closeButton.TextColor3 = COLORS.TEXT.PRIMARY
    self.closeButton.TextSize = 18
    self.closeButton.Font = Enum.Font.GothamBold
    self.closeButton.AutoButtonColor = false
    self.closeButton.ZIndex = 102
    self.closeButton.Parent = self.header
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 8)
    closeCorner.Parent = self.closeButton
    
    local closeStroke = Instance.new("UIStroke")
    closeStroke.Color = COLORS.ACCENT.ERROR
    closeStroke.Thickness = 1
    closeStroke.Transparency = 0.4
    closeStroke.Parent = self.closeButton
    
    self.closeButton.MouseEnter:Connect(function()
        tween(self.closeButton, {BackgroundTransparency = 0.5})
    end)
    
    self.closeButton.MouseLeave:Connect(function()
        tween(self.closeButton, {BackgroundTransparency = 0.7})
    end)
    
    self.closeButton.MouseButton1Click:Connect(function()
        self:hide()
    end)
    
    -- Контент
    self.content = Instance.new("Frame")
    self.content.Name = "Content"
    self.content.Size = UDim2.new(1, -CONFIG.PADDING*2, 1, -80)
    self.content.Position = UDim2.new(0, CONFIG.PADDING, 0, 70)
    self.content.BackgroundTransparency = 1
    self.content.ClipsDescendants = true
    self.content.ZIndex = 103
    self.content.Parent = self.window
    
    -- Scrolling frame
    self.scrollingFrame = Instance.new("ScrollingFrame")
    self.scrollingFrame.Name = "ScrollingFrame"
    self.scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
    self.scrollingFrame.BackgroundTransparency = 1
    self.scrollingFrame.BorderSizePixel = 0
    self.scrollingFrame.ScrollBarThickness = 5
    self.scrollingFrame.ScrollBarImageColor3 = self.accentColor
    self.scrollingFrame.ScrollBarImageTransparency = 0.7
    self.scrollingFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    self.scrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    self.scrollingFrame.ZIndex = 104
    self.scrollingFrame.Parent = self.content
    
    -- UIListLayout
    self.uiListLayout = Instance.new("UIListLayout")
    self.uiListLayout.Padding = UDim.new(0, CONFIG.PADDING)
    self.uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    self.uiListLayout.Parent = self.scrollingFrame
    
    -- Фабричная кнопка
    self:createFabButton()
    
    -- Создаем меню настроек
    self:createSettingsMenu()
end

function ElegantModMenu:createFabButton()
    self.fabButton = Instance.new("TextButton")
    self.fabButton.Name = "FabButton"
    self.fabButton.Size = UDim2.new(0, 60, 0, 60)
    self.fabButton.Position = UDim2.new(1, -72, 1, -72)
    self.fabButton.BackgroundColor3 = self.accentColor
    self.fabButton.BackgroundTransparency = 0.2
    self.fabButton.Text = self.icon
    self.fabButton.TextColor3 = COLORS.TEXT.PRIMARY
    self.fabButton.TextSize = 24
    self.fabButton.Font = Enum.Font.GothamBold
    self.fabButton.AutoButtonColor = false
    self.fabButton.Visible = true
    self.fabButton.ZIndex = 200
    self.fabButton.Parent = self.screenGui
    
    local fabCorner = Instance.new("UICorner")
    fabCorner.CornerRadius = UDim.new(1, 0)
    fabCorner.Parent = self.fabButton
    
    local fabStroke = Instance.new("UIStroke")
    fabStroke.Color = Color3.fromRGB(255, 255, 255)
    fabStroke.Thickness = 2
    fabStroke.Transparency = 0.1
    fabStroke.Parent = self.fabButton
    
    -- Эффект свечения
    local fabGlow = Instance.new("ImageLabel")
    fabGlow.Name = "FabGlow"
    fabGlow.Size = UDim2.new(1, 25, 1, 25)
    fabGlow.Position = UDim2.new(0, -12.5, 0, -12.5)
    fabGlow.BackgroundTransparency = 1
    fabGlow.Image = "rbxassetid://8992231221"
    fabGlow.ImageColor3 = self.accentColor
    fabGlow.ImageTransparency = 0.85
    fabGlow.ScaleType = Enum.ScaleType.Slice
    fabGlow.SliceCenter = Rect.new(100, 100, 100, 100)
    fabGlow.SliceScale = 0.02
    fabGlow.ZIndex = -1
    fabGlow.Parent = self.fabButton
    
    -- Анимации при наведении
    self.fabButton.MouseEnter:Connect(function()
        tween(self.fabButton, {
            Size = UDim2.new(0, 65, 0, 65),
            BackgroundTransparency = 0.1
        })
        tween(fabGlow, {ImageTransparency = 0.75})
    end)
    
    self.fabButton.MouseLeave:Connect(function()
        tween(self.fabButton, {
            Size = UDim2.new(0, 60, 0, 60),
            BackgroundTransparency = 0.2
        })
        tween(fabGlow, {ImageTransparency = 0.85})
    end)
    
    self.fabButton.MouseButton1Click:Connect(function()
        self:show()
    end)
end

-- Основные методы
function ElegantModMenu:show()
    if self.window.Visible then return end
    
    -- Показываем модальный фон
    self.modalBackground.Visible = true
    tween(self.modalBackground, {BackgroundTransparency = 0.25})
    
    -- Показываем и анимируем окно
    self.window.Visible = true
    self.window.Size = UDim2.new(0, CONFIG.WINDOW_WIDTH, 0, 0)
    self.window.Position = UDim2.new(0.5, -CONFIG.WINDOW_WIDTH/2, 0.5, 0)
    
    tween(self.window, {
        Size = UDim2.new(0, CONFIG.WINDOW_WIDTH, 0, CONFIG.WINDOW_HEIGHT),
        Position = UDim2.new(0.5, -CONFIG.WINDOW_WIDTH/2, 0.5, -CONFIG.WINDOW_HEIGHT/2)
    }, 0.4)
    
    -- Прячем FAB
    self.fabButton.Visible = false
end

function ElegantModMenu:hide()
    if not self.window.Visible then return end
    
    -- Скрываем окно настроек если открыто
    if self.settingsWindow and self.settingsWindow.Visible then
        self:hideSettingsMenu()
    end
    
    -- Анимация скрытия окна
    tween(self.window, {
        Size = UDim2.new(0, CONFIG.WINDOW_WIDTH, 0, 0),
        Position = UDim2.new(0.5, -CONFIG.WINDOW_WIDTH/2, 0.5, 0)
    }, 0.35)
    
    tween(self.modalBackground, {BackgroundTransparency = 1})
    
    task.delay(0.35, function()
        self.window.Visible = false
        self.modalBackground.Visible = false
        self.fabButton.Visible = true
    end)
end

function ElegantModMenu:toggle()
    if self.window.Visible then
        self:hide()
    else
        self:show()
    end
end

-- Секции
function ElegantModMenu:addSection(name)
    local section = {
        name = name,
        elements = {}
    }
    
    table.insert(self.sections, section)
    self.currentSection = section
    
    -- Заголовок секции
    local sectionHeader = Instance.new("Frame")
    sectionHeader.Name = "SectionHeader"
    sectionHeader.Size = UDim2.new(1, 0, 0, 36)
    sectionHeader.BackgroundTransparency = 1
    sectionHeader.LayoutOrder = #self.elements + 1
    sectionHeader.ZIndex = 105
    sectionHeader.Parent = self.scrollingFrame
    
    local sectionContainer = Instance.new("Frame")
    sectionContainer.Name = "SectionContainer"
    sectionContainer.Size = UDim2.new(1, 0, 1, 0)
    sectionContainer.BackgroundTransparency = 1
    sectionContainer.Parent = sectionHeader
    
    local sectionLabel = createTextLabel(string.upper(name), 13, sectionContainer)
    sectionLabel.Size = UDim2.new(1, -12, 1, 0)
    sectionLabel.Position = UDim2.new(0, 12, 0, 0)
    sectionLabel.TextColor3 = self.accentColor
    sectionLabel.Font = Enum.Font.GothamBold
    sectionLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    local divider = Instance.new("Frame")
    divider.Name = "Divider"
    divider.Size = UDim2.new(0, 0, 0, 2)
    divider.Position = UDim2.new(0, 0, 1, -2)
    divider.BackgroundColor3 = self.accentColor
    divider.BackgroundTransparency = 0.6
    divider.BorderSizePixel = 0
    divider.Parent = sectionContainer
    
    tween(divider, {Size = UDim2.new(1, 0, 0, 2)}, 0.5)
    
    table.insert(self.elements, sectionHeader)
    
    return section
end

-- Кнопка (улучшенный стиль)
function ElegantModMenu:addButton(name, callback, icon, iconType)
    local buttonContainer = createRoundedFrame()
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    buttonContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    buttonContainer.BackgroundTransparency = 0.7
    buttonContainer.LayoutOrder = #self.elements + 1
    buttonContainer.ZIndex = 106
    buttonContainer.Parent = self.scrollingFrame
    
    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = self.accentColor
    buttonStroke.Thickness = 1.2
    buttonStroke.Transparency = 0.7
    buttonStroke.Parent = buttonContainer
    
    local button = createButton()
    button.Size = UDim2.new(1, 0, 1, 0)
    button.Parent = buttonContainer
    
    -- Контент
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -20, 1, 0)
    content.Position = UDim2.new(0, 10, 0, 0)
    content.BackgroundTransparency = 1
    content.Parent = buttonContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, content, 24)
            iconImage.Size = UDim2.new(0, 28, 0, 28)
            iconImage.Position = UDim2.new(0, 0, 0.5, -14)
        else
            local iconLabel = createIcon("emoji", icon, content, 18)
            iconLabel.Size = UDim2.new(0, 28, 0, 28)
            iconLabel.Position = UDim2.new(0, 0, 0.5, -14)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local textLabel = createTextLabel(name, 15, content)
    textLabel.Size = UDim2.new(1, icon and -35 or -15, 1, 0)
    textLabel.Position = icon and UDim2.new(0, 35, 0, 0) or UDim2.new(0, 5, 0, 0)
    textLabel.Font = Enum.Font.GothamSemibold
    
    local arrow = Instance.new("ImageLabel")
    arrow.Name = "Arrow"
    arrow.Size = UDim2.new(0, 18, 0, 18)
    arrow.Position = UDim2.new(1, -22, 0.5, -9)
    arrow.BackgroundTransparency = 1
    arrow.Image = "rbxassetid://10884537833"
    arrow.ImageColor3 = COLORS.TEXT.SECONDARY
    arrow.ZIndex = 107
    arrow.Parent = content
    
    -- Взаимодействие
    local overlay = button:FindFirstChild("Overlay")
    
    button.MouseEnter:Connect(function()
        tween(overlay, {BackgroundTransparency = 0.8})
        tween(arrow, {ImageColor3 = self.accentColor})
        tween(buttonStroke, {Transparency = 0.4})
        tween(buttonContainer, {BackgroundTransparency = 0.6})
    end)
    
    button.MouseLeave:Connect(function()
        tween(overlay, {BackgroundTransparency = 1})
        tween(arrow, {ImageColor3 = COLORS.TEXT.SECONDARY})
        tween(buttonStroke, {Transparency = 0.7})
        tween(buttonContainer, {BackgroundTransparency = 0.7})
    end)
    
    button.MouseButton1Down:Connect(function()
        tween(overlay, {BackgroundTransparency = 0.6})
    end)
    
    button.MouseButton1Up:Connect(function()
        tween(overlay, {BackgroundTransparency = 0.8})
    end)
    
    button.MouseButton1Click:Connect(function()
        if callback then
            callback()
        end
    end)
    
    table.insert(self.elements, buttonContainer)
    
    return buttonContainer
end

-- Переключатель
function ElegantModMenu:addToggle(name, defaultState, callback, icon, iconType)
    local state = defaultState or false
    
    local toggleContainer = createRoundedFrame()
    toggleContainer.Name = "ToggleContainer"
    toggleContainer.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    toggleContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    toggleContainer.BackgroundTransparency = 0.7
    toggleContainer.LayoutOrder = #self.elements + 1
    toggleContainer.ZIndex = 106
    toggleContainer.Parent = self.scrollingFrame
    
    local button = createButton()
    button.Size = UDim2.new(1, 0, 1, 0)
    button.Parent = toggleContainer
    
    -- Контент
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -20, 1, 0)
    content.Position = UDim2.new(0, 10, 0, 0)
    content.BackgroundTransparency = 1
    content.Parent = toggleContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, content, 22)
            iconImage.Size = UDim2.new(0, 26, 0, 26)
            iconImage.Position = UDim2.new(0, 0, 0.5, -13)
        else
            local iconLabel = createIcon("emoji", icon, content, 16)
            iconLabel.Size = UDim2.new(0, 26, 0, 26)
            iconLabel.Position = UDim2.new(0, 0, 0.5, -13)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local textLabel = createTextLabel(name, 15, content)
    textLabel.Size = UDim2.new(0.7, icon and -35 or -15, 1, 0)
    textLabel.Position = icon and UDim2.new(0, 35, 0, 0) or UDim2.new(0, 5, 0, 0)
    textLabel.Font = Enum.Font.GothamSemibold
    
    -- Тоггл
    local toggleBackground = Instance.new("Frame")
    toggleBackground.Name = "ToggleBackground"
    toggleBackground.Size = UDim2.new(0, 50, 0, 26)
    toggleBackground.Position = UDim2.new(1, -60, 0.5, -13)
    toggleBackground.BackgroundColor3 = state and self.accentColor or COLORS.BACKGROUND.TERTIARY
    toggleBackground.BorderSizePixel = 0
    toggleBackground.ZIndex = 107
    toggleBackground.Parent = content
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 13)
    toggleCorner.Parent = toggleBackground
    
    local toggleStroke = Instance.new("UIStroke")
    toggleStroke.Color = state and self.accentColor or COLORS.BACKGROUND.TERTIARY
    toggleStroke.Thickness = 1.5
    toggleStroke.Transparency = 0.4
    toggleStroke.Parent = toggleBackground
    
    local toggleCircle = Instance.new("Frame")
    toggleCircle.Name = "ToggleCircle"
    toggleCircle.Size = UDim2.new(0, 20, 0, 20)
    toggleCircle.Position = state and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
    toggleCircle.BackgroundColor3 = COLORS.TEXT.PRIMARY
    toggleCircle.BorderSizePixel = 0
    toggleCircle.ZIndex = 108
    toggleCircle.Parent = toggleBackground
    
    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(0.5, 0)
    circleCorner.Parent = toggleCircle
    
    -- Функция переключения
    local function setState(newState)
        state = newState
        
        tween(toggleBackground, {
            BackgroundColor3 = state and self.accentColor or COLORS.BACKGROUND.TERTIARY
        })
        
        tween(toggleStroke, {
            Color = state and self.accentColor or COLORS.BACKGROUND.TERTIARY
        })
        
        tween(toggleCircle, {
            Position = state and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
        })
        
        if callback then
            callback(state)
        end
    end
    
    button.MouseButton1Click:Connect(function()
        setState(not state)
    end)
    
    table.insert(self.elements, toggleContainer)
    
    return {
        setState = function(newState)
            setState(newState)
        end,
        getState = function()
            return state
        end
    }
end

-- Слайдер
function ElegantModMenu:addSlider(name, min, max, defaultValue, callback, icon, iconType)
    local value = defaultValue or min
    
    local sliderContainer = createRoundedFrame()
    sliderContainer.Name = "SliderContainer"
    sliderContainer.Size = UDim2.new(1, 0, 0, 70)
    sliderContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    sliderContainer.BackgroundTransparency = 0.7
    sliderContainer.LayoutOrder = #self.elements + 1
    sliderContainer.ZIndex = 106
    sliderContainer.Parent = self.scrollingFrame
    
    -- Заголовок
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, -20, 0, 24)
    header.Position = UDim2.new(0, 10, 0, 5)
    header.BackgroundTransparency = 1
    header.Parent = sliderContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, header, 20)
            iconImage.Size = UDim2.new(0, 24, 0, 24)
        else
            local iconLabel = createIcon("emoji", icon, header, 14)
            iconLabel.Size = UDim2.new(0, 24, 0, 24)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local nameLabel = createTextLabel(name, 14, header)
    nameLabel.Size = UDim2.new(0.6, icon and -30 or -5, 1, 0)
    nameLabel.Position = icon and UDim2.new(0, 30, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamSemibold
    
    local valueLabel = createTextLabel(tostring(value), 14, header)
    valueLabel.Size = UDim2.new(0.4, -5, 1, 0)
    valueLabel.Position = UDim2.new(0.6, 5, 0, 0)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.TextColor3 = self.accentColor
    valueLabel.Font = Enum.Font.GothamBold
    
    -- Трек слайдера
    local track = Instance.new("Frame")
    track.Name = "Track"
    track.Size = UDim2.new(1, -20, 0, 10)
    track.Position = UDim2.new(0, 10, 0, 45)
    track.BackgroundColor3 = COLORS.BACKGROUND.TERTIARY
    track.BorderSizePixel = 0
    track.ZIndex = 107
    track.Parent = sliderContainer
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 5)
    trackCorner.Parent = track
    
    local fill = Instance.new("Frame")
    fill.Name = "Fill"
    fill.Size = UDim2.new(0, 0, 1, 0)
    fill.BackgroundColor3 = self.accentColor
    fill.BorderSizePixel = 0
    fill.ZIndex = 108
    fill.Parent = track
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 5)
    fillCorner.Parent = fill
    
    local thumb = Instance.new("Frame")
    thumb.Name = "Thumb"
    thumb.Size = UDim2.new(0, 24, 0, 24)
    thumb.Position = UDim2.new(0, -12, 0.5, -12)
    thumb.BackgroundColor3 = COLORS.TEXT.PRIMARY
    thumb.BorderSizePixel = 0
    thumb.ZIndex = 109
    thumb.Parent = track
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(0.5, 0)
    thumbCorner.Parent = thumb
    
    local thumbStroke = Instance.new("UIStroke")
    thumbStroke.Color = self.accentColor
    thumbStroke.Thickness = 2
    thumbStroke.Parent = thumb
    
    -- Обновление значения
    local function updateValue(newValue)
        value = math.clamp(newValue, min, max)
        value = math.floor(value * 100) / 100
        
        local percentage = (value - min) / (max - min)
        
        fill.Size = UDim2.new(percentage, 0, 1, 0)
        thumb.Position = UDim2.new(percentage, -12, 0.5, -12)
        valueLabel.Text = string.format("%.1f", value)
        
        if callback then
            callback(value)
        end
    end
    
    -- Взаимодействие
    local dragging = false
    local userInputService = game:GetService("UserInputService")
    local mouseMoveConnection, mouseUpConnection
    
    -- Функция для обновления позиции при движении мыши
    local function updateFromMouse()
        if not dragging then return end
        
        local mouse = userInputService:GetMouseLocation()
        local trackAbsolute = track.AbsolutePosition
        local trackSize = track.AbsoluteSize
        
        local relativeX = (mouse.X - trackAbsolute.X) / trackSize.X
        local newValue = min + (max - min) * math.clamp(relativeX, 0, 1)
        updateValue(newValue)
    end
    
    -- Создаем кнопку для трека
    local trackButton = Instance.new("TextButton")
    trackButton.Size = UDim2.new(1, 0, 1, 0)
    trackButton.BackgroundTransparency = 1
    trackButton.Text = ""
    trackButton.ZIndex = 110
    trackButton.Parent = track
    
    -- Создаем кнопку для ползунка
    local thumbButton = Instance.new("TextButton")
    thumbButton.Size = UDim2.new(1, 0, 1, 0)
    thumbButton.BackgroundTransparency = 1
    thumbButton.Text = ""
    thumbButton.ZIndex = 111
    thumbButton.Parent = thumb
    
    -- Обработка клика по треку
    trackButton.MouseButton1Down:Connect(function()
        dragging = true
        
        mouseMoveConnection = userInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateFromMouse()
            end
        end)
        
        mouseUpConnection = userInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                if mouseMoveConnection then mouseMoveConnection:Disconnect() end
                if mouseUpConnection then mouseUpConnection:Disconnect() end
            end
        end)
        
        -- Немедленно обновляем позицию
        local mouse = userInputService:GetMouseLocation()
        local trackAbsolute = track.AbsolutePosition
        local trackSize = track.AbsoluteSize
        
        local relativeX = (mouse.X - trackAbsolute.X) / trackSize.X
        local newValue = min + (max - min) * math.clamp(relativeX, 0, 1)
        updateValue(newValue)
    end)
    
    -- Обработка клика по ползунку
    thumbButton.MouseButton1Down:Connect(function()
        dragging = true
        
        mouseMoveConnection = userInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateFromMouse()
            end
        end)
        
        mouseUpConnection = userInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                if mouseMoveConnection then mouseMoveConnection:Disconnect() end
                if mouseUpConnection then mouseUpConnection:Disconnect() end
            end
        end)
    end)
    
    -- Инициализация
    updateValue(value)
    
    table.insert(self.elements, sliderContainer)
    
    return {
        setValue = function(newValue)
            updateValue(newValue)
        end,
        getValue = function()
            return value
        end
    }
end

-- Текстовое поле (ButtonBox)
function ElegantModMenu:addButtonBox(name, placeholder, defaultText, callback, icon, iconType)
    local text = defaultText or ""
    
    local boxContainer = createRoundedFrame()
    boxContainer.Name = "ButtonBoxContainer"
    boxContainer.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    boxContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    boxContainer.BackgroundTransparency = 0.7
    boxContainer.LayoutOrder = #self.elements + 1
    boxContainer.ZIndex = 106
    boxContainer.Parent = self.scrollingFrame
    
    local boxStroke = Instance.new("UIStroke")
    boxStroke.Color = self.accentColor
    boxStroke.Thickness = 1.2
    boxStroke.Transparency = 0.7
    boxStroke.Parent = boxContainer
    
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -20, 1, 0)
    content.Position = UDim2.new(0, 10, 0, 0)
    content.BackgroundTransparency = 1
    content.Parent = boxContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, content, 20)
            iconImage.Size = UDim2.new(0, 26, 0, 26)
            iconImage.Position = UDim2.new(0, 0, 0.5, -13)
        else
            local iconLabel = createIcon("emoji", icon, content, 14)
            iconLabel.Size = UDim2.new(0, 26, 0, 26)
            iconLabel.Position = UDim2.new(0, 0, 0.5, -13)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local nameLabel = createTextLabel(name, 14, content)
    nameLabel.Size = UDim2.new(0.35, icon and -34 or -10, 1, 0)
    nameLabel.Position = icon and UDim2.new(0, 34, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamSemibold
    
    -- Поле ввода
    local textBox = Instance.new("TextBox")
    textBox.Name = "TextBox"
    textBox.Size = UDim2.new(0.4, -10, 0, 32)
    textBox.Position = UDim2.new(0.35, 10, 0.5, -16)
    textBox.BackgroundColor3 = COLORS.BACKGROUND.TERTIARY
    textBox.BorderSizePixel = 0
    textBox.Text = text
    textBox.PlaceholderText = placeholder or "Введите текст..."
    textBox.TextColor3 = COLORS.TEXT.PRIMARY
    textBox.PlaceholderColor3 = COLORS.TEXT.SECONDARY
    textBox.TextSize = 13
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = false
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.ZIndex = 107
    textBox.Parent = content
    
    local textBoxCorner = Instance.new("UICorner")
    textBoxCorner.CornerRadius = UDim.new(0, 8)
    textBoxCorner.Parent = textBox
    
    local textBoxPadding = Instance.new("UIPadding")
    textBoxPadding.PaddingLeft = UDim.new(0, 12)
    textBoxPadding.PaddingRight = UDim.new(0, 12)
    textBoxPadding.Parent = textBox
    
    local textBoxStroke = Instance.new("UIStroke")
    textBoxStroke.Color = self.accentColor
    textBoxStroke.Thickness = 1
    textBoxStroke.Transparency = 0.6
    textBoxStroke.Parent = textBox
    
    -- Кнопка отправки
    local sendButton = Instance.new("TextButton")
    sendButton.Name = "SendButton"
    sendButton.Size = UDim2.new(0, 65, 0, 32)
    sendButton.Position = UDim2.new(1, -70, 0.5, -16)
    sendButton.BackgroundColor3 = self.accentColor
    sendButton.BackgroundTransparency = 0.6
    sendButton.Text = "SEND"
    sendButton.TextColor3 = COLORS.TEXT.PRIMARY
    sendButton.TextSize = 12
    sendButton.Font = Enum.Font.GothamBold
    sendButton.AutoButtonColor = false
    sendButton.ZIndex = 107
    sendButton.Parent = content
    
    local sendCorner = Instance.new("UICorner")
    sendCorner.CornerRadius = UDim.new(0, 8)
    sendCorner.Parent = sendButton
    
    local sendStroke = Instance.new("UIStroke")
    sendStroke.Color = self.accentColor
    sendStroke.Thickness = 1
    sendStroke.Transparency = 0.4
    sendStroke.Parent = sendButton
    
    -- Взаимодействие
    sendButton.MouseEnter:Connect(function()
        tween(sendButton, {BackgroundTransparency = 0.4})
    end)
    
    sendButton.MouseLeave:Connect(function()
        tween(sendButton, {BackgroundTransparency = 0.6})
    end)
    
    sendButton.MouseButton1Click:Connect(function()
        local inputText = textBox.Text
        if inputText ~= "" and callback then
            callback(inputText)
            textBox.Text = ""
        end
    end)
    
    textBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and textBox.Text ~= "" and callback then
            callback(textBox.Text)
            textBox.Text = ""
        end
    end)
    
    table.insert(self.elements, boxContainer)
    
    return {
        setText = function(newText)
            text = newText
            textBox.Text = newText
        end,
        getText = function()
            return textBox.Text
        end
    }
end

-- Выпадающий список
function ElegantModMenu:addDropdown(name, options, defaultIndex, callback, icon, iconType)
    local selectedIndex = defaultIndex or 1
    local isOpen = false
    
    local dropdownContainer = createRoundedFrame()
    dropdownContainer.Name = "DropdownContainer"
    dropdownContainer.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    dropdownContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    dropdownContainer.BackgroundTransparency = 0.7
    dropdownContainer.LayoutOrder = #self.elements + 1
    dropdownContainer.ClipsDescendants = false
    dropdownContainer.ZIndex = 106
    dropdownContainer.Parent = self.scrollingFrame
    
    local dropdownStroke = Instance.new("UIStroke")
    dropdownStroke.Color = self.accentColor
    dropdownStroke.Thickness = 1.2
    dropdownStroke.Transparency = 0.7
    dropdownStroke.Parent = dropdownContainer
    
    local button = createButton()
    button.Name = "DropdownButton"
    button.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    button.ZIndex = 107
    button.Parent = dropdownContainer
    
    -- Контент
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -20, 1, 0)
    content.Position = UDim2.new(0, 10, 0, 0)
    content.BackgroundTransparency = 1
    content.ZIndex = 108
    content.Parent = dropdownContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, content, 20)
            iconImage.Size = UDim2.new(0, 26, 0, 26)
            iconImage.Position = UDim2.new(0, 0, 0.5, -13)
        else
            local iconLabel = createIcon("emoji", icon, content, 14)
            iconLabel.Size = UDim2.new(0, 26, 0, 26)
            iconLabel.Position = UDim2.new(0, 0, 0.5, -13)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local nameLabel = createTextLabel(name, 14, content)
    nameLabel.Size = UDim2.new(0.5, icon and -34 or -10, 1, 0)
    nameLabel.Position = icon and UDim2.new(0, 34, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamSemibold
    nameLabel.ZIndex = 109
    
    local selectedLabel = createTextLabel(options[selectedIndex] or "Выберите...", 13, content)
    selectedLabel.Size = UDim2.new(0.3, -10, 1, 0)
    selectedLabel.Position = UDim2.new(0.5, 10, 0, 0)
    selectedLabel.TextXAlignment = Enum.TextXAlignment.Right
    selectedLabel.TextColor3 = self.accentColor
    selectedLabel.Font = Enum.Font.GothamMedium
    selectedLabel.ZIndex = 109
    
    local arrow = Instance.new("ImageLabel")
    arrow.Name = "Arrow"
    arrow.Size = UDim2.new(0, 18, 0, 18)
    arrow.Position = UDim2.new(1, -22, 0.5, -9)
    arrow.BackgroundTransparency = 1
    arrow.Image = "rbxassetid://10884537837"
    arrow.ImageColor3 = COLORS.TEXT.SECONDARY
    arrow.Rotation = isOpen and 180 or 0
    arrow.ZIndex = 109
    arrow.Parent = content
    
    -- Контейнер для опций
    local optionsOuterContainer = Instance.new("Frame")
    optionsOuterContainer.Name = "OptionsOuterContainer"
    optionsOuterContainer.Size = UDim2.new(1, 0, 0, 0)
    optionsOuterContainer.Position = UDim2.new(0, 0, 1, 5)
    optionsOuterContainer.BackgroundTransparency = 1
    optionsOuterContainer.Visible = false
    optionsOuterContainer.ClipsDescendants = true
    optionsOuterContainer.ZIndex = 150
    optionsOuterContainer.Parent = dropdownContainer
    
    -- ScrollingFrame для опций
    local optionsScrolling = Instance.new("ScrollingFrame")
    optionsScrolling.Name = "OptionsScrolling"
    optionsScrolling.Size = UDim2.new(1, 0, 0, 0)
    optionsScrolling.Position = UDim2.new(0, 0, 0, 0)
    optionsScrolling.BackgroundColor3 = COLORS.BACKGROUND.PRIMARY
    optionsScrolling.BackgroundTransparency = 0.1
    optionsScrolling.BorderSizePixel = 0
    optionsScrolling.ScrollBarThickness = 5
    optionsScrolling.ScrollBarImageColor3 = self.accentColor
    optionsScrolling.ScrollBarImageTransparency = 0.7
    optionsScrolling.ScrollingDirection = Enum.ScrollingDirection.Y
    optionsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    optionsScrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    optionsScrolling.ZIndex = 151
    optionsScrolling.Parent = optionsOuterContainer
    
    local optionsCorner = Instance.new("UICorner")
    optionsCorner.CornerRadius = UDim.new(0, 10)
    optionsCorner.Parent = optionsScrolling
    
    local optionsStroke = Instance.new("UIStroke")
    optionsStroke.Color = self.accentColor
    optionsStroke.Thickness = 1
    optionsStroke.Transparency = 0.6
    optionsStroke.ZIndex = 151
    optionsStroke.Parent = optionsScrolling
    
    local optionsList = Instance.new("UIListLayout")
    optionsList.Padding = UDim.new(0, 2)
    optionsList.SortOrder = Enum.SortOrder.LayoutOrder
    optionsList.Parent = optionsScrolling
    
    -- Создание опций
    local optionButtons = {}
    for i, option in ipairs(options) do
        local optionButton = createButton()
        optionButton.Name = "OptionButton"
        optionButton.Size = UDim2.new(1, -10, 0, 32)
        optionButton.Position = UDim2.new(0, 5, 0, (i-1)*34)
        optionButton.BackgroundColor3 = i == selectedIndex and self.accentColor or COLORS.BACKGROUND.SECONDARY
        optionButton.BackgroundTransparency = i == selectedIndex and 0.7 or 0.8
        optionButton.LayoutOrder = i
        optionButton.ZIndex = 152
        optionButton.Parent = optionsScrolling
        
        local optionCorner = Instance.new("UICorner")
        optionCorner.CornerRadius = UDim.new(0, 8)
        optionCorner.Parent = optionButton
        
        local optionLabel = createTextLabel(option, 13, optionButton)
        optionLabel.Size = UDim2.new(1, -10, 1, 0)
        optionLabel.Position = UDim2.new(0, 10, 0, 0)
        optionLabel.TextColor3 = i == selectedIndex and COLORS.TEXT.PRIMARY or COLORS.TEXT.SECONDARY
        optionLabel.ZIndex = 153
        
        table.insert(optionButtons, optionButton)
        
        optionButton.MouseButton1Click:Connect(function()
            selectedIndex = i
            selectedLabel.Text = option
            isOpen = false
            
            -- Обновляем стиль всех кнопок
            for btnIndex, btn in ipairs(optionButtons) do
                btn.BackgroundColor3 = btnIndex == i and self.accentColor or COLORS.BACKGROUND.SECONDARY
                btn.BackgroundTransparency = btnIndex == i and 0.7 or 0.8
                btn:FindFirstChildOfClass("TextLabel").TextColor3 = btnIndex == i and COLORS.TEXT.PRIMARY or COLORS.TEXT.SECONDARY
            end
            
            -- Анимация закрытия
            tween(optionsOuterContainer, {Size = UDim2.new(1, 0, 0, 0)})
            tween(optionsScrolling, {Size = UDim2.new(1, 0, 0, 0)})
            tween(arrow, {Rotation = 0})
            
            task.delay(0.2, function()
                optionsOuterContainer.Visible = false
            end)
            
            if callback then
                callback(option, i)
            end
        end)
    end
    
    -- Переключение видимости
    button.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        
        if isOpen then
            optionsOuterContainer.Visible = true
            local maxHeight = 160
            local itemHeight = 34
            local optionsHeight = math.min(#options * itemHeight, maxHeight)
            
            tween(optionsOuterContainer, {Size = UDim2.new(1, 0, 0, optionsHeight)})
            tween(optionsScrolling, {Size = UDim2.new(1, 0, 0, optionsHeight)})
            tween(arrow, {Rotation = 180})
        else
            tween(optionsOuterContainer, {Size = UDim2.new(1, 0, 0, 0)})
            tween(optionsScrolling, {Size = UDim2.new(1, 0, 0, 0)})
            tween(arrow, {Rotation = 0})
            
            task.delay(0.2, function()
                optionsOuterContainer.Visible = false
            end)
        end
    end)
    
    table.insert(self.elements, dropdownContainer)
    
    return {
        setSelected = function(index)
            if options[index] then
                selectedIndex = index
                selectedLabel.Text = options[index]
                
                for btnIndex, btn in ipairs(optionButtons) do
                    btn.BackgroundColor3 = btnIndex == index and self.accentColor or COLORS.BACKGROUND.SECONDARY
                    btn.BackgroundTransparency = btnIndex == index and 0.7 or 0.8
                    btn:FindFirstChildOfClass("TextLabel").TextColor3 = btnIndex == index and COLORS.TEXT.PRIMARY or COLORS.TEXT.SECONDARY
                end
                
                if callback then
                    callback(options[index], index)
                end
            end
        end,
        getSelected = function()
            return selectedIndex, options[selectedIndex]
        end
    }
end

-- Выбор цвета (ИСПРАВЛЕННЫЙ)
function ElegantModMenu:addColorPicker(name, defaultColor, callback, icon, iconType)
    local currentColor = defaultColor or self.accentColor
    
    local colorContainer = createRoundedFrame()
    colorContainer.Name = "ColorPickerContainer"
    colorContainer.Size = UDim2.new(1, 0, 0, CONFIG.ELEMENT_HEIGHT)
    colorContainer.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    colorContainer.BackgroundTransparency = 0.7
    colorContainer.LayoutOrder = #self.elements + 1
    colorContainer.ZIndex = 106
    colorContainer.Parent = self.scrollingFrame
    
    local button = createButton()
    button.Name = "ColorPickerButton"
    button.Size = UDim2.new(1, 0, 1, 0)
    button.Parent = colorContainer
    
    -- Контент
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -20, 1, 0)
    content.Position = UDim2.new(0, 10, 0, 0)
    content.BackgroundTransparency = 1
    content.Parent = colorContainer
    
    if icon then
        if iconType == "image" then
            local iconImage = createIcon("image", icon, content, 20)
            iconImage.Size = UDim2.new(0, 26, 0, 26)
            iconImage.Position = UDim2.new(0, 0, 0.5, -13)
        else
            local iconLabel = createIcon("emoji", icon, content, 14)
            iconLabel.Size = UDim2.new(0, 26, 0, 26)
            iconLabel.Position = UDim2.new(0, 0, 0.5, -13)
            iconLabel.TextXAlignment = Enum.TextXAlignment.Left
        end
    end
    
    local nameLabel = createTextLabel(name, 14, content)
    nameLabel.Size = UDim2.new(0.7, icon and -34 or -10, 1, 0)
    nameLabel.Position = icon and UDim2.new(0, 34, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamSemibold
    
    local preview = Instance.new("Frame")
    preview.Name = "ColorPreview"
    preview.Size = UDim2.new(0, 36, 0, 36)
    preview.Position = UDim2.new(1, -46, 0.5, -18)
    preview.BackgroundColor3 = currentColor
    preview.BorderSizePixel = 0
    preview.ZIndex = 107
    preview.Parent = content
    
    local previewCorner = Instance.new("UICorner")
    previewCorner.CornerRadius = UDim.new(0, 10)
    previewCorner.Parent = preview
    
    local previewStroke = Instance.new("UIStroke")
    previewStroke.Color = Color3.new(1, 1, 1)
    previewStroke.Thickness = 2
    previewStroke.Transparency = 0.1
    previewStroke.Parent = preview
    
    -- Панель выбора цвета
    local colorPickerWindow = Instance.new("Frame")
    colorPickerWindow.Name = "ColorPickerWindow"
    colorPickerWindow.Size = UDim2.new(0, 250, 0, 180)
    colorPickerWindow.Position = UDim2.new(1, 10, 0, 0)
    colorPickerWindow.BackgroundColor3 = COLORS.BACKGROUND.PRIMARY
    colorPickerWindow.BackgroundTransparency = 0.1
    colorPickerWindow.Visible = false
    colorPickerWindow.ZIndex = 200
    colorPickerWindow.Parent = colorContainer
    
    local pickerCorner = Instance.new("UICorner")
    pickerCorner.CornerRadius = UDim.new(0, 12)
    pickerCorner.Parent = colorPickerWindow
    
    local pickerStroke = Instance.new("UIStroke")
    pickerStroke.Color = self.accentColor
    pickerStroke.Thickness = 1.5
    pickerStroke.Transparency = 0.4
    pickerStroke.Parent = colorPickerWindow
    
    -- Палитра цветов
    local colorsGrid = Instance.new("UIGridLayout")
    colorsGrid.CellPadding = UDim2.new(0, 6, 0, 6)
    colorsGrid.CellSize = UDim2.new(0, 30, 0, 30)
    colorsGrid.StartCorner = Enum.StartCorner.TopLeft
    colorsGrid.SortOrder = Enum.SortOrder.LayoutOrder
    colorsGrid.Parent = colorPickerWindow
    
    local colors = {
        Color3.fromRGB(255, 50, 50),    -- Красный
        Color3.fromRGB(255, 120, 50),   -- Оранжевый
        Color3.fromRGB(255, 220, 50),   -- Желтый
        Color3.fromRGB(50, 255, 100),   -- Зеленый
        Color3.fromRGB(50, 200, 255),   -- Голубой
        Color3.fromRGB(80, 100, 255),   -- Синий
        Color3.fromRGB(180, 70, 160),   -- Фиолетовый (тема)
        Color3.fromRGB(255, 100, 200),  -- Розовый
        Color3.fromRGB(255, 255, 255),  -- Белый
        Color3.fromRGB(200, 200, 200),  -- Серый
        Color3.fromRGB(100, 100, 100),  -- Темно-серый
        Color3.fromRGB(30, 30, 30)      -- Черный
    }
    
    for _, color in ipairs(colors) do
        local colorButton = Instance.new("TextButton")
        colorButton.Size = UDim2.new(0, 30, 0, 30)
        colorButton.BackgroundColor3 = color
        colorButton.BorderSizePixel = 0
        colorButton.Text = ""
        colorButton.ZIndex = 201
        colorButton.Parent = colorPickerWindow
        
        local colorCorner = Instance.new("UICorner")
        colorCorner.CornerRadius = UDim.new(0, 6)
        colorCorner.Parent = colorButton
        
        local colorStroke = Instance.new("UIStroke")
        colorStroke.Color = Color3.new(1, 1, 1)
        colorStroke.Thickness = 1
        colorStroke.Transparency = 0.7
        colorStroke.Parent = colorButton
        
        colorButton.MouseEnter:Connect(function()
            tween(colorStroke, {Transparency = 0.3})
        end)
        
        colorButton.MouseLeave:Connect(function()
            tween(colorStroke, {Transparency = 0.7})
        end)
        
        colorButton.MouseButton1Click:Connect(function()
            currentColor = color
            preview.BackgroundColor3 = color
            
            if callback then
                callback(color)
            end
            
            colorPickerWindow.Visible = false
        end)
    end
    
    -- Кнопка закрытия палитры
    local closePickerButton = Instance.new("TextButton")
    closePickerButton.Size = UDim2.new(0, 32, 0, 32)
    closePickerButton.Position = UDim2.new(1, -36, 0, 4)
    closePickerButton.BackgroundColor3 = COLORS.ACCENT.ERROR
    closePickerButton.BackgroundTransparency = 0.7
    closePickerButton.Text = "✕"
    closePickerButton.TextColor3 = COLORS.TEXT.PRIMARY
    closePickerButton.TextSize = 16
    closePickerButton.Font = Enum.Font.GothamBold
    closePickerButton.AutoButtonColor = false
    closePickerButton.ZIndex = 201
    closePickerButton.Parent = colorPickerWindow
    
    local closePickerCorner = Instance.new("UICorner")
    closePickerCorner.CornerRadius = UDim.new(0, 6)
    closePickerCorner.Parent = closePickerButton
    
    closePickerButton.MouseButton1Click:Connect(function()
        colorPickerWindow.Visible = false
    end)
    
    -- Открытие палитры по клику на превью
    preview.MouseButton1Click:Connect(function()
        colorPickerWindow.Visible = not colorPickerWindow.Visible
    end)
    
    button.MouseButton1Click:Connect(function()
        colorPickerWindow.Visible = not colorPickerWindow.Visible
    end)
    
    table.insert(self.elements, colorContainer)
    
    return {
        setColor = function(color)
            currentColor = color
            preview.BackgroundColor3 = color
            if callback then
                callback(color)
            end
        end,
        getColor = function()
            return currentColor
        end
    }
end

-- Создание меню настроек
function ElegantModMenu:createSettingsMenu()
    self.settingsWindow = Instance.new("Frame")
    self.settingsWindow.Name = "SettingsWindow"
    self.settingsWindow.Size = UDim2.new(0, 350, 0, 0)
    self.settingsWindow.Position = UDim2.new(0.5, -175, 0.5, 0)
    self.settingsWindow.BackgroundColor3 = COLORS.BACKGROUND.PRIMARY
    self.settingsWindow.BackgroundTransparency = 0.1
    self.settingsWindow.ClipsDescendants = true
    self.settingsWindow.Visible = false
    self.settingsWindow.ZIndex = 300
    self.settingsWindow.Parent = self.screenGui
    
    local settingsCorner = Instance.new("UICorner")
    settingsCorner.CornerRadius = UDim.new(0, 16)
    settingsCorner.Parent = self.settingsWindow
    
    local settingsStroke = Instance.new("UIStroke")
    settingsStroke.Color = self.accentColor
    settingsStroke.Thickness = 1.5
    settingsStroke.Transparency = 0.3
    settingsStroke.Parent = self.settingsWindow
    
    -- Заголовок настроек
    local settingsHeader = Instance.new("Frame")
    settingsHeader.Name = "SettingsHeader"
    settingsHeader.Size = UDim2.new(1, 0, 0, 60)
    settingsHeader.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    settingsHeader.BackgroundTransparency = 0.1
    settingsHeader.ZIndex = 301
    settingsHeader.Parent = self.settingsWindow
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 16, 0, 0)
    headerCorner.Parent = settingsHeader
    
    local settingsTitle = createTextLabel("НАСТРОЙКИ", 22, settingsHeader)
    settingsTitle.Size = UDim2.new(1, -20, 1, 0)
    settingsTitle.Position = UDim2.new(0, 15, 0, 0)
    settingsTitle.Font = Enum.Font.GothamBold
    settingsTitle.TextColor3 = self.accentColor
    
    local closeSettingsButton = Instance.new("TextButton")
    closeSettingsButton.Name = "CloseSettingsButton"
    closeSettingsButton.Size = UDim2.new(0, 36, 0, 36)
    closeSettingsButton.Position = UDim2.new(1, -42, 0.5, -18)
    closeSettingsButton.BackgroundColor3 = COLORS.ACCENT.ERROR
    closeSettingsButton.BackgroundTransparency = 0.7
    closeSettingsButton.Text = "✕"
    closeSettingsButton.TextColor3 = COLORS.TEXT.PRIMARY
    closeSettingsButton.TextSize = 18
    closeSettingsButton.Font = Enum.Font.GothamBold
    closeSettingsButton.AutoButtonColor = false
    closeSettingsButton.ZIndex = 302
    closeSettingsButton.Parent = settingsHeader
    
    local closeSettingsCorner = Instance.new("UICorner")
    closeSettingsCorner.CornerRadius = UDim.new(0, 8)
    closeSettingsCorner.Parent = closeSettingsButton
    
    closeSettingsButton.MouseButton1Click:Connect(function()
        self:hideSettingsMenu()
    end)
    
    -- Контент настроек
    local settingsContent = Instance.new("Frame")
    settingsContent.Name = "SettingsContent"
    settingsContent.Size = UDim2.new(1, -CONFIG.PADDING*2, 1, -75)
    settingsContent.Position = UDim2.new(0, CONFIG.PADDING, 0, 70)
    settingsContent.BackgroundTransparency = 1
    settingsContent.ClipsDescendants = true
    settingsContent.ZIndex = 303
    settingsContent.Parent = self.settingsWindow
    
    local settingsScrolling = Instance.new("ScrollingFrame")
    settingsScrolling.Name = "SettingsScrolling"
    settingsScrolling.Size = UDim2.new(1, 0, 1, 0)
    settingsScrolling.BackgroundTransparency = 1
    settingsScrolling.BorderSizePixel = 0
    settingsScrolling.ScrollBarThickness = 5
    settingsScrolling.ScrollBarImageColor3 = self.accentColor
    settingsScrolling.ScrollBarImageTransparency = 0.7
    settingsScrolling.ScrollingDirection = Enum.ScrollingDirection.Y
    settingsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    settingsScrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    settingsScrolling.ZIndex = 304
    settingsScrolling.Parent = settingsContent
    
    local settingsList = Instance.new("UIListLayout")
    settingsList.Padding = UDim.new(0, 12)
    settingsList.SortOrder = Enum.SortOrder.LayoutOrder
    settingsList.Parent = settingsScrolling
    
    -- Настройки меню
    local menuSection = self:createSettingsSection("Настройки меню", settingsScrolling)
    
    -- Прозрачность меню
    local opacityToggle = self:createSettingsToggle("Прозрачность меню", self.settings.menuOpacity * 100, 10, 100, function(value)
        self.settings.menuOpacity = value / 100
        self.window.BackgroundTransparency = 1 - self.settings.menuOpacity
        self.header.BackgroundTransparency = 1 - self.settings.menuOpacity
    end, "🎨")
    opacityToggle.Parent = menuSection
    
    -- Показывать водяной знак
    local watermarkToggle = self:createSettingsToggle("Водяной знак", self.settings.showWatermark, function(state)
        self.settings.showWatermark = state
        if self.window:FindFirstChild("Watermark") then
            self.window.Watermark.Visible = state
        end
    end, "💧")
    watermarkToggle.Parent = menuSection
    
    -- Настройки игры
    local gameSection = self:createSettingsSection("Настройки игры", settingsScrolling)
    
    -- Ночной режим
    local nightModeToggle = self:createSettingsToggle("Ночной режим", self.gameSettings.nightMode, function(state)
        self.gameSettings.nightMode = state
        self:toggleNightMode(state)
    end, "🌙")
    nightModeToggle.Parent = gameSection
    
    -- Настройки камеры
    local cameraFOVSlider = self:createSettingsSlider("FOV камеры", 50, 120, self.gameSettings.cameraFOV, function(value)
        self.gameSettings.cameraFOV = value
        self:setCameraFOV(value)
    end, "📷")
    cameraFOVSlider.Parent = gameSection
    
    -- Сглаживание камеры
    local cameraSmoothToggle = self:createSettingsToggle("Сглаживание камеры", self.gameSettings.cameraSmoothing, function(state)
        self.gameSettings.cameraSmoothing = state
        self:setCameraSmoothing(state)
    end, "⚡")
    cameraSmoothToggle.Parent = gameSection
    
    -- Полезные функции
    local toolsSection = self:createSettingsSection("Полезные функции", settingsScrolling)
    
    -- Экспресс-функции
    local quickFunctions = {
        {"💾 Сохранить игру", function() self:saveGameState() end},
        {"🔍 Поиск игроков", function() self:searchPlayers() end},
        {"🛠️ Исправить баги", function() self:fixCommonBugs() end},
        {"📊 Статистика", function() self:showStatistics() end},
        {"🎯 Прицел", function() self:toggleCrosshair() end},
        {"⚡ Ускорение", function() self:toggleSpeedBoost() end}
    }
    
    for _, funcData in ipairs(quickFunctions) do
        local funcButton = self:createSettingsButton(funcData[1], funcData[2])
        funcButton.Parent = toolsSection
    end
    
    -- Кнопка сброса настроек
    local resetButton = Instance.new("TextButton")
    resetButton.Name = "ResetButton"
    resetButton.Size = UDim2.new(1, 0, 0, 40)
    resetButton.BackgroundColor3 = COLORS.ACCENT.ERROR
    resetButton.BackgroundTransparency = 0.7
    resetButton.Text = "СБРОС НАСТРОЕК"
    resetButton.TextColor3 = COLORS.TEXT.PRIMARY
    resetButton.TextSize = 14
    resetButton.Font = Enum.Font.GothamBold
    resetButton.AutoButtonColor = false
    resetButton.LayoutOrder = 999
    resetButton.Parent = settingsScrolling
    
    local resetCorner = Instance.new("UICorner")
    resetCorner.CornerRadius = UDim.new(0, 10)
    resetCorner.Parent = resetButton
    
    resetButton.MouseEnter:Connect(function()
        tween(resetButton, {BackgroundTransparency = 0.5})
    end)
    
    resetButton.MouseLeave:Connect(function()
        tween(resetButton, {BackgroundTransparency = 0.7})
    end)
    
    resetButton.MouseButton1Click:Connect(function()
        self:resetSettings()
    end)
end

function ElegantModMenu:createSettingsSection(name, parent)
    local section = Instance.new("Frame")
    section.Name = "SettingsSection"
    section.Size = UDim2.new(1, 0, 0, 0)
    section.BackgroundTransparency = 1
    section.AutomaticSize = Enum.AutomaticSize.Y
    section.LayoutOrder = #parent:GetChildren()
    section.Parent = parent
    
    local sectionTitle = createTextLabel(string.upper(name), 12, section)
    sectionTitle.Size = UDim2.new(1, 0, 0, 20)
    sectionTitle.TextColor3 = self.accentColor
    sectionTitle.Font = Enum.Font.GothamBold
    
    local sectionContainer = Instance.new("Frame")
    sectionContainer.Name = "SectionContainer"
    sectionContainer.Size = UDim2.new(1, 0, 0, 0)
    sectionContainer.Position = UDim2.new(0, 0, 0, 25)
    sectionContainer.BackgroundTransparency = 1
    sectionContainer.AutomaticSize = Enum.AutomaticSize.Y
    sectionContainer.Parent = section
    
    local sectionList = Instance.new("UIListLayout")
    sectionList.Padding = UDim.new(0, 8)
    sectionList.SortOrder = Enum.SortOrder.LayoutOrder
    sectionList.Parent = sectionContainer
    
    return sectionContainer
end

function ElegantModMenu:createSettingsToggle(name, state, callback, icon)
    local toggleContainer = Instance.new("Frame")
    toggleContainer.Name = "SettingsToggle"
    toggleContainer.Size = UDim2.new(1, 0, 0, 35)
    toggleContainer.BackgroundTransparency = 1
    toggleContainer.LayoutOrder = #toggleContainer.Parent:GetChildren()
    
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, 0, 1, 0)
    content.BackgroundTransparency = 1
    content.Parent = toggleContainer
    
    if icon then
        local iconLabel = createIcon("emoji", icon, content, 16)
        iconLabel.Size = UDim2.new(0, 24, 0, 24)
        iconLabel.Position = UDim2.new(0, 0, 0.5, -12)
        iconLabel.TextXAlignment = Enum.TextXAlignment.Left
    end
    
    local nameLabel = createTextLabel(name, 14, content)
    nameLabel.Size = UDim2.new(0.7, icon and -30 or -10, 1, 0)
    nameLabel.Position = icon and UDim2.new(0, 30, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamMedium
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Size = UDim2.new(0, 50, 0, 26)
    toggleButton.Position = UDim2.new(1, -55, 0.5, -13)
    toggleButton.BackgroundColor3 = state and self.accentColor or COLORS.BACKGROUND.TERTIARY
    toggleButton.BackgroundTransparency = 0.3
    toggleButton.Text = ""
    toggleButton.AutoButtonColor = false
    toggleButton.Parent = content
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 13)
    toggleCorner.Parent = toggleButton
    
    local toggleCircle = Instance.new("Frame")
    toggleCircle.Name = "ToggleCircle"
    toggleCircle.Size = UDim2.new(0, 20, 0, 20)
    toggleCircle.Position = state and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
    toggleCircle.BackgroundColor3 = COLORS.TEXT.PRIMARY
    toggleCircle.BorderSizePixel = 0
    toggleCircle.Parent = toggleButton
    
    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(0.5, 0)
    circleCorner.Parent = toggleCircle
    
    toggleButton.MouseButton1Click:Connect(function()
        local newState = not state
        state = newState
        
        tween(toggleButton, {
            BackgroundColor3 = newState and self.accentColor or COLORS.BACKGROUND.TERTIARY
        })
        
        tween(toggleCircle, {
            Position = newState and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
        })
        
        if callback then
            callback(newState)
        end
    end)
    
    return toggleContainer
end

function ElegantModMenu:createSettingsSlider(name, min, max, value, callback, icon)
    local sliderContainer = Instance.new("Frame")
    sliderContainer.Name = "SettingsSlider"
    sliderContainer.Size = UDim2.new(1, 0, 0, 60)
    sliderContainer.BackgroundTransparency = 1
    sliderContainer.LayoutOrder = #sliderContainer.Parent:GetChildren()
    
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, 0, 1, 0)
    content.BackgroundTransparency = 1
    content.Parent = sliderContainer
    
    if icon then
        local iconLabel = createIcon("emoji", icon, content, 16)
        iconLabel.Size = UDim2.new(0, 24, 0, 24)
        iconLabel.Position = UDim2.new(0, 0, 0, 0)
        iconLabel.TextXAlignment = Enum.TextXAlignment.Left
    end
    
    local nameLabel = createTextLabel(name, 14, content)
    nameLabel.Size = UDim2.new(0.6, icon and -30 or -10, 0, 24)
    nameLabel.Position = icon and UDim2.new(0, 30, 0, 0) or UDim2.new(0, 0, 0, 0)
    nameLabel.Font = Enum.Font.GothamMedium
    
    local valueLabel = createTextLabel(tostring(value), 14, content)
    valueLabel.Size = UDim2.new(0.4, -10, 0, 24)
    valueLabel.Position = UDim2.new(0.6, 10, 0, 0)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.TextColor3 = self.accentColor
    valueLabel.Font = Enum.Font.GothamBold
    
    local track = Instance.new("Frame")
    track.Name = "Track"
    track.Size = UDim2.new(1, 0, 0, 8)
    track.Position = UDim2.new(0, 0, 1, -15)
    track.BackgroundColor3 = COLORS.BACKGROUND.TERTIARY
    track.BorderSizePixel = 0
    track.Parent = content
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 4)
    trackCorner.Parent = track
    
    local fill = Instance.new("Frame")
    fill.Name = "Fill"
    fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = self.accentColor
    fill.BorderSizePixel = 0
    fill.Parent = track
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 4)
    fillCorner.Parent = fill
    
    local thumb = Instance.new("TextButton")
    thumb.Name = "Thumb"
    thumb.Size = UDim2.new(0, 20, 0, 20)
    thumb.Position = UDim2.new((value - min) / (max - min), -10, 0.5, -10)
    thumb.BackgroundColor3 = COLORS.TEXT.PRIMARY
    thumb.BorderSizePixel = 0
    thumb.Text = ""
    thumb.AutoButtonColor = false
    thumb.Parent = track
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(0.5, 0)
    thumbCorner.Parent = thumb
    
    local thumbStroke = Instance.new("UIStroke")
    thumbStroke.Color = self.accentColor
    thumbStroke.Thickness = 2
    thumbStroke.Parent = thumb
    
    -- Взаимодействие
    local dragging = false
    local userInputService = game:GetService("UserInputService")
    
    local function updateValue(newValue)
        value = math.clamp(newValue, min, max)
        local percentage = (value - min) / (max - min)
        
        fill.Size = UDim2.new(percentage, 0, 1, 0)
        thumb.Position = UDim2.new(percentage, -10, 0.5, -10)
        valueLabel.Text = string.format("%.0f", value)
        
        if callback then
            callback(value)
        end
    end
    
    thumb.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    userInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    userInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mouse = userInputService:GetMouseLocation()
            local trackAbsolute = track.AbsolutePosition
            local trackSize = track.AbsoluteSize
            
            local relativeX = (mouse.X - trackAbsolute.X) / trackSize.X
            local newValue = min + (max - min) * math.clamp(relativeX, 0, 1)
            updateValue(newValue)
        end
    end)
    
    track.MouseButton1Down:Connect(function()
        local mouse = userInputService:GetMouseLocation()
        local trackAbsolute = track.AbsolutePosition
        local trackSize = track.AbsoluteSize
        
        local relativeX = (mouse.X - trackAbsolute.X) / trackSize.X
        local newValue = min + (max - min) * math.clamp(relativeX, 0, 1)
        updateValue(newValue)
    end)
    
    return sliderContainer
end

function ElegantModMenu:createSettingsButton(name, callback)
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "SettingsButton"
    buttonContainer.Size = UDim2.new(1, 0, 0, 40)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.LayoutOrder = #buttonContainer.Parent:GetChildren()
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundColor3 = COLORS.BACKGROUND.SECONDARY
    button.BackgroundTransparency = 0.7
    button.Text = name
    button.TextColor3 = COLORS.TEXT.PRIMARY
    button.TextSize = 14
    button.Font = Enum.Font.GothamMedium
    button.AutoButtonColor = false
    button.Parent = buttonContainer
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 10)
    buttonCorner.Parent = button
    
    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = self.accentColor
    buttonStroke.Thickness = 1
    buttonStroke.Transparency = 0.6
    buttonStroke.Parent = button
    
    button.MouseEnter:Connect(function()
        tween(button, {BackgroundTransparency = 0.5})
        tween(buttonStroke, {Transparency = 0.3})
    end)
    
    button.MouseLeave:Connect(function()
        tween(button, {BackgroundTransparency = 0.7})
        tween(buttonStroke, {Transparency = 0.6})
    end)
    
    button.MouseButton1Click:Connect(function()
        if callback then
            callback()
        end
    end)
    
    return buttonContainer
end

-- Функции настроек игры
function ElegantModMenu:applyGameSettings()
    -- Применяем текущие настройки игры
    self:setCameraFOV(self.gameSettings.cameraFOV)
    self:setCameraSmoothing(self.gameSettings.cameraSmoothing)
    self:toggleNightMode(self.gameSettings.nightMode)
end

function ElegantModMenu:toggleNightMode(enabled)
    if not game:GetService("RunService"):IsClient() then return end
    
    local lighting = game:GetService("Lighting")
    
    if enabled then
        -- Сохраняем оригинальные цвета
        self.gameSettings.originalColors = {
            Ambient = lighting.Ambient,
            OutdoorAmbient = lighting.OutdoorAmbient,
            ClockTime = lighting.ClockTime,
            FogColor = lighting.FogColor,
            FogEnd = lighting.FogEnd
        }
        
        -- Устанавливаем ночной режим
        lighting.Ambient = Color3.fromRGB(30, 30, 60)
        lighting.OutdoorAmbient = Color3.fromRGB(40, 40, 80)
        lighting.ClockTime = 0
        lighting.FogColor = Color3.fromRGB(20, 20, 40)
        lighting.FogEnd = 500
        
        -- Добавляем звезды (если есть возможность)
        if lighting:FindFirstChild("Sky") then
            lighting.Sky.MoonAngularSize = 11
            lighting.Sky.MoonTextureId = "rbxassetid://6444320592"
        end
    else
        -- Восстанавливаем оригинальные цвета
        if self.gameSettings.originalColors.Ambient then
            lighting.Ambient = self.gameSettings.originalColors.Ambient
            lighting.OutdoorAmbient = self.gameSettings.originalColors.OutdoorAmbient
            lighting.ClockTime = self.gameSettings.originalColors.ClockTime
            lighting.FogColor = self.gameSettings.originalColors.FogColor
            lighting.FogEnd = self.gameSettings.originalColors.FogEnd
        end
    end
end

function ElegantModMenu:setCameraFOV(fov)
    if not game:GetService("RunService"):IsClient() then return end
    
    local player = game:GetService("Players").LocalPlayer
    if player and player:FindFirstChild("PlayerGui") then
        for _, camera in pairs(player.PlayerGui:GetDescendants()) do
            if camera:IsA("Camera") then
                camera.FieldOfView = fov
            end
        end
    end
end

function ElegantModMenu:setCameraSmoothing(enabled)
    if not game:GetService("RunService"):IsClient() then return end
    
    local camera = workspace.CurrentCamera
    if camera then
        camera.CameraType = enabled and Enum.CameraType.Custom or Enum.CameraType.Fixed
    end
end

-- Полезные функции
function ElegantModMenu:saveGameState()
    -- Сохраняем состояние игры
    print("Состояние игры сохранено!")
end

function ElegantModMenu:searchPlayers()
    -- Поиск игроков
    print("Поиск игроков...")
end

function ElegantModMenu:fixCommonBugs()
    -- Исправление багов
    print("Баги исправлены!")
end

function ElegantModMenu:showStatistics()
    -- Показ статистики
    print("Статистика показана!")
end

function ElegantModMenu:toggleCrosshair()
    -- Включение/выключение прицела
    print("Прицел переключен!")
end

function ElegantModMenu:toggleSpeedBoost()
    -- Включение/выключение ускорения
    print("Ускорение переключено!")
end

function ElegantModMenu:resetSettings()
    -- Сброс настроек
    self.settings = {
        menuOpacity = 0.95,
        animationSpeed = 0.3,
        showWatermark = true,
        themeColor = self.accentColor
    }
    
    self.gameSettings = {
        nightMode = false,
        cameraFOV = 70,
        cameraSmoothing = true,
        customColors = false,
        originalColors = {}
    }
    
    self:applyGameSettings()
    print("Настройки сброшены!")
end

-- Управление меню настроек
function ElegantModMenu:showSettingsMenu()
    if self.settingsWindow.Visible then return end
    
    self.settingsWindow.Visible = true
    self.settingsWindow.Size = UDim2.new(0, 350, 0, 0)
    self.settingsWindow.Position = UDim2.new(0.5, -175, 0.5, 0)
    
    tween(self.settingsWindow, {
        Size = UDim2.new(0, 350, 0, 450),
        Position = UDim2.new(0.5, -175, 0.5, -225)
    }, 0.4)
end

function ElegantModMenu:hideSettingsMenu()
    if not self.settingsWindow.Visible then return end
    
    tween(self.settingsWindow, {
        Size = UDim2.new(0, 350, 0, 0),
        Position = UDim2.new(0.5, -175, 0.5, 0)
    }, 0.35)
    
    task.delay(0.35, function()
        self.settingsWindow.Visible = false
    end)
end

-- Вспомогательные методы
function ElegantModMenu:addPlayerSelector(name, callback, icon, iconType)
    local players = {}
    for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            table.insert(players, player.Name)
        end
    end
    
    return self:addDropdown(name, players, 1, function(selected)
        if callback then
            callback(selected)
        end
    end, icon or "👤", iconType)
end

function ElegantModMenu:addItemSelector(name, items, callback, icon, iconType)
    return self:addDropdown(name, items, 1, function(selected)
        if callback then
            callback(selected)
        end
    end, icon or "📦", iconType)
end

-- Публичные методы
function ElegantModMenu:destroy()
    if self.screenGui then
        self.screenGui:Destroy()
    end
end

function ElegantModMenu:setVisible(visible)
    if visible then
        self:show()
    else
        self:hide()
    end
end

-- Экспорт
return ElegantModMenu
